<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uderia Platform</title>
    <!-- Favicon - SVG for modern browsers, ICO for fallback -->
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='favicon.svg') }}?v=7">
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}?v=7">
    <!-- Tailwind CSS - built with PostCSS (development mode for now) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- TODO: For production, build Tailwind with: npm install -D tailwindcss postcss autoprefixer && npx tailwindcss build -->
    <style>
        html {
            font-size: 13px;
        }
        :root {
            --tw-ring-shadow: 0 0 0 0 rgb(59 130 246 / 0);
        }
    </style>
    <script src="https://unpkg.com/@antv/g2plot@latest/dist/g2plot.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/themes.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
</head>
<!-- MODIFICATION: Body remains the 100vh flex-col container -->
<body class="flex h-screen flex-col" data-theme="modern">

    <!-- MODIFICATION: These are now top-level. The wrappers are removed. -->
    <nav class="w-full bg-black/30 backdrop-blur-md border-b border-white/10 py-2 flex items-center justify-between flex-shrink-0 z-40">
        <div class="flex items-center gap-x-4">
            <!-- NEW: Hamburger menu toggle aligned with sidebar icons -->
            <div class="w-[88px] pl-4 flex items-center flex-shrink-0">
                <button id="app-menu-toggle" type="button" class="p-3 text-gray-300 hover:text-white transition-colors rounded-md hover:bg-white/10">
                    <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
                    </svg>
                </button>
            </div>
            <!-- Uderia Logo and Title -->
            <div class="flex items-center gap-x-2">
                <svg width="28" height="28" viewBox="0 0 220 220" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <g id="SovereignFrame">
                        <path d="M45 50 L45 150 L75 165 L75 65 Z" fill="#9CA3AF"/>
                        <path d="M75 65 L75 165 L85 160 L85 60 Z" fill="#D1D5DB"/>
                        <path d="M45 50 L75 65 L85 60 L55 45 Z" fill="#E5E7EB"/>
                        <path d="M135 60 L135 160 L145 165 L145 65 Z" fill="#D1D5DB"/>
                        <path d="M145 65 L145 165 L175 150 L175 50 Z" fill="#9CA3AF"/>
                        <path d="M135 60 L165 45 L175 50 L145 65 Z" fill="#E5E7EB"/>
                    </g>
                    <g id="FusionCore">
                        <ellipse cx="110" cy="175" rx="40" ry="12" fill="#F15F22" fill-opacity="0.3" style="mix-blend-mode: multiply;"/>
                        <path d="M85 160 L85 140 L135 140 L135 160 L110 175 L85 160 Z" fill="#F15F22"/>
                        <path d="M85 160 L110 175 L110 155 L85 140 Z" fill="#D9501A"/>
                        <path d="M135 160 L110 175 L110 155 L135 140 Z" fill="#C2410C"/>
                        <path d="M85 140 L110 125 L135 140 L110 155 Z" fill="#FF8C50"/>
                    </g>
                </svg>
                <span class="text-sm font-bold text-white tracking-wider">UDERIA</span>
            </div>
            <!-- GitHub Star Button -->
            <a href="https://github.com/rgeissen/uderia" target="_blank" rel="noopener noreferrer" 
               class="flex items-center gap-x-1.5 px-2.5 py-1.5 bg-white/10 hover:bg-white/20 border border-white/20 rounded-md transition-all duration-200 text-sm font-medium text-gray-200 hover:text-white"
               title="Star this project on GitHub">
                <svg class="w-4 h-4" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
                    <path d="M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z"></path>
                </svg>
                <span>Star</span>
                <span id="github-star-count" class="text-sm font-semibold">-</span>
            </a>
            <!-- ============================================= -->
            <!-- APPLICATION-LEVEL BANNER SYSTEM             -->
            <!-- Location: Top navigation bar                 -->
            <!-- Use for: Global messages, config, auth, etc  -->
            <!-- ============================================= -->
            <div id="header-status-message" class="text-sm px-3 py-1 rounded-md transition-all duration-300 opacity-0"></div>
            <!-- Confirmation Banner for Delete Actions -->
            <div id="delete-confirmation-banner" class="hidden flex items-center justify-between gap-x-4 px-4 py-2.5 bg-red-500/20 border border-red-400/40 rounded-md text-sm">
                <div class="flex items-center gap-x-2 text-red-200">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                    </svg>
                    <span class="font-medium" id="delete-confirmation-message">Are you sure?</span>
                </div>
                <div class="flex items-center gap-x-2">
                    <button id="delete-confirmation-cancel" class="px-3 py-1 bg-gray-700 hover:bg-gray-600 text-white rounded transition-colors text-xs font-medium">
                        Cancel
                    </button>
                    <button id="delete-confirmation-ok" class="px-3 py-1 bg-red-600 hover:bg-red-700 text-white rounded transition-colors text-xs font-medium">
                        OK
                    </button>
                </div>
            </div>
            <!-- Example: Add more application-level banners here if needed -->
            <!-- <div id="some-other-app-banner" class="hidden ...">...</div> -->
        </div>
        <div class="flex items-center gap-x-4">
            <!-- Status Indicators - Industrial Design -->
            <div class="status-bar-section flex items-center gap-x-5 px-5 py-2.5 rounded-lg">
                <!-- Group 1: Core Services -->
                <div class="flex items-center gap-x-4">
                    <!-- MCP Server -->
                    <div class="status-item flex items-center gap-x-2 cursor-default group" title="MCP Server Status">
                        <div id="mcp-status-dot" class="connection-dot disconnected"></div>
                        <span class="status-label text-xs font-semibold text-gray-400 tracking-wider uppercase">MCP</span>
                    </div>
                    <!-- RAG -->
                    <div class="status-item flex items-center gap-x-2 cursor-default group" title="RAG Retrieval Status">
                        <div id="rag-status-dot" class="connection-dot disconnected"></div>
                        <span class="status-label text-xs font-semibold text-gray-400 tracking-wider uppercase">RAG</span>
                    </div>
                    <!-- LLM -->
                    <div class="status-item flex items-center gap-x-2 cursor-default group" title="LLM Provider Status">
                        <div id="llm-status-dot" class="connection-dot disconnected"></div>
                        <span class="status-label text-xs font-semibold text-gray-400 tracking-wider uppercase">LLM</span>
                    </div>
                </div>
                <!-- Divider -->
                <div class="status-divider w-px h-5 bg-gradient-to-b from-transparent via-white/15 to-transparent"></div>
                <!-- Group 2: Data Management -->
                <div class="flex items-center gap-x-4">
                    <!-- Context -->
                    <div class="status-item flex items-center gap-x-2 cursor-pointer group" title="Context Engine Status - Click to purge context">
                        <div id="context-status-dot" class="connection-dot disconnected"></div>
                        <span class="status-label text-xs font-semibold text-gray-400 tracking-wider uppercase">CTX</span>
                    </div>
                    <!-- Knowledge -->
                    <div class="status-item flex items-center gap-x-2 cursor-default group" title="Knowledge Repository Status">
                        <div id="knowledge-status-dot" class="connection-dot knowledge-idle"></div>
                        <span class="status-label text-xs font-semibold text-gray-400 tracking-wider uppercase">KNW</span>
                    </div>
                </div>
                <!-- Divider -->
                <div class="status-divider w-px h-5 bg-gradient-to-b from-transparent via-white/15 to-transparent"></div>
                <!-- Group 3: Real-time Connection -->
                <div class="flex items-center gap-x-4">
                    <!-- SSE -->
                    <div class="status-item flex items-center gap-x-2 cursor-default group" title="Real-time Server-Sent Events Connection">
                        <div id="sse-status-dot" class="connection-dot disconnected"></div>
                        <span class="status-label text-xs font-semibold text-gray-400 tracking-wider uppercase">SSE</span>
                    </div>
                </div>
            </div>
            <!-- User Menu (Authentication) -->
            <div id="user-menu-container" class="menu-item relative hidden">
                <button id="user-menu-button" class="flex items-center gap-x-3 p-2 text-gray-300 hover:text-white transition-colors rounded-md hover:bg-white/10" title="User Menu">
                    <div class="user-avatar-container relative">
                        <div class="w-10 h-10 rounded-full bg-gradient-to-br from-[#1E40AF] to-[#1E3A8A] flex items-center justify-center text-white font-bold text-base shadow-lg ring-2 ring-white/20 ring-offset-2 ring-offset-black/20 transition-all duration-300 hover:scale-105 hover:ring-white/40 hover:shadow-xl hover:shadow-blue-900/30">
                            <span id="user-avatar-initial" class="relative z-10">?</span>
                            <!-- Inner highlight for depth -->
                            <div class="absolute inset-0 rounded-full bg-gradient-to-br from-white/20 to-transparent pointer-events-none"></div>
                        </div>
                    </div>
                    <span id="user-display-name" class="user-display-name text-sm font-semibold hidden md:block tracking-tight">Guest</span>
                </button>
                <div id="user-dropdown-menu" class="dropdown-menu mt-2 w-56 rounded-md shadow-lg p-1" style="background-color: var(--modal-bg); border: 1px solid var(--border-primary); backdrop-filter: blur(16px);">
                    <div class="px-3 py-2 mb-1" style="border-bottom: 1px solid var(--border-primary);">
                        <p class="text-sm font-medium text-white" id="user-menu-name">User</p>
                        <p class="text-xs text-gray-400" id="user-menu-email">user@example.com</p>
                    </div>
                    <!-- Account Section -->
                    <button id="user-profile-button" class="flex items-center w-full px-3 py-2 text-sm text-gray-200 rounded-md text-left" onmouseover="this.style.backgroundColor='var(--hover-bg)'" onmouseout="this.style.backgroundColor='transparent'">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
                        </svg>
                        Profile
                    </button>
                    <button id="user-change-password-button" class="flex items-center w-full px-3 py-2 text-sm text-gray-200 rounded-md text-left" onmouseover="this.style.backgroundColor='var(--hover-bg)'" onmouseout="this.style.backgroundColor='transparent'">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd" />
                        </svg>
                        Change Password
                    </button>
                    <div class="my-1" style="border-top: 1px solid var(--border-primary);"></div>
                    <!-- Info Section -->
                    <button id="settings-info-button" class="flex items-center w-full px-3 py-2 text-sm text-gray-200 rounded-md text-left" onmouseover="this.style.backgroundColor='var(--hover-bg)'" onmouseout="this.style.backgroundColor='transparent'">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                        </svg>
                        Info
                    </button>
                    <div class="my-1" style="border-top: 1px solid var(--border-primary);"></div>
                    <!-- Theme Section -->
                    <div class="px-3 py-2">
                        <p class="text-xs text-gray-400 mb-2">Theme</p>
                        <div class="flex gap-2">
                            <button id="theme-legacy" class="theme-selector flex-1 px-2 py-1.5 text-xs text-gray-200 rounded border transition-colors" data-theme="legacy" style="border-color: var(--border-primary);" onmouseover="this.style.backgroundColor='var(--hover-bg)'" onmouseout="this.style.backgroundColor='transparent'">
                                Legacy
                            </button>
                            <button id="theme-modern" class="theme-selector flex-1 px-2 py-1.5 text-xs text-gray-200 rounded border transition-colors" data-theme="modern" style="border-color: var(--border-primary);" onmouseover="this.style.backgroundColor='var(--hover-bg)'" onmouseout="this.style.backgroundColor='transparent'">
                                Modern
                            </button>
                        </div>
                    </div>
                    <div class="my-1" style="border-top: 1px solid var(--border-primary);"></div>
                    <button id="user-logout-button" class="flex items-center w-full px-3 py-2 text-sm text-red-400 rounded-md hover:bg-red-500/10 text-left">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M3 3a1 1 0 00-1 1v12a1 1 0 102 0V4a1 1 0 00-1-1zm10.293 9.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L14.586 9H7a1 1 0 100 2h7.586l-1.293 1.293z" clip-rule="evenodd" />
                        </svg>
                        Logout
                    </button>
                </div>
            </div>
            <!-- Login Button (shown when not authenticated) -->
            <div id="login-button-container" class="hidden">
                <a href="/login" class="flex items-center gap-x-2 px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-md transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M3 3a1 1 0 011 1v12a1 1 0 11-2 0V4a1 1 0 011-1zm7.707 3.293a1 1 0 010 1.414L9.414 9H17a1 1 0 110 2H9.414l1.293 1.293a1 1 0 01-1.414 1.414l-3-3a1 1 0 010-1.414l3-3a1 1 0 011.414 0z" clip-rule="evenodd" />
                    </svg>
                    Login
                </a>
            </div>
        </div>
    </nav>
    
    <!-- MODIFICATION: These are now top-level. The wrappers are removed. -->
    <div id="main-content-area" class="flex flex-row flex-1 min-h-0">
        
        <!-- NEW: Vertical Side Navigation Bar -->
        <nav id="app-side-nav" class="collapsed flex flex-col h-full bg-black/30 p-4 border-r border-white/10 space-y-4">
            <!-- Navigation Links -->
            <div class="flex flex-col space-y-2">
                <!-- Reordered: Setup, Conversation, Executions, Intelligence, Marketplace, Administration -->
                <a href="#" id="view-switch-credentials" data-view="credentials-view" class="view-switch-button flex items-center gap-x-3 px-3 py-3 text-sm text-gray-200 rounded-md hover:bg-white/10">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
                    </svg>
                    <span class="nav-link-text font-semibold">Setup</span>
                </a>
                <a href="#" id="view-switch-conversation" data-view="conversation-view" class="view-switch-button flex items-center gap-x-3 px-3 py-3 text-sm text-gray-200 rounded-md hover:bg-white/10">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7S2 13.866 2 10 5.582 3 10 3s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zm-4 0H9v2h2V9z" clip-rule="evenodd" />
                    </svg>
                    <span class="nav-link-text font-semibold">Conversations</span>
                </a>
                <!-- NEW: Executions View Link -->
                <a href="#" id="view-switch-executions" data-view="executions-view" class="view-switch-button flex items-center gap-x-3 px-3 py-3 text-sm text-gray-200 rounded-md hover:bg-white/10">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                        <path d="M3 3h14v2H3V3zm0 4h14v10H3V7zm2 2v6h2v-6H5zM9 9v4h2V9H9zM13 9v4h2V9h-2z" />
                    </svg>
                    <span class="nav-link-text font-semibold">Executions</span>
                </a>
                <a href="#" id="view-switch-rag-maintenance" data-view="rag-maintenance-view" class="view-switch-button flex items-center gap-x-3 px-3 py-3 text-sm text-gray-200 rounded-md hover:bg-white/10">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4z" />
                        <path fill-rule="evenodd" d="M3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd" />
                    </svg>
                    <span class="nav-link-text font-semibold">Intelligence</span>
                </a>
                <!-- NEW: RAG Marketplace View Link -->
                <a href="#" id="view-switch-rag-marketplace" data-view="rag-marketplace-view" class="view-switch-button flex items-center gap-x-3 px-3 py-3 text-sm text-gray-200 rounded-md hover:bg-white/10">
                    <!-- Marketplace/store icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 flex-shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                    </svg>
                    <span class="nav-link-text font-semibold">Marketplace</span>
                </a>
                <a href="#" id="view-switch-admin" data-view="admin-view" class="view-switch-button hidden flex items-center gap-x-3 px-3 py-3 text-sm text-gray-200 rounded-md hover:bg-white/10">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" />
                    </svg>
                    <span class="nav-link-text font-semibold">Administration</span>
                </a>
            </div>
        </nav>

        <!-- NEW: Main View Container (holds all swappable views) -->
        <main id="app-view-container" class="flex-1 h-full min-w-0">

            <!-- VIEW 1: Conversation -->
            <!-- MODIFICATION: Set as initial active view -->
            <div id="conversation-view" class="app-view active flex flex-col w-full h-full">
                
                <!-- NEW: Conversation View Header (contains status dots and config/info buttons) -->
                <header id="conversation-header" class="hidden w-full bg-black/10 border-b border-white/10 px-4 py-2 flex items-center justify-between flex-shrink-0 z-10">
                    <!-- LEFT: Active Session Title and Profile Indicators -->
                    <div id="active-session-title-wrapper" class="hidden flex items-center gap-x-3">
                        <span id="active-session-title" class="text-lg font-semibold text-white cursor-pointer" title="Click to rename session">Current Session</span>
                        <span id="active-session-title-editing-hint" class="text-xs text-gray-400 hidden">Press Enter to save, Esc to cancel</span>
                        <!-- Copy Icon -->
                        <button id="copy-session-id" class="text-gray-400 hover:text-[#F15F22] transition-colors" title="Copy Session ID">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                            </svg>
                        </button>
                        <!-- Divider -->
                        <div class="h-6 w-px bg-white/20"></div>
                        <!-- Default Profile Badge -->
                        <div id="header-default-profile" class="hidden flex items-center gap-x-2 px-3 py-1 rounded-lg backdrop-blur-md border border-white/20">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-white" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                            </svg>
                            <span id="header-default-profile-tag" class="text-sm font-semibold text-white"></span>
                            <span class="text-xs text-white/70">default</span>
                        </div>
                        <!-- Temporary Override Badge -->
                        <div id="header-override-profile" class="hidden flex items-center gap-x-2 px-3 py-1 rounded-lg backdrop-blur-md border-2 animate-pulse-border">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-white" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z" clip-rule="evenodd" />
                            </svg>
                            <span id="header-override-profile-tag" class="text-sm font-semibold text-white"></span>
                            <span class="text-xs text-white/70">override</span>
                        </div>
                        <!-- ============================================= -->
                        <!-- CONVERSATION-LEVEL BANNER SYSTEM             -->
                        <!-- Location: Inside conversation pane           -->
                        <!-- Use for: Conversation-specific messages      -->
                        <!-- ============================================= -->
                        <div id="profile-override-warning-banner" class="hidden flex items-center gap-x-2 px-3 py-1 rounded-md bg-yellow-500/20 border border-yellow-400/50">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-yellow-500 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                            </svg>
                            <span id="profile-override-warning-message" class="text-xs text-yellow-100 font-medium"></span>
                            <button id="dismiss-profile-warning" class="text-yellow-400 hover:text-yellow-200 transition-colors">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                                </svg>
                            </button>
                        </div>
                    </div>
                    <!-- RIGHT: Config/Info/Window Buttons -->
                    <div class="flex items-center gap-x-1">
                        <div class="menu-item">
                            <button id="chat-modal-button" class="px-3 py-2 text-sm font-semibold text-gray-300 hover:bg-white/10 rounded-md transition-colors disabled:opacity-50" disabled>Chat</button>
                        </div>
                        <!-- MODIFICATION: Removed Config Button -->
                        <div class="menu-item">
                            <button id="prompt-editor-button" class="px-3 py-2 text-sm font-semibold text-gray-300 hover:bg-white/10 rounded-md transition-colors disabled:opacity-50" disabled>System Prompt</button>
                        </div>
                        <div class="menu-item">
                            <button id="window-menu-button" class="px-3 py-2 text-sm font-semibold text-gray-300 hover:bg-white/10 rounded-md transition-colors">Window</button>
                            <div id="window-dropdown-menu" class="dropdown-menu mt-2 w-56 rounded-md shadow-lg glass-panel p-1">
                                <label class="flex items-center justify-between w-full px-3 py-2 text-sm text-gray-200 rounded-md hover:bg-white/10 cursor-pointer">
                                    <span>History Panel</span>
                                    <input type="checkbox" id="toggle-history-checkbox" class="h-4 w-4 rounded text-teradata-orange bg-gray-700 border-gray-600 focus:ring-teradata-orange">
                                </label>
                                <label class="flex items-center justify-between w-full px-3 py-2 text-sm text-gray-200 rounded-md hover:bg-white/10 cursor-pointer">
                                    <span>Capabilities Panel</span>
                                    <input type="checkbox" id="toggle-header-checkbox" class="h-4 w-4 rounded text-teradata-orange bg-gray-700 border-gray-600 focus:ring-teradata-orange">
                                </label>
                                <label class="flex items-center justify-between w-full px-3 py-2 text-sm text-gray-200 rounded-md hover:bg-white/10 cursor-pointer">
                                    <span>Status Panel</span>
                                    <input type="checkbox" id="toggle-status-checkbox" class="h-4 w-4 rounded text-teradata-orange bg-gray-700 border-gray-600 focus:ring-teradata-orange">
                                </label>
                                <div class="my-1 border-t border-white/10"></div>
                                <label class="flex items-center justify-between w-full px-3 py-2 text-sm text-gray-200 rounded-md hover:bg-white/10 cursor-pointer">
                                    <span>Show Tooltips</span>
                                    <input type="checkbox" id="toggle-tooltips-checkbox" class="h-4 w-4 rounded text-teradata-orange bg-gray-700 border-gray-600 focus:ring-teradata-orange">
                                </label>
                                <div class="my-1 border-t border-white/10"></div>
                                <label class="flex items-center justify-between w-full px-3 py-2 text-sm text-gray-200 rounded-md hover:bg-white/10 cursor-pointer">
                                    <span>Show Welcome Screen</span>
                                    <input type="checkbox" id="toggle-welcome-screen-checkbox" class="h-4 w-4 rounded text-teradata-orange bg-gray-700 border-gray-600 focus:ring-teradata-orange">
                                </label>
                            </div>
                        </div>
                    </div>
                </header>

                <!-- NEW: Wrapper for the 3-panel layout -->
                <div id="conversation-panels" class="flex flex-row flex-1 min-h-0">
                    <!-- Original 3-Panel Layout (History, Main, Status) -->
                    <aside id="session-history-panel" class="collapsed w-1/4 max-w-xs h-full flex flex-col glass-panel rounded-r-2xl shadow-2xl border-r border-white/10" data-requires-config="true">
                        <header class="p-4 border-b border-white/10 flex justify-between items-center flex-shrink-0">
                            <h2 class="header-title text-lg font-bold text-white">History</h2>
                            <button id="new-chat-button" type="button" title="Start New Chat" class="p-2 text-gray-300 hover:text-white transition-colors rounded-md hover:bg-white/10">
                                <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" /></svg>
                            </button>
                        </header>
                        <!-- Show Utility Sessions Toggle (only visible if utility sessions exist) -->
                        <div id="sidebar-show-utility-sessions-container" class="hidden px-4 py-2 border-b border-white/10">
                            <label class="flex items-center gap-2 cursor-pointer group">
                                <input type="checkbox" id="sidebar-show-utility-sessions-toggle" checked class="w-4 h-4 text-purple-500 bg-gray-700 border-gray-600 rounded focus:ring-purple-500 focus:ring-2">
                                <div class="flex items-center gap-1.5">
                                    <svg class="w-3.5 h-3.5 text-purple-400 group-hover:text-purple-300 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                    </svg>
                                    <span class="text-xs text-gray-300 group-hover:text-white transition-colors">Show Utility</span>
                                </div>
                            </label>
                        </div>
                        <div id="session-list" class="flex-1 p-2 overflow-y-auto space-y-2">
                            <!-- Session items will be dynamically added here -->
                        </div>
                    </aside>

                    <div id="main-content" class="flex flex-col h-full flex-1 min-w-0 relative">
                        <div id="top-buttons-container" class="absolute top-0 left-0 right-0 p-4 flex justify-between items-center z-30 pointer-events-none hidden" data-requires-config="true">
                            <button id="toggle-history-button" title="Toggle History Panel" class="p-2 rounded-full bg-gray-800/50 hover:bg-teradata-orange transition-colors pointer-events-auto">
                                <!-- History Expand/Collapse Icons -->
                                <svg id="history-expand-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M13 5l7 7-7 7M5 5l7 7-7 7" />
                                </svg>
                                <svg id="history-collapse-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M11 19l-7-7 7-7m8 14l-7-7 7-7" />
                                </svg>
                            </button>
                            <button id="toggle-header-button" title="Toggle Capabilities Panel" class="p-2 rounded-full bg-gray-800/50 hover:bg-teradata-orange transition-colors pointer-events-auto">
                                <!-- Header Expand/Collapse Icons -->
                                <svg id="header-collapse-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M5 15l7-7 7 7" />
                                </svg>
                                <svg id="header-expand-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                                </svg>
                            </button>
                            <button id="toggle-status-button" title="Toggle Status Panel" class="p-2 rounded-full bg-gray-800/50 hover:bg-teradata-orange transition-colors pointer-events-auto">
                                <!-- Status Expand/Collapse Icons -->
                                <svg id="status-collapse-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M11 19l-7-7 7-7m8 14l-7-7 7-7" />
                                </svg>
                                <svg id="status-expand-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M13 5l7 7-7 7M5 5l7 7-7 7" />
                                </svg>
                            </button>
                        </div>

                        <header id="tool-header" class="relative rounded-b-2xl shadow-2xl z-20 flex flex-col flex-shrink-0 border-b pt-16 collapsed" style="background: var(--sidebar-bg, rgba(36, 52, 71, 0.98)); border-color: var(--sidebar-border, rgba(148, 163, 184, 0.1));" data-requires-config="true">
                            <!-- Capabilities Panel Content -->
                            <nav id="resource-tabs" class="flex justify-center items-center gap-x-4 p-3 border-b border-white/10">
                                <button class="resource-tab px-4 py-2 font-semibold text-sm text-gray-300 transition-colors hover:text-white active" data-type="tools">Tools</button>
                                <button class="resource-tab px-4 py-2 font-semibold text-sm text-gray-300 transition-colors hover:text-white" data-type="prompts">Prompts</button>
                                <button class="resource-tab px-4 py-2 font-semibold text-sm text-gray-300 transition-colors hover:text-white" data-type="resources">Resources</button>
                            </nav>
                            <div id="panels-container" class="flex-1 min-h-0">
                                <div id="tools-panel" class="resource-panel flex flex-col h-full">
                                    <nav id="tools-categories" class="flex justify-center items-center gap-x-2 p-3 border-b border-white/10"></nav>
                                    <div id="tools-panels-container" class="flex-1 min-h-0 overflow-y-auto p-2"></div>
                                </div>
                                <div id="prompts-panel" class="resource-panel flex-col h-full" style="display: none;">
                                    <nav id="prompts-categories" class="flex justify-center items-center gap-x-2 p-3 border-b border-white/10"></nav>
                                    <div id="prompts-panels-container" class="flex-1 min-h-0 overflow-y-auto p-2"></div>
                                </div>
                                <div id="resources-panel" class="resource-panel flex-col h-full" style="display: none;">
                                    <nav id="resources-categories" class="flex justify-center items-center gap-x-2 p-3 border-b border-white/10"></nav>
                                    <div id="resources-panels-container" class="flex-1 min-h-0 overflow-y-auto p-2"></div>
                                </div>
                            </div>
                        </header>

                        <div class="flex-1 flex flex-col min-h-0">
                            <main id="chat-container" class="flex-1 overflow-y-auto p-6">
                                <!-- Welcome Screen for Unconfigured State -->
                                <div id="welcome-screen" class="hidden h-full overflow-y-auto">
                                    <div class="max-w-6xl mx-auto text-center space-y-8 p-4 sm:p-8 pb-20 pt-8 sm:pt-12">
                                        <!-- Logo/Icon with Uderia Platform branding -->
                                        <div class="flex flex-col items-center justify-center border-t border-b border-white/10" style="margin-top: 2rem; margin-bottom: 0; padding-top: 3rem; padding-bottom: 4rem;">
                                            <div class="w-full flex flex-col items-center justify-center gap-8">
                                                <div class="w-full flex flex-col lg:flex-row items-center justify-center gap-12 lg:gap-16">
                                                    <!-- UDERIA Platform text - LEFT side -->
                                                    <div class="flex-1 order-2 lg:order-1 welcome-uderia-title text-center lg:text-right">
                                                        <div class="inline-block">
                                                            <div class="text-6xl sm:text-7xl font-bold text-white" style="letter-spacing: 0.02em; line-height: 0.9;">UDERIA</div>
                                                            <div class="text-xl sm:text-2xl font-light text-gray-400 text-center" style="text-transform: uppercase; margin-top: 0.5rem;">PLATFORM</div>
                                                        </div>
                                                    </div>
                                                    
                                                    <!-- Logo - CENTER -->
                                                    <div class="w-48 h-48 sm:w-56 sm:h-56 flex items-center justify-center flex-shrink-0 order-1 lg:order-2" style="filter: drop-shadow(0 20px 50px rgba(241, 95, 34, 0.5));">
                                                        <!-- Uderia Logo SVG -->
                                                        <svg width="100%" height="100%" viewBox="0 0 220 220" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                            <g id="SovereignFrame">
                                                                <path d="M45 50 L45 150 L75 165 L75 65 Z" fill="#374151"/>
                                                                <path d="M75 65 L75 165 L85 160 L85 60 Z" fill="#4B5563"/>
                                                                <path d="M45 50 L75 65 L85 60 L55 45 Z" fill="#6B7280"/>
                                                                <path d="M135 60 L135 160 L145 165 L145 65 Z" fill="#4B5563"/>
                                                                <path d="M145 65 L145 165 L175 150 L175 50 Z" fill="#374151"/>
                                                                <path d="M135 60 L165 45 L175 50 L145 65 Z" fill="#6B7280"/>
                                                            </g>
                                                            <g id="FusionCore">
                                                                <ellipse cx="110" cy="175" rx="40" ry="12" fill="#F15F22" fill-opacity="0.3"/>
                                                                <path d="M85 160 L85 140 L135 140 L135 160 L110 175 L85 160 Z" fill="#F15F22"/> 
                                                                <path d="M85 160 L110 175 L110 155 L85 140 Z" fill="#D9501A"/>
                                                                <path d="M135 160 L110 175 L110 155 L135 140 Z" fill="#C2410C"/>
                                                                <path d="M85 140 L110 125 L135 140 L110 155 Z" fill="#FF8C50"/>
                                                            </g>
                                                        </svg>
                                                    </div>
                                                    
                                                    <!-- Main Heading with gradient text - RIGHT side -->
                                                    <div class="text-center lg:text-left flex-1 order-3 welcome-tagline">
                                                        <h1 class="text-2xl sm:text-3xl md:text-4xl font-light text-white leading-tight m-0 p-0" style="line-height: 1.2; margin-bottom: 0;">
                                                            <span style="white-space: nowrap;">Cloud-Level Reasoning.</span><br/>
                                                            <span class="text-[#F15F22] font-semibold" style="white-space: nowrap;">Zero-Trust Privacy.</span>
                                                        </h1>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- CTA Button -->
                                        <div class="flex flex-col items-center gap-6 mt-12">
                                            <button id="welcome-configure-btn" class="welcome-cta-button group relative px-8 py-3.5 bg-teradata-orange hover:bg-teradata-orange-dark text-white text-lg font-semibold rounded-xl shadow-lg transition-all duration-300 transform hover:scale-105 flex items-center gap-3">
                                                <!-- Animated glow effect -->
                                                <div class="welcome-button-glow"></div>
                                                <!-- Icon (cogwheel for authenticated, login arrow for unauthenticated) -->
                                                <svg id="welcome-cogwheel-icon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 relative z-10 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                                </svg>
                                                <svg id="welcome-login-icon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 relative z-10 transition-transform hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1" />
                                                </svg>
                                                <span id="welcome-button-text" class="relative z-10">Checking...</span>
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 relative z-10 group-hover:translate-x-1 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M13 7l5 5m0 0l-5 5m5-5H6" />
                                                </svg>
                                            </button>
                                            <div id="welcome-config-info" class="flex items-center justify-center gap-2 flex-wrap">
                                                <p class="text-sm text-gray-400 welcome-subtext">(Requires MCP + Google/OpenAI/Llama/Azure AI/Ollama)</p>
                                                <a href="#" id="welcome-reconfigure-link" class="text-sm text-gray-400 hover:text-white transition-colors hidden">
                                                    or reconfigure settings
                                                </a>
                                            </div>
                                        </div>

                                        <!-- Consumption Warning Banner - Elegant & Non-Invasive -->
                                        <div id="consumption-warning-banner" class="hidden mt-12 max-w-3xl mx-auto">
                                            <!-- 80% Warning - Yellow -->
                                            <div id="consumption-warning-80" class="hidden glass-panel border-l-4 border-yellow-500 bg-yellow-500/10 rounded-lg p-5 backdrop-blur-sm transition-all duration-300 hover:shadow-lg hover:shadow-yellow-500/20">
                                                <div class="flex items-start gap-4">
                                                    <div class="flex-shrink-0">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-yellow-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                                                        </svg>
                                                    </div>
                                                    <div class="flex-1">
                                                        <h4 class="text-yellow-400 font-semibold text-base mb-1">Approaching Consumption Limit</h4>
                                                        <p class="text-gray-300 text-sm leading-relaxed mb-2" id="consumption-warning-80-message">You've used a significant portion of your quota.</p>
                                                        <div class="flex items-center gap-3 mt-3">
                                                            <div class="flex-1">
                                                                <div class="h-2 bg-gray-700/50 rounded-full overflow-hidden">
                                                                    <div id="consumption-progress-80" class="h-full bg-gradient-to-r from-yellow-500 to-yellow-400 rounded-full transition-all duration-500" style="width: 0%"></div>
                                                                </div>
                                                            </div>
                                                            <span id="consumption-percentage-80" class="text-yellow-400 font-semibold text-sm min-w-[3rem] text-right">0%</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- 95% Warning - Orange -->
                                            <div id="consumption-warning-95" class="hidden glass-panel border-l-4 border-orange-500 bg-orange-500/10 rounded-lg p-5 backdrop-blur-sm transition-all duration-300 hover:shadow-lg hover:shadow-orange-500/20">
                                                <div class="flex items-start gap-4">
                                                    <div class="flex-shrink-0">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-orange-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                        </svg>
                                                    </div>
                                                    <div class="flex-1">
                                                        <h4 class="text-orange-400 font-semibold text-base mb-1">Almost at Limit</h4>
                                                        <p class="text-gray-300 text-sm leading-relaxed mb-2" id="consumption-warning-95-message">You're very close to your consumption limit.</p>
                                                        <div class="flex items-center gap-3 mt-3">
                                                            <div class="flex-1">
                                                                <div class="h-2 bg-gray-700/50 rounded-full overflow-hidden">
                                                                    <div id="consumption-progress-95" class="h-full bg-gradient-to-r from-orange-500 to-orange-400 rounded-full transition-all duration-500" style="width: 0%"></div>
                                                                </div>
                                                            </div>
                                                            <span id="consumption-percentage-95" class="text-orange-400 font-semibold text-sm min-w-[3rem] text-right">0%</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- 100% Warning - Red -->
                                            <div id="consumption-warning-100" class="hidden glass-panel border-l-4 border-red-500 bg-red-500/10 rounded-lg p-5 backdrop-blur-sm transition-all duration-300 hover:shadow-lg hover:shadow-red-500/20">
                                                <div class="flex items-start gap-4">
                                                    <div class="flex-shrink-0">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                            <path stroke-linecap="round" stroke-linejoin="round" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                        </svg>
                                                    </div>
                                                    <div class="flex-1">
                                                        <h4 class="text-red-400 font-semibold text-base mb-1">Consumption Limit Reached</h4>
                                                        <p class="text-gray-300 text-sm leading-relaxed mb-2" id="consumption-warning-100-message">You've reached your consumption limit.</p>
                                                        <div class="flex items-center gap-3 mt-3">
                                                            <div class="flex-1">
                                                                <div class="h-2 bg-gray-700/50 rounded-full overflow-hidden">
                                                                    <div id="consumption-progress-100" class="h-full bg-gradient-to-r from-red-500 to-red-400 rounded-full transition-all duration-500" style="width: 0%"></div>
                                                                </div>
                                                            </div>
                                                            <span id="consumption-percentage-100" class="text-red-400 font-semibold text-sm min-w-[3rem] text-right">0%</span>
                                                        </div>
                                                        <p class="text-gray-400 text-xs mt-3 italic">Contact your administrator to upgrade your plan or request additional capacity.</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- What's New Section - Timeline Design -->
                                        <div class="mt-16 pt-12 border-t border-white/10 text-left max-w-4xl mx-auto">
                                            <div class="text-center mb-10">
                                                <h4 class="text-3xl font-bold text-white header-title mb-2">What's New</h4>
                                                <p class="text-gray-400">Recent features and improvements</p>
                                            </div>
                                            <div class="grid md:grid-cols-2 gap-x-12 gap-y-6 relative">
                                                <!-- Timeline connector line for desktop -->
                                                <div class="hidden md:block absolute left-1/2 top-0 bottom-0 w-px bg-white/10"></div>
                                                
                                                <div class="welcome-timeline-item glass-panel p-4 rounded-xl transition-all duration-300 hover:shadow-lg hover:border-teradata-orange/50 border border-white/10">
                                                    <div class="flex items-start gap-3">
                                                        <div class="mt-1.5 w-3 h-3 rounded-full bg-teradata-orange flex-shrink-0 shadow-lg shadow-teradata-orange/50"></div>
                                                        <div>
                                                            <p class="text-sm font-semibold text-teradata-orange">05-Dec-2025</p>
                                                            <p class="text-base text-white font-medium">Consumption Profile Enforcement - Rate Limiting and Usage Quotas</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="welcome-timeline-item glass-panel p-4 rounded-xl transition-all duration-300 hover:shadow-lg hover:border-teradata-orange/50 border border-white/10">
                                                    <div class="flex items-start gap-3">
                                                        <div class="mt-1.5 w-3 h-3 rounded-full bg-teradata-orange flex-shrink-0 shadow-lg shadow-teradata-orange/50"></div>
                                                        <div>
                                                            <p class="text-sm font-semibold text-teradata-orange">02-Dec-2025</p>
                                                            <p class="text-base text-white font-medium">Financial Governance - Dashboards and LiteLLM Integration</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="welcome-timeline-item glass-panel p-4 rounded-xl transition-all duration-300 hover:shadow-lg hover:border-teradata-orange/50 border border-white/10">
                                                    <div class="flex items-start gap-3">
                                                        <div class="mt-1.5 w-3 h-3 rounded-full bg-teradata-orange flex-shrink-0 shadow-lg shadow-teradata-orange/50"></div>
                                                        <div>
                                                            <p class="text-sm font-semibold text-teradata-orange">01-Dec-2025</p>
                                                            <p class="text-base text-white font-medium">Planner Constructor: SQL Query - Document Context</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="welcome-timeline-item glass-panel p-4 rounded-xl transition-all duration-300 hover:shadow-lg hover:border-teradata-orange/50 border border-white/10">
                                                    <div class="flex items-start gap-3">
                                                        <div class="mt-1.5 w-3 h-3 rounded-full bg-teradata-orange flex-shrink-0 shadow-lg shadow-teradata-orange/50"></div>
                                                        <div>
                                                            <p class="text-sm font-semibold text-teradata-orange">01-Dec-2025</p>
                                                            <p class="text-base text-white font-medium">Planner Constructor: SQL Query - Database Context</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="welcome-timeline-item glass-panel p-4 rounded-xl transition-all duration-300 hover:shadow-lg hover:border-teradata-orange/50 border border-white/10">
                                                    <div class="flex items-start gap-3">
                                                        <div class="mt-1.5 w-3 h-3 rounded-full bg-teradata-orange flex-shrink-0 shadow-lg shadow-teradata-orange/50"></div>
                                                        <div>
                                                            <p class="text-sm font-semibold text-teradata-orange">29-Nov-2025</p>
                                                            <p class="text-base text-white font-medium">Knowledge Repository Constructor - Document Storage</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="welcome-timeline-item glass-panel p-4 rounded-xl transition-all duration-300 hover:shadow-lg hover:border-teradata-orange/50 border border-white/10">
                                                    <div class="flex items-start gap-3">
                                                        <div class="mt-1.5 w-3 h-3 rounded-full bg-teradata-orange flex-shrink-0 shadow-lg shadow-teradata-orange/50"></div>
                                                        <div>
                                                            <p class="text-sm font-semibold text-teradata-orange">28-Nov-2025</p>
                                                            <p class="text-base text-white font-medium">Knowledge Repository Integration</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="welcome-timeline-item glass-panel p-4 rounded-xl transition-all duration-300 hover:shadow-lg hover:border-teradata-orange/50 border border-white/10">
                                                    <div class="flex items-start gap-3">
                                                        <div class="mt-1.5 w-3 h-3 rounded-full bg-teradata-orange flex-shrink-0 shadow-lg shadow-teradata-orange/50"></div>
                                                        <div>
                                                            <p class="text-sm font-semibold text-teradata-orange">25-Nov-2025</p>
                                                            <p class="text-base text-white font-medium">Multi-User Authentication - JWT tokens, access tokens, user tiers</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="welcome-timeline-item glass-panel p-4 rounded-xl transition-all duration-300 hover:shadow-lg hover:border-teradata-orange/50 border border-white/10">
                                                    <div class="flex items-start gap-3">
                                                        <div class="mt-1.5 w-3 h-3 rounded-full bg-teradata-orange flex-shrink-0 shadow-lg shadow-teradata-orange/50"></div>
                                                        <div>
                                                            <p class="text-sm font-semibold text-teradata-orange">22-Nov-2025</p>
                                                            <p class="text-base text-white font-medium">Profile System - Modular Configuration & Temporary Overrides</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="welcome-timeline-item glass-panel p-4 rounded-xl transition-all duration-300 hover:shadow-lg hover:border-teradata-orange/50 border border-white/10">
                                                    <div class="flex items-start gap-3">
                                                        <div class="mt-1.5 w-3 h-3 rounded-full bg-teradata-orange flex-shrink-0 shadow-lg shadow-teradata-orange/50"></div>
                                                        <div>
                                                            <p class="text-sm font-semibold text-teradata-orange">21-Nov-2025</p>
                                                            <p class="text-base text-white font-medium">Planner Repository Constructors - Modular Plugin System</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="welcome-timeline-item glass-panel p-4 rounded-xl transition-all duration-300 hover:shadow-lg hover:border-teradata-orange/50 border border-white/10">
                                                    <div class="flex items-start gap-3">
                                                        <div class="mt-1.5 w-3 h-3 rounded-full bg-teradata-orange flex-shrink-0 shadow-lg shadow-teradata-orange/50"></div>
                                                        <div>
                                                            <p class="text-sm font-semibold text-teradata-orange">19-Nov-2025</p>
                                                            <p class="text-base text-white font-medium">Modern UI Design</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="welcome-timeline-item glass-panel p-4 rounded-xl transition-all duration-300 hover:shadow-lg hover:border-teradata-orange/50 border border-white/10">
                                                    <div class="flex items-start gap-3">
                                                        <div class="mt-1.5 w-3 h-3 rounded-full bg-teradata-orange flex-shrink-0 shadow-lg shadow-teradata-orange/50"></div>
                                                        <div>
                                                            <p class="text-sm font-semibold text-teradata-orange">15-Nov-2025</p>
                                                            <p class="text-base text-white font-medium">Flowise Integration</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="welcome-timeline-item glass-panel p-4 rounded-xl transition-all duration-300 hover:shadow-lg hover:border-teradata-orange/50 border border-white/10">
                                                    <div class="flex items-start gap-3">
                                                        <div class="mt-1.5 w-3 h-3 rounded-full bg-teradata-orange flex-shrink-0 shadow-lg shadow-teradata-orange/50"></div>
                                                        <div>
                                                            <p class="text-sm font-semibold text-teradata-orange">14-Nov-2025</p>
                                                            <p class="text-base text-white font-medium">Airflow Integration</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="welcome-timeline-item glass-panel p-4 rounded-xl transition-all duration-300 hover:shadow-lg hover:border-teradata-orange/50 border border-white/10">
                                                    <div class="flex items-start gap-3">
                                                        <div class="mt-1.5 w-3 h-3 rounded-full bg-teradata-orange flex-shrink-0 shadow-lg shadow-teradata-orange/50"></div>
                                                        <div>
                                                            <p class="text-sm font-semibold text-teradata-orange">11-Nov-2025</p>
                                                            <p class="text-base text-white font-medium">Self-Improving AI (Planner Repository)</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="welcome-timeline-item glass-panel p-4 rounded-xl transition-all duration-300 hover:shadow-lg hover:border-teradata-orange/50 border border-white/10">
                                                    <div class="flex items-start gap-3">
                                                        <div class="mt-1.5 w-3 h-3 rounded-full bg-teradata-orange flex-shrink-0 shadow-lg shadow-teradata-orange/50"></div>
                                                        <div>
                                                            <p class="text-sm font-semibold text-teradata-orange">06-Nov-2025</p>
                                                            <p class="text-base text-white font-medium">UI Real-Time Monitoring</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="welcome-timeline-item glass-panel p-4 rounded-xl transition-all duration-300 hover:shadow-lg hover:border-teradata-orange/50 border border-white/10">
                                                    <div class="flex items-start gap-3">
                                                        <div class="mt-1.5 w-3 h-3 rounded-full bg-teradata-orange flex-shrink-0 shadow-lg shadow-teradata-orange/50"></div>
                                                        <div>
                                                            <p class="text-sm font-semibold text-teradata-orange">31-Oct-2025</p>
                                                            <p class="text-base text-white font-medium">Configurable Context Management</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="welcome-timeline-item glass-panel p-4 rounded-xl transition-all duration-300 hover:shadow-lg hover:border-teradata-orange/50 border border-white/10">
                                                    <div class="flex items-start gap-3">
                                                        <div class="mt-1.5 w-3 h-3 rounded-full bg-teradata-orange flex-shrink-0 shadow-lg shadow-teradata-orange/50"></div>
                                                        <div>
                                                            <p class="text-sm font-semibold text-teradata-orange">24-Oct-2025</p>
                                                            <p class="text-base text-white font-medium">Turn Replay & Reload Plan</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="welcome-timeline-item glass-panel p-4 rounded-xl transition-all duration-300 hover:shadow-lg hover:border-teradata-orange/50 border border-white/10">
                                                    <div class="flex items-start gap-3">
                                                        <div class="mt-1.5 w-3 h-3 rounded-full bg-teradata-orange flex-shrink-0 shadow-lg shadow-teradata-orange/50"></div>
                                                        <div>
                                                            <p class="text-sm font-semibold text-teradata-orange">24-Oct-2025</p>
                                                            <p class="text-base text-white font-medium">Stop Button Feature</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="welcome-timeline-item glass-panel p-4 rounded-xl transition-all duration-300 hover:shadow-lg hover:border-teradata-orange/50 border border-white/10">
                                                    <div class="flex items-start gap-3">
                                                        <div class="mt-1.5 w-3 h-3 rounded-full bg-teradata-orange flex-shrink-0 shadow-lg shadow-teradata-orange/50"></div>
                                                        <div>
                                                            <p class="text-sm font-semibold text-teradata-orange">23-Oct-2025</p>
                                                            <p class="text-base text-white font-medium">Multi-Tool Phase Handling</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="welcome-timeline-item glass-panel p-4 rounded-xl transition-all duration-300 hover:shadow-lg hover:border-teradata-orange/50 border border-white/10">
                                                    <div class="flex items-start gap-3">
                                                        <div class="mt-1.5 w-3 h-3 rounded-full bg-teradata-orange flex-shrink-0 shadow-lg shadow-teradata-orange/50"></div>
                                                        <div>
                                                            <p class="text-sm font-semibold text-teradata-orange">11-Oct-2025</p>
                                                            <p class="text-base text-white font-medium">Friendly.AI Integration</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="welcome-timeline-item glass-panel p-4 rounded-xl transition-all duration-300 hover:shadow-lg hover:border-teradata-orange/50 border border-white/10">
                                                    <div class="flex items-start gap-3">
                                                        <div class="mt-1.5 w-3 h-3 rounded-full bg-teradata-orange flex-shrink-0 shadow-lg shadow-teradata-orange/50"></div>
                                                        <div>
                                                            <p class="text-sm font-semibold text-teradata-orange">10-Oct-2025</p>
                                                            <p class="text-base text-white font-medium">Collateral Report Rendering</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="welcome-timeline-item glass-panel p-4 rounded-xl transition-all duration-300 hover:shadow-lg hover:border-teradata-orange/50 border border-white/10">
                                                    <div class="flex items-start gap-3">
                                                        <div class="mt-1.5 w-3 h-3 rounded-full bg-teradata-orange flex-shrink-0 shadow-lg shadow-teradata-orange/50"></div>
                                                        <div>
                                                            <p class="text-sm font-semibold text-teradata-orange">19-Sep-2025</p>
                                                            <p class="text-base text-white font-medium">Microsoft Azure Integration</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="welcome-timeline-item glass-panel p-4 rounded-xl transition-all duration-300 hover:shadow-lg hover:border-teradata-orange/50 border border-white/10">
                                                    <div class="flex items-start gap-3">
                                                        <div class="mt-1.5 w-3 h-3 rounded-full bg-teradata-orange flex-shrink-0 shadow-lg shadow-teradata-orange/50"></div>
                                                        <div>
                                                            <p class="text-sm font-semibold text-teradata-orange">18-Sep-2025</p>
                                                            <p class="text-base text-white font-medium">REST Interface Configuration</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="welcome-timeline-item glass-panel p-4 rounded-xl transition-all duration-300 hover:shadow-lg hover:border-teradata-orange/50 border border-white/10">
                                                    <div class="flex items-start gap-3">
                                                        <div class="mt-1.5 w-3 h-3 rounded-full bg-teradata-orange flex-shrink-0 shadow-lg shadow-teradata-orange/50"></div>
                                                        <div>
                                                            <p class="text-sm font-semibold text-teradata-orange">12-Sep-2025</p>
                                                            <p class="text-base text-white font-medium">Formatting Upgrade</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="welcome-timeline-item glass-panel p-4 rounded-xl transition-all duration-300 hover:shadow-lg hover:border-teradata-orange/50 border border-white/10">
                                                    <div class="flex items-start gap-3">
                                                        <div class="mt-1.5 w-3 h-3 rounded-full bg-teradata-orange flex-shrink-0 shadow-lg shadow-teradata-orange/50"></div>
                                                        <div>
                                                            <p class="text-sm font-semibold text-teradata-orange">05-Sep-2025</p>
                                                            <p class="text-base text-white font-medium">Conversation Mode (TTS)</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- LLM Leaderboard Link -->
                                        <div class="mt-12 pt-10 border-t border-white/10 max-w-3xl mx-auto">
                                            <div class="glass-panel p-6 rounded-2xl flex items-center justify-center gap-4 text-base hover:border-teradata-orange/50 transition-all duration-300 border border-white/10">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-facc15" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                                                </svg>
                                                <span class="text-gray-300">View the latest LLM benchmarks:</span>
                                                <a href="https://gorilla.cs.berkeley.edu/leaderboard.html" target="_blank" class="text-teradata-orange hover:text-teradata-orange-dark font-semibold underline transition-colors">
                                                    Gorilla Leaderboard 
                                                </a>
                                            </div>
                                        </div>

                                        <!-- Disabled Capabilities (dynamically populated) -->
                                        <div id="welcome-disabled-capabilities" class="mt-8 hidden"></div>
                                    </div>
                                </div>
                                
                                <div id="chat-log" class="max-w-5xl mx-auto space-y-8">
                                    <!-- Chat messages will be added here -->
                                </div>
                            </main>

                            <footer id="chat-footer" class="p-4">
                                <div class="max-w-5xl mx-auto relative">
                                    <div id="profile-tag-selector" class="absolute bottom-full mb-2 w-full hidden"></div>
                                    <div id="rag-suggestions-container" class="absolute bottom-full mb-2 w-full hidden"></div>
                                    <form id="chat-form" class="flex items-center gap-3 glass-panel rounded-xl p-2 relative">
                                        <div id="active-profile-tag" class="hidden"></div>
                                        <input type="text" id="user-input" placeholder="Ask about databases, tables, users..."
                                            class="flex-1 p-3 bg-transparent border-none rounded-lg focus:outline-none text-white placeholder-gray-400"
                                            autocomplete="off" disabled />
                                        <!-- Voice Input Button -->
                                        <button type="button" id="voice-input-button"
                                            class="p-3 bg-gray-600 rounded-lg hover:bg-gray-500 disabled:bg-gray-700 flex items-center justify-center w-12 h-12 transition-all duration-200 transform hover:scale-110 hidden"
                                            title="Voice Conversation (Hold Ctrl)">
                                            <svg id="mic-icon" class="w-6 h-6 text-white" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                                                <path d="M12 14a3 3 0 003-3V5a3 3 0 00-6 0v6a3 3 0 003 3z" />
                                                <path d="M12 16.5a4.5 4.5 0 01-4.5-4.5V7a1 1 0 012 0v5a2.5 2.5 0 005 0V7a1 1 0 012 0v5a4.5 4.5 0 01-4.5 4.5z" />
                                                <path d="M12 21a1 1 0 01-1-1v-2.06a7 7 0 01-5.9-6.84 1 1 0 012 0A5 5 0 0012 16a5 5 0 005-5.06 1 1 0 012 0 7 7 0 01-5.9 6.84V20a1 1 0 01-1 1z" />
                                            </svg>
                                        </button>
                                        <!-- Key Observations Toggle Button -->
                                        <button type="button" id="key-observations-toggle-button" class="p-3 bg-gray-600 rounded-lg hover:bg-gray-500 disabled:bg-gray-700 flex items-center justify-center w-12 h-12 transition-all duration-200 transform hover:scale-110 hidden" title="Key Observations - Autoplay Off">
                                            <!-- Icons for different states -->
                                            <svg id="observations-autoplay-off-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" viewBox="0 0 24 24" fill="currentColor">
                                                <path fill-rule="evenodd" d="M4.804 21.644A6.707 6.707 0 0 0 6 21.75a6.721 6.721 0 0 0 3.583-1.029c.774.182 1.584.279 2.417.279 5.352 0 9.75-3.62 9.75-8.125s-4.398-8.125-9.75-8.125S2.25 6.22 2.25 10.725c0 2.21.849 4.234 2.27 5.769a.75.75 0 0 1 .104.515v.23a.75.75 0 0 0 .45.694ZM12.75 9a.75.75 0 0 0-1.5 0v2.25H9a.75.75 0 0 0 0 1.5h2.25V15a.75.75 0 0 0 1.5 0v-2.25H15a.75.75 0 0 0 0-1.5h-2.25V9Z" clip-rule="evenodd" />
                                                <path d="M12.982 4.555A.75.75 0 0 0 12 5.25v.162A8.25 8.25 0 0 1 20.25 13.5c0 2.25-.89 4.31-2.344 5.842a.75.75 0 0 0 .938 1.165A9.753 9.753 0 0 0 21.75 13.5c0-5.11-4.14-9.25-9.25-9.25a.75.75 0 0 0-.518.305Z" />
                                            </svg>
                                            <svg id="observations-autoplay-on-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white hidden" viewBox="0 0 24 24" fill="currentColor">
                                                <path d="M12.982 4.555A.75.75 0 0 0 12 5.25v.162A8.25 8.25 0 0 1 20.25 13.5c0 2.25-.89 4.31-2.344 5.842a.75.75 0 0 0 .938 1.165A9.753 9.753 0 0 0 21.75 13.5c0-5.11-4.14-9.25-9.25-9.25a.75.75 0 0 0-.518.305Z" />
                                                <path fill-rule="evenodd" d="M4.804 21.644A6.707 6.707 0 0 0 6 21.75a6.721 6.721 0 0 0 3.583-1.029c.774.182 1.584.279 2.417.279 5.352 0 9.75-3.62 9.75-8.125s-4.398-8.125-9.75-8.125S2.25 6.22 2.25 10.725c0 2.21.849 4.234 2.27 5.769a.75.75 0 0 1 .104.515v.23a.75.75 0 0 0 .45.694ZM9.402 9.242a.75.75 0 0 1 1.054-.168l3.75 2.25a.75.75 0 0 1 0 1.352l-3.75 2.25a.75.75 0 0 1-1.054-1.184L12.333 12 9.402 10.258a.75.75 0 0 1-.168-1.016Z" clip-rule="evenodd" />
                                            </svg>
                                            <svg id="observations-off-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white hidden" viewBox="0 0 24 24" fill="currentColor">
                                                <path fill-rule="evenodd" d="M3.553 4.453a.75.75 0 0 0-1.06 1.06l16.5 16.5a.75.75 0 0 0 1.06-1.06l-2.03-2.03A9.732 9.732 0 0 0 21.75 13.5c0-5.11-4.14-9.25-9.25-9.25a9.68 9.68 0 0 0-3.32.556L7.203 2.78a.75.75 0 0 0-1.06-1.06l-2.59 2.59Zm2.83 2.83 2.473 2.473A8.223 8.223 0 0 1 12 5.412a8.25 8.25 0 0 1 8.25 8.25c0 .64-.074 1.264-.214 1.86l2.311 2.311A9.73 9.73 0 0 0 20.25 13.5a9.75 9.75 0 0 0-13.867-8.217Z" clip-rule="evenodd" />
                                                <path d="M4.804 21.644A6.707 6.707 0 0 0 6 21.75a6.721 6.721 0 0 0 3.583-1.029c.774.182 1.584.279 2.417.279 3.425 0 6.446-1.72 8.16-4.323l-1.68-1.68A8.253 8.253 0 0 1 12 19.088a8.138 8.138 0 0 1-4.145-1.13L4.82 21.436a.75.75 0 0 1-.015.208Z" />
                                            </svg>
                                        </button>
                                        <!-- Submit Button -->
                                        <button type="submit" id="submit-button"
                                            class="p-3 bg-[#F15F22] rounded-lg hover:bg-[#D9501A] disabled:bg-gray-600 flex items-center justify-center w-12 h-12 transition-all duration-200 transform hover:scale-110"
                                            disabled>
                                            <!-- Send Icon and Loading Spinner -->
                                            <svg id="send-icon" class="w-6 h-6 text-white flipped" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg>
                                            <svg id="loading-spinner" class="w-6 h-6 text-white animate-spin hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                                        </button>
                                    </form>
                                    <div id="input-hint" class="input-hint">
                                        <!-- Input Hint Content -->
                                        <span><strong>Full Session Context:</strong> <span class="text-green-400 font-semibold">On</span></span>
                                        <div class="hint-icon">
                                            ?
                                            <span class="tooltip">Full session context is the default. Hold <kbd>Alt</kbd> to temporarily use 'Turn Summaries' context. Press <kbd>Shift</kbd> + <kbd>Alt</kbd> to lock 'Turn Summaries' context on.</span>
                                        </div>
                                    </div>
                                </div>
                            </footer>
                        </div>
                    </div>

                    <aside id="status-window" class="collapsed w-1/3 max-w-md h-full flex flex-col glass-panel rounded-l-2xl shadow-2xl border-l border-white/10" data-requires-config="true">
                        <header class="p-4 border-b border-white/10 flex flex-col justify-center items-center relative flex-shrink-0">
                            <div class="flex justify-center items-center w-full relative">
                                <h2 id="status-title" class="header-title text-lg font-bold text-white">Live Status</h2>
                                
                                <div id="status-action-buttons" class="absolute right-0 flex items-center gap-x-1">
                                    <!-- Button 3: Replay Planned Query (Dummy) -->
                                    <button id="header-replay-planned-button" title="Replay Planned Query (Not Implemented)" class="replay-action-button p-2 text-gray-300 hover:text-white transition-colors rounded-md hover:bg-white/10 hidden">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                        </svg>
                                    </button>
                                    <!-- Button 4: Replay Optimized Query (Dummy) -->
                                    <button id="header-replay-optimized-button" title="Replay Optimized Query (Not Implemented)" class="replay-action-button p-2 text-gray-300 hover:text-white transition-colors rounded-md hover:bg-white/10 hidden">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                        </svg>
                                    </button>

                                    
                                    <!-- Stop Button (Moved from absolute to flow) -->
                                    <button id="stop-execution-button" title="Stop Current Execution" class="p-2 text-red-400 hover:text-red-300 transition-colors rounded-md hover:bg-red-500/20 hidden">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1V8a1 1 0 00-1-1H8z" clip-rule="evenodd" />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            <div id="task-id-display" class="text-xs text-gray-400 mt-1 flex items-center justify-center gap-x-2 h-4 hidden">
                                <span id="task-id-value" class="font-semibold text-white"></span>
                                <button id="copy-task-id-button" title="Copy Task ID" class="p-1 text-gray-400 hover:text-white transition-colors rounded-md hover:bg-white/10">
                                    <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>
                                </button>
                            </div>
                            <div id="status-prompt-name" class="text-xs text-gray-400 mt-1 flex items-center justify-center gap-x-2 h-4">
                                <span id="prompt-name-display">No Model/Prompt Loaded</span>
                                <span id="thinking-indicator" class="hidden items-center gap-x-1 text-yellow-400">
                                    <!-- Thinking Indicator SVG -->
                                    <svg class="w-4 h-4 animate-spin" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                                    <span>LLM Thinking...</span>
                                </span>
                            </div>
                            <!-- Knowledge Banner -->
                            <div id="knowledge-banner" class="hidden mt-2 px-3 py-1.5 bg-purple-500/20 border border-purple-400/40 rounded-md text-xs text-purple-200">
                                <div class="flex items-center gap-x-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor">
                                        <path d="M9 4.804A7.968 7.968 0 005.5 4c-1.255 0-2.443.29-3.5.804v10A7.969 7.969 0 015.5 14c1.669 0 3.218.51 4.5 1.385A7.962 7.962 0 0114.5 14c1.255 0 2.443.29 3.5.804v-10A7.968 7.968 0 0014.5 4c-1.255 0-2.443.29-3.5.804V12a1 1 0 11-2 0V4.804z"/>
                                    </svg>
                                    <span class="font-medium">Knowledge:</span>
                                    <span id="knowledge-collections-list" class="text-purple-100"></span>
                                </div>
                            </div>
                            <div id="token-usage-display" class="text-xs text-gray-400 mt-2 w-full">
                                <!-- Token Usage Display Content -->
                                <div id="token-normal-display">
                                    <div class="flex justify-around items-center space-x-2">
                                        <div class="text-center">
                                            <span class="font-semibold text-gray-300">Last Statement</span>
                                            <div class="flex gap-x-2 justify-center">
                                                <span title="Input Tokens">In: <strong id="statement-input-tokens" class="text-white">0</strong></span>
                                                <span title="Output Tokens">Out: <strong id="statement-output-tokens" class="text-white">0</strong></span>
                                            </div>
                                        </div>
                                        <div class="border-l border-white/20 h-6"></div>
                                        <div class="text-center">
                                            <span class="font-semibold text-gray-300">Session Total</span>
                                            <div class="flex gap-x-2 justify-center">
                                                <span title="Total Input Tokens">In: <strong id="total-input-tokens" class="text-white">0</strong></span>
                                                <span title="Total Output Tokens">Out: <strong id="total-output-tokens" class="text-white">0</strong></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div id="token-aws-message" class="text-center hidden">Token usage not available for this model (Cohere/Mistral/AI21)</div>
                            </div>
                        </header>
                        <div id="status-window-content" class="p-4 overflow-y-auto space-y-4 min-h-0" style="flex: 1 1 auto;">
                            <p class="text-gray-400">Waiting for a new request...</p>
                        </div>
                    </aside>
                </div>
            </div>

            <!-- VIEW X: Executions Dashboard - Three-Tier World-Class Design -->
            <div id="executions-view" class="app-view flex flex-col w-full h-full" style="background-color: var(--bg-primary);">
                <div class="w-full h-full flex flex-col overflow-hidden">
                    
                    <!-- TIER 1: Executive Command Center -->
                    <div id="exec-command-center" class="border-b border-white/10 p-6" style="background: linear-gradient(to bottom right, var(--bg-secondary), var(--bg-primary));">
                        <div class="max-w-7xl mx-auto">
                            <div class="flex items-center justify-between mb-6">
                                <div>
                                    <h1 class="text-3xl font-bold text-white">Execution Insights</h1>
                                    <p class="text-gray-400 mt-1">Real-time analytics and strategic insights</p>
                                </div>
                                <button id="refresh-dashboard-btn" class="px-4 py-2 bg-teradata-orange hover:bg-orange-600 text-white rounded-lg transition-colors flex items-center gap-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                    </svg>
                                    Refresh
                                </button>
                            </div>
                            
                            <!-- Performance Tabs (Admin: My Performance + System Performance | User: My Performance only) -->
                            <div id="performance-tabs-container" class="mb-6">
                                <div class="flex border-b border-gray-700 mb-6">
                                    <button id="tab-my-performance" class="px-6 py-3 font-medium text-sm border-b-2 border-[#F15F22] text-[#F15F22] transition-colors" onclick="window.executionDashboard.switchPerformanceTab('my')">
                                        My Performance
                                    </button>
                                    <button id="tab-system-performance" class="hidden px-6 py-3 font-medium text-sm border-b-2 border-transparent text-gray-400 hover:text-gray-300 transition-colors" onclick="window.executionDashboard.switchPerformanceTab('system')">
                                        System Performance
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Metrics Grid -->
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
                                <!-- Total Sessions Card -->
                                <div class="rounded-xl p-4 border transition-all" style="background-color: var(--card-bg); border-color: var(--border-primary);" onmouseover="this.style.borderColor='rgba(241, 95, 34, 0.5)'" onmouseout="this.style.borderColor='var(--border-primary)'">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-gray-400 text-sm font-medium">Total Sessions</p>
                                            <p id="metric-total-sessions" class="text-3xl font-bold text-white mt-1">0</p>
                                        </div>
                                        <div class="w-12 h-12 bg-teradata-orange/20 rounded-lg flex items-center justify-center">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-teradata-orange" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
                                            </svg>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Total Tokens Card -->
                                <div class="rounded-xl p-4 border transition-all" style="background-color: var(--card-bg); border-color: var(--border-primary);" onmouseover="this.style.borderColor='rgba(251, 146, 60, 0.5)'" onmouseout="this.style.borderColor='var(--border-primary)'">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-gray-400 text-sm font-medium">Total Tokens</p>
                                            <p id="metric-total-tokens" class="text-3xl font-bold text-white mt-1">0</p>
                                            <p class="text-xs text-gray-500 mt-1">
                                                <span id="metric-input-tokens">0</span> in / <span id="metric-output-tokens">0</span> out
                                            </p>
                                        </div>
                                        <div class="w-12 h-12 bg-orange-400/20 rounded-lg flex items-center justify-center">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-orange-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                            </svg>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Success Rate Card -->
                                <div class="rounded-xl p-4 border transition-all" style="background-color: var(--card-bg); border-color: var(--border-primary);" onmouseover="this.style.borderColor='rgba(34, 197, 94, 0.5)'" onmouseout="this.style.borderColor='var(--border-primary)'">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-gray-400 text-sm font-medium">Success Rate</p>
                                            <p id="metric-success-rate" class="text-3xl font-bold text-green-400 mt-1">0%</p>
                                        </div>
                                        <div class="w-12 h-12 bg-green-500/20 rounded-lg flex items-center justify-center">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                            </svg>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Estimated Cost Card -->
                                <div class="rounded-xl p-4 border transition-all" style="background-color: var(--card-bg); border-color: var(--border-primary);" onmouseover="this.style.borderColor='rgba(234, 179, 8, 0.5)'" onmouseout="this.style.borderColor='var(--border-primary)'">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-gray-400 text-sm font-medium">Est. Cost</p>
                                            <p id="metric-estimated-cost" class="text-3xl font-bold text-yellow-400 mt-1">$0.00</p>
                                        </div>
                                        <div class="w-12 h-12 bg-yellow-500/20 rounded-lg flex items-center justify-center">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-yellow-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                            </svg>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Execution Velocity Card -->
                                <div class="rounded-xl p-4 border transition-all" style="background-color: var(--card-bg); border-color: var(--border-primary);" onmouseover="this.style.borderColor='rgba(249, 115, 22, 0.5)'" onmouseout="this.style.borderColor='var(--border-primary)'">
                                    <div class="flex items-center justify-between">
                                        <div class="flex-1">
                                            <p class="text-gray-400 text-sm font-medium">Velocity (24h)</p>
                                            <canvas id="velocity-sparkline" class="w-full h-8 mt-2"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Model Distribution, Expensive Sessions & Questions -->
                            <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 mt-4">
                                <!-- Model Distribution -->
                                <div class="rounded-xl p-4 border" style="background-color: var(--card-bg); border-color: var(--border-primary);">
                                    <h3 class="text-white font-semibold mb-3 flex items-center gap-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-teradata-orange" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                                        </svg>
                                        Model Distribution
                                    </h3>
                                    <div id="model-distribution-list" class="space-y-2">
                                        <p class="text-gray-400 text-sm">No data available</p>
                                    </div>
                                </div>
                                
                                <!-- Most Token-Intensive Sessions -->
                                <div class="rounded-xl p-4 border" style="background-color: var(--card-bg); border-color: var(--border-primary);">
                                    <h3 class="text-white font-semibold mb-3 flex items-center gap-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z" />
                                        </svg>
                                        Most Token-Intensive Sessions
                                    </h3>
                                    <div id="top-expensive-queries-list" class="space-y-2">
                                        <p class="text-gray-400 text-sm">No session data available</p>
                                    </div>
                                </div>
                                
                                <!-- Most Token-Intensive Questions -->
                                <div class="rounded-xl p-4 border" style="background-color: var(--card-bg); border-color: var(--border-primary);">
                                    <h3 class="text-white font-semibold mb-3 flex items-center gap-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-orange-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                        </svg>
                                        Most Token-Intensive Questions
                                    </h3>
                                    <div id="top-expensive-questions-list" class="space-y-2">
                                        <p class="text-gray-400 text-sm">No question data available</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- TIER 2: Session Gallery -->
                    <div id="session-gallery" class="flex-1 p-6 overflow-y-auto" style="background-color: var(--bg-primary);">
                        <div class="max-w-7xl mx-auto">
                            <div class="flex items-center justify-between mb-6">
                                <h2 class="text-2xl font-bold text-white">Session Gallery</h2>
                                
                                <!-- Filter & Sort Controls -->
                                <div class="flex items-center gap-3">
                                    <div class="relative">
                                        <input 
                                            id="session-search" 
                                            type="text" 
                                            placeholder="Search sessions or questions..." 
                                            class="px-4 py-2 pr-10 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-teradata-orange transition-colors"
                                            style="background-color: var(--input-bg); border: 1px solid var(--border-primary);"
                                        />
                                        <button 
                                            id="clear-search-btn" 
                                            class="absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-white transition-colors hidden"
                                            title="Clear search"
                                        >
                                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                            </svg>
                                        </button>
                                    </div>
                                    
                                    <!-- Filters -->
                                    <select id="session-filter-status" class="px-4 py-2 bg-white/5 border border-white/10 rounded-lg text-white focus:outline-none focus:border-teradata-orange transition-colors">
                                        <option value="all">All Status</option>
                                        <option value="success">Success</option>
                                        <option value="partial">Partial</option>
                                        <option value="failed">Failed</option>
                                    </select>
                                    
                                    <select id="session-sort" class="px-4 py-2 bg-white/5 border border-white/10 rounded-lg text-white focus:outline-none focus:border-teradata-orange transition-colors">
                                        <option value="recent">Most Recent</option>
                                        <option value="oldest">Oldest First</option>
                                        <option value="tokens">Most Tokens</option>
                                        <option value="turns">Most Turns</option>
                                    </select>
                                    
                                    <!-- Toggles -->
                                    <!-- Show Utility Sessions Toggle (only visible if utility sessions exist) -->
                                    <div id="show-utility-sessions-container" class="hidden">
                                        <label class="flex items-center gap-3 px-4 py-2 bg-white/5 border border-white/10 rounded-lg cursor-pointer hover:bg-white/10 transition-all group">
                                            <input type="checkbox" id="show-utility-sessions-toggle" checked class="w-4 h-4 text-purple-500 bg-gray-700 border-gray-600 rounded focus:ring-purple-500 focus:ring-2">
                                            <div class="flex items-center gap-2">
                                                <svg class="w-4 h-4 text-purple-400 group-hover:text-purple-300 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                                </svg>
                                                <span class="text-sm text-white font-medium">Show Utility Sessions</span>
                                            </div>
                                        </label>
                                    </div>
                                    
                                    <!-- View All Sessions Toggle (Developer/Admin Only) -->
                                    <div id="view-all-sessions-container" class="hidden">
                                        <label class="flex items-center gap-3 px-4 py-2 bg-white/5 border border-white/10 rounded-lg cursor-pointer hover:bg-white/10 transition-all group">
                                            <input type="checkbox" id="view-all-sessions-toggle">
                                            <div class="flex items-center gap-2">
                                                <svg class="w-4 h-4 text-gray-400 group-hover:text-teradata-orange transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
                                                </svg>
                                                <span class="text-sm text-white font-medium">View All Users' Sessions</span>
                                            </div>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Session Cards Grid -->
                            <div id="session-cards-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                <!-- Session cards will be dynamically inserted here -->
                                <div class="col-span-full text-center py-12">
                                    <p class="text-gray-400">Loading sessions...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- TIER 3: Deep Dive Inspector (Initially Hidden) -->
                    <div id="deep-dive-inspector" class="hidden fixed inset-0 backdrop-blur-sm z-50 overflow-y-auto" style="background-color: var(--modal-overlay);">
                        <div class="min-h-screen flex items-start justify-center p-6">
                            <div class="rounded-2xl border max-w-6xl w-full my-8 shadow-2xl" style="background: linear-gradient(to bottom right, var(--bg-secondary), var(--bg-primary)); border-color: var(--border-primary);">
                                <!-- Inspector Header -->
                                <div class="border-b border-white/10 p-6 flex items-center justify-between">
                                    <div>
                                        <h2 id="inspector-session-name" class="text-2xl font-bold text-white">Session Details</h2>
                                        <p id="inspector-session-meta" class="text-gray-400 mt-1">Loading...</p>
                                    </div>
                                    <button id="close-inspector-btn" class="p-2 hover:bg-white/10 rounded-lg transition-colors">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-400 hover:text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                    </button>
                                </div>
                                
                                <!-- Inspector Content -->
                                <div class="p-6 space-y-6">
                                    <!-- Session Stats -->
                                    <div class="grid grid-cols-4 gap-4">
                                        <div class="rounded-lg p-4" style="background-color: var(--card-bg);">
                                            <p class="text-gray-400 text-sm">Total Turns</p>
                                            <p id="inspector-turn-count" class="text-2xl font-bold text-white mt-1">0</p>
                                        </div>
                                        <div class="rounded-lg p-4" style="background-color: var(--card-bg);">
                                            <p class="text-gray-400 text-sm">Total Tokens</p>
                                            <p id="inspector-total-tokens" class="text-2xl font-bold text-white mt-1">0</p>
                                        </div>
                                        <div class="rounded-lg p-4" style="background-color: var(--card-bg);">
                                            <p class="text-gray-400 text-sm">Model</p>
                                            <p id="inspector-model" class="text-lg font-semibold text-white mt-1">-</p>
                                        </div>
                                        <div class="rounded-lg p-4" style="background-color: var(--card-bg);">
                                            <p class="text-gray-400 text-sm">Planner Examples</p>
                                            <p id="inspector-rag-count" class="text-2xl font-bold text-green-400 mt-1">0</p>
                                        </div>
                                    </div>
                                    
                                    <!-- Timeline -->
                                    <div>
                                        <h3 class="text-xl font-bold text-white mb-4">Execution Timeline</h3>
                                        <div id="inspector-timeline" class="space-y-4">
                                            <p class="text-gray-400">Loading timeline...</p>
                                        </div>
                                    </div>
                                    
                                    <!-- Planner Repository Cases -->
                                    <div id="inspector-rag-section" class="hidden">
                                        <h3 class="text-xl font-bold text-white mb-4">Planner Repository Cases</h3>
                                        <div id="inspector-rag-cases" class="space-y-3">
                                            <!-- RAG cases will be inserted here -->
                                        </div>
                                    </div>
                                    
                                    <!-- Export Options -->
                                    <div class="border-t border-white/10 pt-6 flex gap-3">
                                        <button id="export-json-btn" class="px-4 py-2 bg-teradata-orange hover:bg-orange-600 text-white rounded-lg transition-colors">
                                            Export as JSON
                                        </button>
                                        <button id="export-report-btn" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors">
                                            Generate Report
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                </div>
            </div>

            <!-- VIEW 2A: Planner Repository Marketplace -->
            <div id="rag-marketplace-view" class="app-view w-full h-full overflow-y-auto">
                <div class="max-w-7xl mx-auto p-8">
                    <!-- Header -->
                    <div class="mb-8">
                        <h1 class="text-3xl font-bold text-white header-title mb-2">Intelligence Marketplace</h1>
                        <p class="text-gray-400">Discover and subscribe to community-curated collections</p>
                    </div>

                    <!-- Main Navigation Tabs (Browse / My Collections) -->
                    <div class="mb-6 border-b border-white/10">
                        <div class="flex gap-4">
                            <button id="marketplace-tab-browse" class="marketplace-tab px-4 py-3 text-white font-medium border-b-2 border-[#F15F22] transition-colors">
                                Browse Marketplace
                            </button>
                            <button id="marketplace-tab-my-collections" class="marketplace-tab px-4 py-3 text-gray-400 font-medium border-b-2 border-transparent hover:text-white hover:border-white/20 transition-colors">
                                My Collections
                            </button>
                        </div>
                    </div>

                    <!-- Repository Type Tabs (Planner / Knowledge) -->
                    <div class="mb-6">
                        <div class="flex gap-2 bg-white/5 rounded-lg p-1">
                            <button id="marketplace-repo-type-planner" class="marketplace-repo-type-tab flex-1 px-4 py-2 text-sm font-medium rounded-md bg-[#F15F22] text-white transition-colors">
                                <div class="flex items-center justify-center gap-2">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                                    </svg>
                                    <span>Planner Repositories</span>
                                </div>
                            </button>
                            <button id="marketplace-repo-type-knowledge" class="marketplace-repo-type-tab flex-1 px-4 py-2 text-sm font-medium rounded-md text-gray-400 hover:text-white hover:bg-white/10 transition-colors">
                                <div class="flex items-center justify-center gap-2">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                    </svg>
                                    <span>Knowledge Repositories</span>
                                </div>
                            </button>
                        </div>
                        <div class="mt-3 px-2">
                            <p id="marketplace-repo-type-description" class="text-xs text-gray-500">
                                <span id="planner-description" class="">Execution patterns and strategies for proven task completion</span>
                                <span id="knowledge-description" class="hidden">Reference documents and domain knowledge for planning context</span>
                            </p>
                        </div>
                    </div>

                    <!-- Search and Filter Bar -->
                    <div class="glass-panel rounded-xl p-6 mb-6">
                        <div class="flex gap-4 items-end">
                            <div class="flex-1">
                                <label class="block text-sm font-medium text-gray-300 mb-2">Search Collections</label>
                                <input type="text" id="marketplace-search-input" 
                                       placeholder="Search by name or description..."
                                       class="w-full px-4 py-2 bg-white/5 border border-white/10 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-[#F15F22]/50">
                            </div>
                            <div class="w-48">
                                <label class="block text-sm font-medium text-gray-300 mb-2">Sort By</label>
                                <select id="marketplace-sort-filter" 
                                        class="w-full px-4 py-2 bg-white/5 border border-white/10 rounded-lg text-white focus:outline-none focus:border-[#F15F22]/50">
                                    <option value="subscribers">Most Popular</option>
                                    <option value="rating">Top Rated</option>
                                    <option value="recent">Most Recent</option>
                                </select>
                            </div>
                            <div class="w-48">
                                <label class="block text-sm font-medium text-gray-300 mb-2">Visibility</label>
                                <select id="marketplace-visibility-filter" 
                                        class="w-full px-4 py-2 bg-white/5 border border-white/10 rounded-lg text-white focus:outline-none focus:border-[#F15F22]/50">
                                    <option value="public">Public</option>
                                    <option value="unlisted">Unlisted</option>
                                </select>
                            </div>
                            <button id="marketplace-search-btn" 
                                    class="px-6 py-2 bg-[#F15F22] hover:bg-[#D9501A] text-white font-semibold rounded-lg transition-colors">
                                Search
                            </button>
                        </div>
                    </div>

                    <!-- Collections Grid -->
                    <div id="marketplace-collections-container">
                        <!-- Loading state -->
                        <div id="marketplace-loading" class="col-span-full text-center py-12">
                            <div class="inline-block w-8 h-8 border-4 border-[#F15F22]/30 border-t-[#F15F22] rounded-full animate-spin"></div>
                            <p class="text-gray-400 mt-4">Loading marketplace collections...</p>
                        </div>

                        <!-- Empty state -->
                        <div id="marketplace-empty" class="hidden col-span-full text-center py-12">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-gray-500 mx-auto mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" />
                            </svg>
                            <h3 class="text-xl font-semibold text-white mb-2">No Collections Found</h3>
                            <p class="text-gray-400">Try adjusting your search or filters</p>
                        </div>

                        <!-- Collections will be dynamically inserted here -->
                        <div id="marketplace-collections-list" class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3"></div>
                    </div>

                    <!-- Pagination -->
                    <div id="marketplace-pagination" class="hidden mt-8 flex justify-between items-center">
                        <button id="marketplace-prev-btn" 
                                class="px-4 py-2 bg-white/5 hover:bg-white/10 border border-white/10 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                            Previous
                        </button>
                        <span id="marketplace-page-info" class="text-gray-400"></span>
                        <button id="marketplace-next-btn" 
                                class="px-4 py-2 bg-white/5 hover:bg-white/10 border border-white/10 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                            Next
                        </button>
                    </div>
                </div>
            </div>

            <div id="rag-maintenance-view" class="app-view w-full h-full overflow-y-auto">
                <div class="max-w-7xl mx-auto p-8">
                    <div class="mb-6">
                        <h1 class="text-3xl font-bold text-white header-title">Intelligence Performance</h1>
                        <p class="text-sm text-gray-400 mt-1" id="rag-kpi-scope-indicator">Loading...</p>
                    </div>

                    <!-- Admin Global Stats Section (visible only for admins) -->
                    <div id="rag-global-stats" class="hidden mb-8">
                        <div class="glass-panel rounded-xl p-6 border-l-4 border-purple-500">
                            <h2 class="text-xl font-bold text-white mb-4">System-Wide Performance (All Users)</h2>
                            <div class="grid gap-4 md:grid-cols-2">
                                <div>
                                    <p class="text-sm text-gray-400">Total Tokens Saved</p>
                                    <p class="text-2xl font-bold text-purple-400" id="rag-global-tokens-saved">--</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-400">Total Cost Saved</p>
                                    <p class="text-2xl font-bold text-purple-400" id="rag-global-cost-saved">$--</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- User-Specific RAG Impact KPI Cards -->
                    <div class="grid gap-6 md:grid-cols-4 mb-8">
                        <!-- Self-Healing Events Card -->
                        <div class="glass-panel rounded-xl p-6 border-l-4 border-green-500" 
                             title="Champion strategies available for RAG retrieval. These are the most efficient, proven solutions that RAG can inject into new tasks to accelerate execution and prevent errors.">
                            <div class="flex items-start justify-between mb-4">
                                <div class="flex items-center gap-3">
                                    <div class="w-12 h-12 bg-green-500/20 rounded-lg flex items-center justify-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                                        </svg>
                                    </div>
                                    <div>
                                        <h3 class="text-sm font-medium text-gray-400">Champion Strategies</h3>
                                        <p class="text-xs text-gray-500">Available for RAG</p>
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-end justify-between">
                                <div>
                                    <p class="text-4xl font-bold text-white" id="rag-kpi-healing-count">--</p>
                                    <p class="text-xs text-green-400 mt-1 flex items-center gap-1" id="rag-kpi-healing-trend">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                                        </svg>
                                        <span>Loading...</span>
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- RAG Activation Rate Card -->
                        <div class="glass-panel rounded-xl p-6 border-l-4 border-emerald-500"
                             title="Percentage of agent tasks that received RAG assistance. Shows how often champion strategies were retrieved and injected into LLM prompts to guide execution.">
                            <div class="flex items-start justify-between mb-4">
                                <div class="flex items-center gap-3">
                                    <div class="w-12 h-12 bg-emerald-500/20 rounded-lg flex items-center justify-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z" />
                                        </svg>
                                    </div>
                                    <div>
                                        <h3 class="text-sm font-medium text-gray-400">RAG Activation Rate</h3>
                                        <p class="text-xs text-gray-500">Tasks Enhanced</p>
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-end justify-between">
                                <div class="w-full">
                                    <p class="text-4xl font-bold text-white mb-2" id="rag-kpi-activation-rate">--%</p>
                                    <div class="space-y-1">
                                        <div class="flex justify-between text-xs text-gray-400">
                                            <span>RAG-Enhanced:</span>
                                            <span id="rag-kpi-enhanced-count" class="text-emerald-400 font-semibold">--</span>
                                        </div>
                                        <div class="flex justify-between text-xs text-gray-400">
                                            <span>Total Tasks:</span>
                                            <span id="rag-kpi-total-tasks" class="font-semibold">--</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Cost Savings Card -->
                        <div class="glass-panel rounded-xl p-6 border-l-4 border-yellow-500"
                             title="Plan Quality Savings: Champion strategies produce more efficient plans with fewer output tokens. Measured by comparing OUTPUT tokens (generated responses) in RAG-guided vs non-RAG turns. Better plans = less LLM generation = lower output costs.">
                            <div class="flex items-start justify-between mb-4">
                                <div class="flex items-center gap-3">
                                    <div class="w-12 h-12 bg-yellow-500/20 rounded-lg flex items-center justify-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-yellow-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                        </svg>
                                    </div>
                                    <div>
                                        <h3 class="text-sm font-medium text-gray-400">Plan Quality</h3>
                                        <p class="text-xs text-gray-500">Output Token Efficiency</p>
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-end justify-between">
                                <div>
                                    <p class="text-4xl font-bold text-white" id="rag-kpi-cost-savings">$--</p>
                                    <p class="text-xs text-gray-400 mt-1" id="rag-kpi-tokens-saved">-- tokens saved</p>
                                </div>
                            </div>
                        </div>

                        <!-- Performance Improvement Card -->
                        <div class="glass-panel rounded-xl p-6 border-l-4 border-blue-500"
                             title="Speed improvement estimated from token efficiency. When RAG reduces tokens by X%, execution is typically X% faster due to fewer LLM calls and shorter responses. Based on measured efficiency gains from your actual RAG-guided sessions.">
                            <div class="flex items-start justify-between mb-4">
                                <div class="flex items-center gap-3">
                                    <div class="w-12 h-12 bg-blue-500/20 rounded-lg flex items-center justify-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z" />
                                        </svg>
                                    </div>
                                    <div>
                                        <h3 class="text-sm font-medium text-gray-400">Speed Boost</h3>
                                        <p class="text-xs text-gray-500">From Token Efficiency</p>
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-end justify-between">
                                <div class="w-full">
                                    <p class="text-4xl font-bold text-white mb-2" id="rag-kpi-speed-improvement">--%</p>
                                    <div class="space-y-1">
                                        <div class="flex items-center justify-between text-xs">
                                            <span class="text-gray-400">With RAG:</span>
                                            <span class="text-green-400 font-medium" id="rag-kpi-speed-with">--s</span>
                                        </div>
                                        <div class="flex items-center justify-between text-xs">
                                            <span class="text-gray-400">Without RAG:</span>
                                            <span class="text-gray-400" id="rag-kpi-speed-without">--s</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Separator between Dashboard and Repository Tabs -->
                    <div class="my-8 border-t border-white/10"></div>

                    <!-- Repository Tabs -->
                    <div class="mb-6">
                        <div class="flex border-b border-gray-700 mb-6">
                            <button id="planner-repo-tab" class="repository-tab px-6 py-3 font-medium text-sm border-b-2 border-[#F15F22] text-[#F15F22] transition-colors">
                                Planner Repositories
                            </button>
                            <button id="knowledge-repo-tab" class="repository-tab px-6 py-3 font-medium text-sm border-b-2 border-transparent text-gray-400 hover:text-gray-300 transition-colors">
                                Knowledge Repositories
                            </button>
                        </div>

                        <!-- Planner Repositories Tab Content -->
                        <div id="planner-repo-content" class="repository-tab-content">
                            <!-- Planner Repositories Section -->
                            <div class="mb-6">
                                <h2 class="text-2xl font-bold text-white">Planner Repositories</h2>
                                <p class="text-sm text-gray-400 mt-1">Execution strategies and planning patterns captured from successful agent interactions</p>
                            </div>
                            <div id="rag-maintenance-collections-container" class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
                                <!-- Dynamic ChromaDB collection cards will be injected here -->
                                <div class="col-span-full text-gray-400 text-sm" id="rag-maintenance-empty-hint">Loading collections...</div>
                            </div>

                            <!-- Separator between Repositories and Constructors -->
                            <div class="my-8 border-t border-white/10"></div>

                            <!-- Planner Repository Constructors Section -->
                            <div class="mb-6">
                                <div class="mb-4">
                                    <h2 class="text-2xl font-bold text-white">Planner Repository Constructors</h2>
                                    <p class="text-sm text-gray-400 mt-1">Populate Planner Repositories using predefined templates</p>
                                </div>
                                
                                <!-- Template Cards (dynamically loaded) -->
                                <div id="rag-templates-container" class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
                                    <!-- Templates will be dynamically loaded here -->
                                </div>
                            </div>
                        </div>

                        <!-- Knowledge Repositories Tab Content -->
                        <div id="knowledge-repo-content" class="repository-tab-content hidden">
                            <!-- Knowledge Repositories Section -->
                            <div class="mb-6">
                                <h2 class="text-2xl font-bold text-white">Knowledge Repositories</h2>
                                <p class="text-sm text-gray-400 mt-1">General documents and reference materials accessible to the planner via RAG</p>
                            </div>
                            <div id="knowledge-repositories-container" class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3 mb-6">
                                <!-- Knowledge repositories will be populated here -->
                            </div>

                            <!-- Separator between Repositories and Constructors -->
                            <div class="my-8 border-t border-white/10"></div>

                            <!-- Knowledge Repository Constructors Section -->
                            <div class="mb-6">
                                <div class="mb-4">
                                    <h2 class="text-2xl font-bold text-white">Knowledge Repository Constructors</h2>
                                    <p class="text-sm text-gray-400 mt-1">Build Knowledge Repositories from documents and reference materials</p>
                                </div>
                                
                                <!-- Constructor Cards -->
                                <div id="knowledge-constructors-container" class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
                                    <!-- Knowledge constructors will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW 2B: Knowledge Collection Inspection -->
            <div id="rag-collection-inspect-view" class="app-view w-full h-full p-8">
                <div class="max-w-7xl mx-auto flex flex-col h-full">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center gap-4">
                            <button id="rag-collection-inspect-back" type="button" class="px-3 py-2 rounded-md bg-gray-700 hover:bg-gray-600 text-sm text-gray-200">Back</button>
                            <h1 id="rag-collection-inspect-title" class="text-2xl font-bold text-white header-title">Inspect Collection</h1>
                        </div>
                        <div class="flex items-center gap-3">
                            <input id="rag-collection-search-input" type="text" placeholder="Search (min 3 chars)..." class="w-64 p-2 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-teradata-orange focus:border-teradata-orange outline-none text-sm" />
                            <button id="rag-collection-refresh" type="button" class="px-3 py-2 rounded-md bg-[#F15F22] hover:bg-[#D9501A] text-sm text-white">Refresh Sample</button>
                        </div>
                    </div>
                    <!-- Knowledge Repository Metadata Section (hidden by default) -->
                    <div id="knowledge-repo-metadata" class="hidden mb-4">
                        <div class="glass-panel rounded-xl p-4">
                            <p id="knowledge-meta-description" class="text-gray-400 text-sm mb-4"></p>
                            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-8 gap-3">
                                <div class="bg-gray-800/50 p-3 rounded-lg">
                                    <div class="text-xs text-gray-400 mb-1">Documents</div>
                                    <div class="text-white text-sm font-medium" id="knowledge-meta-doc-count">
                                        <svg class="animate-spin h-4 w-4 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                        </svg>
                                    </div>
                                </div>
                                <div class="bg-gray-800/50 p-3 rounded-lg">
                                    <div class="text-xs text-gray-400 mb-1">Chunking Strategy</div>
                                    <div class="text-white text-sm font-medium" id="knowledge-meta-chunking">-</div>
                                </div>
                                <div class="bg-gray-800/50 p-3 rounded-lg">
                                    <div class="text-xs text-gray-400 mb-1">Embedding Model</div>
                                    <div class="text-white text-sm font-medium" id="knowledge-meta-embedding">-</div>
                                </div>
                                <div class="bg-gray-800/50 p-3 rounded-lg">
                                    <div class="text-xs text-gray-400 mb-1">Chunk Size</div>
                                    <div class="text-white text-sm font-medium" id="knowledge-meta-chunk-size">-</div>
                                </div>
                                <div class="bg-gray-800/50 p-3 rounded-lg">
                                    <div class="text-xs text-gray-400 mb-1">Chunk Overlap</div>
                                    <div class="text-white text-sm font-medium" id="knowledge-meta-overlap">-</div>
                                </div>
                                <div class="bg-gray-800/50 p-3 rounded-lg">
                                    <div class="text-xs text-gray-400 mb-1">Created</div>
                                    <div class="text-white text-sm font-medium" id="knowledge-meta-created">-</div>
                                </div>
                                <div class="bg-gray-800/50 p-3 rounded-lg">
                                    <div class="text-xs text-gray-400 mb-1">Repository ID</div>
                                    <div class="text-white text-xs font-mono" id="knowledge-meta-id">-</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="rag-collection-table-wrapper" class="min-h-0 flex flex-col glass-panel rounded-xl p-4">
                        <div id="rag-collection-loading" class="text-gray-400 text-sm mb-2">Loading rows...</div>
                        <div class="overflow-auto" style="max-height: 40vh;">
                            <table class="min-w-full text-sm">
                                <thead class="sticky top-0 bg-gray-800">
                                    <tr class="whitespace-nowrap">
                                        <th class="px-2 py-2 text-left text-gray-300 font-semibold cursor-pointer hover:text-white hover:bg-gray-700/50 transition-colors" data-sort-key="id">ID <span class="text-xs text-gray-500"></span></th>
                                        <th class="px-2 py-2 text-left text-gray-300 font-semibold cursor-pointer hover:text-white hover:bg-gray-700/50 transition-colors" data-sort-key="user_query">User Query <span class="text-xs text-gray-500"></span></th>
                                        <th class="px-2 py-2 text-left text-gray-300 font-semibold cursor-pointer hover:text-white hover:bg-gray-700/50 transition-colors" data-sort-key="strategy_type">Strategy <span class="text-xs text-gray-500"></span></th>
                                        <th class="px-2 py-2 text-left text-gray-300 font-semibold cursor-pointer hover:text-white hover:bg-gray-700/50 transition-colors" data-sort-key="is_most_efficient">Efficient <span class="text-xs text-gray-500"></span></th>
                                        <th class="px-2 py-2 text-left text-gray-300 font-semibold cursor-pointer hover:text-white hover:bg-gray-700/50 transition-colors" data-sort-key="user_feedback_score">Feedback <span class="text-xs text-gray-500"></span></th>
                                        <th class="px-2 py-2 text-left text-gray-300 font-semibold cursor-pointer hover:text-white hover:bg-gray-700/50 transition-colors" data-sort-key="output_tokens">Output Tokens <span class="text-xs text-gray-500"></span></th>
                                        <th class="px-2 py-2 text-left text-gray-300 font-semibold cursor-pointer hover:text-white hover:bg-gray-700/50 transition-colors" data-sort-key="timestamp">Timestamp <span class="text-xs text-gray-500"></span></th>
                                    </tr>
                                </thead>
                                <tbody id="rag-collection-table-body"></tbody>
                            </table>
                        </div>
                        <div id="rag-collection-footer" class="mt-2 text-xs text-gray-500"></div>
                    </div>
                    <!-- Visible separator shown once a case is selected -->
                    <div id="rag-selected-case-separator" class="hidden my-6 border-t border-white/10"></div>
                    <div id="rag-selected-case-details" class="mt-4 hidden glass-panel rounded-xl p-4">
                        <h2 class="text-lg font-bold text-white mb-2">Selected Case Details</h2>
                        <div id="rag-selected-case-metadata" class="text-xs text-gray-400 mb-3"></div>
                        <div id="rag-selected-case-plan" class="mb-4"></div>
                        <div id="rag-selected-case-trace" class="space-y-2"></div>
                    </div>
                </div>
            </div>

            <!-- --- MODIFICATION START: Add Credentials View --- -->
            <!-- MODIFICATION: No longer the default active view -->
            <div id="credentials-view" class="app-view w-full h-full flex flex-col p-6">
                <div class="w-full max-w-7xl mx-auto flex flex-col h-full">
                    <!-- Page Header -->
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-3xl font-bold text-white">Configuration</h2>
                    </div>

                    <!-- Tab Navigation -->
                    <div class="flex gap-2 border-b border-white/10 mb-6">
                        <button class="config-tab active px-6 py-3 text-sm font-medium transition-all border-b-2 border-[#F15F22] text-white" data-tab="mcp-servers-tab">
                            <div class="flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9V3m-3.516 6.636a9 9 0 015.032 0" />
                                </svg>
                                MCP Servers
                            </div>
                        </button>
                        <button class="config-tab px-6 py-3 text-sm font-medium text-gray-400 hover:text-white transition-all border-b-2 border-transparent hover:border-white/20" data-tab="llm-providers-tab">
                            <div class="flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
                                </svg>
                                LLM Providers
                            </div>
                        </button>
                        <button class="config-tab px-6 py-3 text-sm font-medium text-gray-400 hover:text-white transition-all border-b-2 border-transparent hover:border-white/20" data-tab="profiles-tab">
                            <div class="flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                </svg>
                                Profiles
                            </div>
                        </button>
                        <button class="config-tab px-6 py-3 text-sm font-medium text-gray-400 hover:text-white transition-all border-b-2 border-transparent hover:border-white/20" data-tab="advanced-tab">
                            <div class="flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
                                </svg>
                                Advanced
                            </div>
                        </button>
                    </div>

                    <!-- Tab Content Container -->
                    <div class="flex-1 overflow-y-auto">
                        <!-- Tab 1: MCP Servers -->
                        <div id="mcp-servers-tab" class="config-tab-content active">
                            <div class="space-y-6">
                                            <!-- Section 1: MCP Servers -->
                                <div class="glass-panel rounded-xl p-6">
                                    <div class="flex justify-between items-center mb-6">
                                        <div>
                                            <h3 class="text-xl font-bold text-white">Configure MCP Servers</h3>
                                            <p class="text-sm text-gray-400 mt-1">Model-Context-Protocol servers provide access to your data sources</p>
                                        </div>
                                        <button type="button" id="add-mcp-server-btn" class="px-4 py-2 bg-[#F15F22] hover:bg-[#D9501A] rounded-md transition-colors text-white font-medium text-sm">
                                            + Add Server
                                        </button>
                                    </div>
                                    <div id="mcp-servers-container" class="space-y-4">
                                        <!-- MCP server cards will be dynamically added here -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tab 2: LLM Providers -->
                        <div id="llm-providers-tab" class="config-tab-content hidden">
                            <div class="space-y-6">
                                <!-- Section 2: LLM Providers -->
                                <div class="glass-panel rounded-xl p-6">
                                    <div class="flex justify-between items-center mb-6">
                                        <div>
                                            <h3 class="text-xl font-bold text-white">Configure LLM Providers</h3>
                                            <p class="text-sm text-gray-400 mt-1">Create and manage LLM configurations with different models and credentials</p>
                                        </div>
                                        <button type="button" id="add-llm-config-btn" class="px-4 py-2 bg-[#F15F22] hover:bg-[#D9501A] rounded-md transition-colors text-white font-medium text-sm">
                                            + Add Configuration
                                        </button>
                                    </div>
                                    <div id="llm-providers-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                        <!-- LLM configuration cards will be dynamically added here -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tab 3: Profiles -->
                        <div id="profiles-tab" class="config-tab-content hidden">
                            <div class="space-y-6">
                                <div class="glass-panel rounded-xl p-6">
                                    <div class="flex justify-between items-center mb-6">
                                        <div>
                                            <h3 class="text-xl font-bold text-white">Configure Profiles</h3>
                                            <p class="text-sm text-gray-400 mt-1">Create and manage profiles for different configurations</p>
                                        </div>
                                                        <div class="flex items-center gap-2">
                                                            <button type="button" id="test-all-profiles-btn" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-md transition-colors text-white font-medium text-sm">
                                                                Test All Profiles
                                                            </button>
                                                            <button type="button" id="add-profile-btn" class="px-4 py-2 bg-[#F15F22] hover:bg-[#D9501A] rounded-md transition-colors text-white font-medium text-sm">
                                                                + Add Profile
                                                            </button>
                                                        </div>                                    </div>
                                    <div id="profiles-container" class="space-y-4">
                                        <!-- Profile cards will be dynamically added here -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tab 4: Advanced Settings -->
                        <div id="advanced-tab" class="config-tab-content hidden">
                            <div class="space-y-6">
                                <!-- Section 3: Optional Services -->
                                <div class="glass-panel rounded-xl p-6">
                                    <div class="mb-6">
                                        <h3 class="text-xl font-bold text-white">Advanced Settings</h3>
                                        <p class="text-sm text-gray-400 mt-1">Configure optional features and services</p>
                                    </div>
                                    <div class="space-y-6">
                                        <div>
                                            <label for="charting-intensity" class="block text-sm font-medium text-gray-300 mb-2">Charting Intensity</label>
                                            <select id="charting-intensity" name="charting_intensity" class="w-full max-w-md p-2 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-teradata-orange focus:border-teradata-orange outline-none">
                                                <option value="none" selected>No Charting</option>
                                                <option value="medium">Medium Charting</option>
                                                <option value="heavy">Heavy Charting</option>
                                            </select>
                                        </div>
                                        <div class="pt-4 border-t border-white/10">
                                            <details>
                                                <summary class="text-sm font-medium text-gray-300 cursor-pointer hover:text-white mb-2">Configure Google TTS</summary>
                                                <div class="mt-4">
                                                    <label for="tts-credentials-json" class="block text-sm font-medium text-gray-400 mb-2">Google TTS Credentials JSON (Optional)</label>
                                                    <textarea id="tts-credentials-json" name="tts_credentials_json" rows="4" class="w-full max-w-2xl p-3 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-teradata-orange focus:border-teradata-orange outline-none text-sm font-mono" placeholder="Paste credentials.json content here. Leave blank to use server environment variable."></textarea>
                                                </div>
                                            </details>
                                        </div>
                                        <!-- Access Token Management -->
                                        <div class="pt-6 border-t border-white/10 mt-6">
                                            <div class="flex items-center justify-between mb-4">
                                                <div>
                                                    <h4 class="text-sm font-medium text-gray-300 mb-1">Access Token Management</h4>
                                                    <p class="text-xs text-gray-500">Create and manage API tokens for REST API authentication</p>
                                                </div>
                                                <button id="create-access-token-btn" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white text-sm font-medium rounded-md transition-colors flex items-center gap-2">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
                                                    </svg>
                                                    Create Token
                                                </button>
                                            </div>

                                            <!-- Tokens List -->
                                            <div id="access-tokens-list" class="space-y-2">
                                                <!-- Tokens will be dynamically inserted here -->
                                                <div class="text-center text-gray-500 text-sm py-4">Loading tokens...</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Action Button - Always Visible -->
                    <div class="glass-panel rounded-xl p-6 mt-6 flex-shrink-0">
                        <div id="config-action-buttons" class="flex gap-3">
                            <button id="reconnect-and-load-btn" type="button" disabled class="flex-1 px-6 py-3 rounded-md bg-gray-600 transition-colors font-medium flex items-center justify-center text-white disabled:opacity-50 disabled:cursor-not-allowed enabled:bg-gray-700 enabled:hover:bg-gray-600">
                            <!-- Cogwheel Icon (spins during connection) -->
                            <svg id="reconnect-loading-spinner" class="w-5 h-5 mr-2 hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                                <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                            </svg>
                            <span id="reconnect-button-text">Save & Connect</span>
                        </button>
                        </div>
                        <div id="reconnect-status" class="text-sm min-h-[1.25rem] mt-4 text-center"></div>
                    </div>
                </div>
            </div>
            <!-- --- MODIFICATION END: Credentials View --- -->

            <!-- VIEW: Administration -->
            <div id="admin-view" class="app-view w-full h-full flex flex-col p-6">
                <div class="w-full max-w-7xl mx-auto flex flex-col h-full">
                    <!-- Page Header -->
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-3xl font-bold text-white">Administration</h2>
                    </div>

                    <!-- Tab Navigation -->
                    <div class="flex gap-2 border-b border-white/10 mb-6">
                        <button class="admin-tab active px-6 py-3 text-sm font-medium transition-all border-b-2 border-[#F15F22] text-white" data-tab="user-management-tab">
                            <div class="flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
                                </svg>
                                User Management
                            </div>
                        </button>
                        <button class="admin-tab px-6 py-3 text-sm font-medium text-gray-400 hover:text-white transition-all border-b-2 border-transparent hover:border-white/20" data-tab="pane-config-tab">
                            <div class="flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M4 5a1 1 0 011-1h4a1 1 0 011 1v7a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM14 5a1 1 0 011-1h4a1 1 0 011 1v7a1 1 0 01-1 1h-4a1 1 0 01-1-1V5zM4 16a1 1 0 011-1h4a1 1 0 011 1v3a1 1 0 01-1 1H5a1 1 0 01-1-1v-3zM14 16a1 1 0 011-1h4a1 1 0 011 1v3a1 1 0 01-1 1h-4a1 1 0 01-1-1v-3z" />
                                </svg>
                                Pane Configuration
                            </div>
                        </button>
                        <button class="admin-tab px-6 py-3 text-sm font-medium text-gray-400 hover:text-white transition-all border-b-2 border-transparent hover:border-white/20" data-tab="feature-config-tab">
                            <div class="flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                                </svg>
                                Feature Configuration
                            </div>
                        </button>
                        <button class="admin-tab px-6 py-3 text-sm font-medium text-gray-400 hover:text-white transition-all border-b-2 border-transparent hover:border-white/20" data-tab="consumption-profiles-tab">
                            <div class="flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                                </svg>
                                Consumption Profiles
                            </div>
                        </button>
                        <button class="admin-tab px-6 py-3 text-sm font-medium text-gray-400 hover:text-white transition-all border-b-2 border-transparent hover:border-white/20" data-tab="app-config-tab">
                            <div class="flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                </svg>
                                Application Configuration
                            </div>
                        </button>
                        <button class="admin-tab px-6 py-3 text-sm font-medium text-gray-400 hover:text-white transition-all border-b-2 border-transparent hover:border-white/20" data-tab="expert-settings-tab">
                            <div class="flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4" />
                                </svg>
                                Expert Settings
                            </div>
                        </button>
                        <button class="admin-tab px-6 py-3 text-sm font-medium text-gray-400 hover:text-white transition-all border-b-2 border-transparent hover:border-white/20" data-tab="system-prompts-tab">
                            <div class="flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                </svg>
                                System Prompts
                            </div>
                        </button>
                        <button class="admin-tab px-6 py-3 text-sm font-medium text-gray-400 hover:text-white transition-all border-b-2 border-transparent hover:border-white/20" data-tab="cost-management-tab">
                            <div class="flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                Cost
                            </div>
                        </button>
                    </div>

                    <!-- Tab Content Container -->
                    <div class="flex-1 overflow-y-auto">
                        <!-- Tab 1: User Management -->
                        <div id="user-management-tab" class="admin-tab-content active">
                            <!-- Sub-Tab Navigation -->
                            <div class="flex gap-2 mb-6">
                                <button class="user-management-subtab active flex items-center gap-2 px-6 py-3 font-medium text-sm rounded-lg bg-[#F15F22] text-white transition-colors" data-subtab="user-tier-subtab">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                                    User Tiers
                                </button>
                                <button class="user-management-subtab flex items-center gap-2 px-6 py-3 font-medium text-sm rounded-lg bg-gray-700/50 text-gray-400 hover:bg-gray-700 hover:text-gray-300 transition-colors" data-subtab="user-consumption-subtab">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>
                                    User Consumption
                                </button>
                            </div>

                            <!-- Sub-Tab: User Tiers -->
                            <div id="user-tier-subtab" class="user-management-subtab-content active">
                            <div class="space-y-6">
                                <div class="glass-panel rounded-xl p-6">
                                    <div class="flex justify-between items-center mb-6">
                                        <div>
                                            <h3 class="text-xl font-bold text-white">User Tier Management</h3>
                                            <p class="text-sm text-gray-400 mt-1">Assign users to profile tiers (User, Developer, Admin)</p>
                                        </div>
                                        <div class="flex gap-2">
                                            <button type="button" id="create-user-btn" class="px-4 py-2 bg-green-600 hover:bg-green-700 rounded-md transition-colors text-white font-medium text-sm">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
                                                </svg>
                                                Create User
                                            </button>
                                            <button type="button" id="refresh-users-btn" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-md transition-colors text-white font-medium text-sm">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                                </svg>
                                                Refresh
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- Users Table -->
                                    <div class="overflow-x-auto">
                                        <table class="w-full text-sm text-left">
                                            <thead class="text-xs uppercase bg-gray-700/50 text-gray-400">
                                                <tr>
                                                    <th class="px-6 py-3">Username</th>
                                                    <th class="px-6 py-3">Email</th>
                                                    <th class="px-6 py-3">Current Tier</th>
                                                    <th class="px-6 py-3">Consumption Profile</th>
                                                    <th class="px-6 py-3">Features</th>
                                                    <th class="px-6 py-3">Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="users-table-body" class="divide-y divide-gray-700">
                                                <!-- Users will be dynamically loaded here -->
                                                <tr>
                                                    <td colspan="5" class="px-6 py-8 text-center text-gray-400">
                                                        <svg class="animate-spin h-8 w-8 mx-auto mb-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                                        </svg>
                                                        Loading users...
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <!-- Tier Statistics -->
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div class="glass-panel rounded-xl p-6">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <p class="text-sm text-gray-400">User Tier</p>
                                                <p id="user-tier-count" class="text-3xl font-bold text-white mt-2">0</p>
                                            </div>
                                            <div class="p-3 bg-blue-500/20 rounded-lg">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                                </svg>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="glass-panel rounded-xl p-6">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <p class="text-sm text-gray-400">Developer Tier</p>
                                                <p id="developer-tier-count" class="text-3xl font-bold text-white mt-2">0</p>
                                            </div>
                                            <div class="p-3 bg-purple-500/20 rounded-lg">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-purple-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
                                                </svg>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="glass-panel rounded-xl p-6">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <p class="text-sm text-gray-400">Admin Tier</p>
                                                <p id="admin-tier-count" class="text-3xl font-bold text-white mt-2">0</p>
                                            </div>
                                            <div class="p-3 bg-red-500/20 rounded-lg">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                                                </svg>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            </div>

                            <!-- Sub-Tab: User Consumption -->
                            <div id="user-consumption-subtab" class="user-management-subtab-content hidden">
                                <div class="space-y-6">
                                    <div class="glass-panel rounded-xl p-6">
                                        <div class="flex justify-between items-center mb-6">
                                            <div>
                                                <h3 class="text-xl font-bold text-white">User Token Consumption</h3>
                                                <p class="text-sm text-gray-400 mt-1">Monitor and manage user token usage and consumption profiles</p>
                                            </div>
                                            <button type="button" id="refresh-consumption-btn" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-md transition-colors text-white font-medium text-sm">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                                </svg>
                                                Refresh
                                            </button>
                                        </div>

                                        <!-- Consumption Table -->
                                        <div class="overflow-x-auto">
                                            <table class="w-full text-sm text-left">
                                                <thead class="text-xs uppercase bg-gray-700/50 text-gray-400">
                                                    <tr>
                                                        <th class="px-6 py-3 cursor-pointer hover:text-white transition-colors" data-sort="username">
                                                            <div class="flex items-center gap-1">
                                                                Username
                                                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"></path>
                                                                </svg>
                                                            </div>
                                                        </th>
                                                        <th class="px-6 py-3">Consumption Profile</th>
                                                        <th class="px-6 py-3 cursor-pointer hover:text-white transition-colors" data-sort="tokens_used_today">
                                                            <div class="flex items-center gap-1">
                                                                Tokens Used Today
                                                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"></path>
                                                                </svg>
                                                            </div>
                                                        </th>
                                                        <th class="px-6 py-3">Daily Limit</th>
                                                        <th class="px-6 py-3 cursor-pointer hover:text-white transition-colors" data-sort="usage_percentage">
                                                            <div class="flex items-center gap-1">
                                                                Usage %
                                                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"></path>
                                                                </svg>
                                                            </div>
                                                        </th>
                                                        <th class="px-6 py-3">Status</th>
                                                        <th class="px-6 py-3 text-center">Actions</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="user-consumption-table-body" class="divide-y divide-gray-700">
                                                    <!-- Consumption data will be loaded here -->
                                                    <tr>
                                                        <td colspan="7" class="px-6 py-8 text-center text-gray-400">
                                                            <svg class="animate-spin h-8 w-8 mx-auto mb-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                                            </svg>
                                                            Loading consumption data...
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    <!-- Consumption Statistics -->
                                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                        <div class="glass-panel rounded-xl p-6">
                                            <h4 class="text-sm font-medium text-gray-400 mb-3">Total Input Tokens</h4>
                                            <p id="consumption-total-input-tokens" class="text-2xl font-bold text-blue-400">0</p>
                                            <p id="consumption-period-label-1" class="text-xs text-gray-500 mt-1">December 2025</p>
                                        </div>
                                        <div class="glass-panel rounded-xl p-6">
                                            <h4 class="text-sm font-medium text-gray-400 mb-3">Total Output Tokens</h4>
                                            <p id="consumption-total-output-tokens" class="text-2xl font-bold text-purple-400">0</p>
                                            <p id="consumption-period-label-2" class="text-xs text-gray-500 mt-1">December 2025</p>
                                        </div>
                                        <div class="glass-panel rounded-xl p-6">
                                            <h4 class="text-sm font-medium text-gray-400 mb-3">Active Users</h4>
                                            <p id="consumption-active-users-count" class="text-2xl font-bold text-green-400">0</p>
                                            <p id="consumption-period-label-3" class="text-xs text-gray-500 mt-1">With token usage</p>
                                        </div>
                                        <div class="glass-panel rounded-xl p-6">
                                            <h4 class="text-sm font-medium text-gray-400 mb-3">Avg Tokens/User</h4>
                                            <p id="consumption-avg-tokens-per-user" class="text-2xl font-bold text-orange-400">0</p>
                                            <p id="consumption-period-label-4" class="text-xs text-gray-500 mt-1">December 2025</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tab 2: Feature Configuration -->
                        <div id="feature-config-tab" class="admin-tab-content hidden">
                            <div class="space-y-6">
                                <div class="glass-panel rounded-xl p-6">
                                    <div class="flex justify-between items-center mb-6">
                                        <div>
                                            <h3 class="text-xl font-bold text-white">Feature-to-Tier Configuration</h3>
                                            <p class="text-sm text-gray-400 mt-1">Configure which tier is required for each feature</p>
                                        </div>
                                        <div class="flex gap-2">
                                            <button type="button" id="reset-features-btn" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded-md transition-colors text-white font-medium text-sm">
                                                Reset to Defaults
                                            </button>
                                            <button type="button" id="save-features-btn" class="px-4 py-2 bg-[#F15F22] hover:bg-[#D9501A] rounded-md transition-colors text-white font-medium text-sm">
                                                Save Changes
                                            </button>
                                        </div>
                                    </div>

                                    <!-- Feature Configuration Table -->
                                    <div class="mb-6">
                                        <div class="flex items-center gap-4 mb-4">
                                            <input type="text" id="feature-search" placeholder="Search features..." class="flex-1 max-w-md p-2 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-[#F15F22] focus:border-[#F15F22] outline-none text-white">
                                            <select id="feature-filter-tier" class="p-2 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-[#F15F22] focus:border-[#F15F22] outline-none text-white">
                                                <option value="">All Tiers</option>
                                                <option value="user">User Tier</option>
                                                <option value="developer">Developer Tier</option>
                                                <option value="admin">Admin Tier</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div class="overflow-x-auto max-h-[600px] overflow-y-auto">
                                        <table class="w-full text-sm text-left">
                                            <thead class="text-xs uppercase bg-gray-700/50 text-gray-400 sticky top-0">
                                                <tr>
                                                    <th class="px-6 py-3">Feature</th>
                                                    <th class="px-6 py-3">Description</th>
                                                    <th class="px-6 py-3">Required Tier</th>
                                                    <th class="px-6 py-3">Category</th>
                                                </tr>
                                            </thead>
                                            <tbody id="features-table-body" class="divide-y divide-gray-700">
                                                <!-- Features will be dynamically loaded here -->
                                                <tr>
                                                    <td colspan="4" class="px-6 py-8 text-center text-gray-400">
                                                        <svg class="animate-spin h-8 w-8 mx-auto mb-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                                        </svg>
                                                        Loading features...
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <!-- Feature Statistics by Tier -->
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div class="glass-panel rounded-xl p-6">
                                        <h4 class="text-sm font-medium text-gray-400 mb-3">User Tier Features</h4>
                                        <p id="user-features-count" class="text-2xl font-bold text-blue-400">0</p>
                                        <p class="text-xs text-gray-500 mt-1">Basic access features</p>
                                    </div>
                                    <div class="glass-panel rounded-xl p-6">
                                        <h4 class="text-sm font-medium text-gray-400 mb-3">Developer Tier Features</h4>
                                        <p id="developer-features-count" class="text-2xl font-bold text-purple-400">0</p>
                                        <p class="text-xs text-gray-500 mt-1">Advanced features</p>
                                    </div>
                                    <div class="glass-panel rounded-xl p-6">
                                        <h4 class="text-sm font-medium text-gray-400 mb-3">Admin Tier Features</h4>
                                        <p id="admin-features-count" class="text-2xl font-bold text-red-400">0</p>
                                        <p class="text-xs text-gray-500 mt-1">System administration</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tab 3: Pane Configuration -->
                        <div id="pane-config-tab" class="admin-tab-content hidden">
                            <div class="space-y-6">
                                <div class="glass-panel rounded-xl p-6">
                                    <div class="flex justify-between items-center mb-6">
                                        <div>
                                            <h3 class="text-xl font-bold text-white">Pane Visibility Configuration</h3>
                                            <p class="text-sm text-gray-400 mt-1">Configure which tiers can access which panes</p>
                                        </div>
                                        <div class="flex gap-2">
                                            <button type="button" id="reset-panes-btn" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded-md transition-colors text-white font-medium text-sm">
                                                Reset to Defaults
                                            </button>
                                            <button type="button" id="refresh-panes-btn" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-md transition-colors text-white font-medium text-sm">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                                </svg>
                                                Refresh
                                            </button>
                                        </div>
                                    </div>

                                    <!-- Pane Configuration Table -->
                                    <div class="overflow-x-auto">
                                        <table class="w-full text-sm text-left">
                                            <thead class="text-xs uppercase bg-gray-700/50 text-gray-400">
                                                <tr>
                                                    <th class="px-6 py-3">Pane Name</th>
                                                    <th class="px-6 py-3">Description</th>
                                                    <th class="px-6 py-3 text-center">
                                                        <div class="flex items-center justify-center gap-2">
                                                            <span class="inline-block w-2 h-2 rounded-full bg-blue-400"></span>
                                                            User
                                                        </div>
                                                    </th>
                                                    <th class="px-6 py-3 text-center">
                                                        <div class="flex items-center justify-center gap-2">
                                                            <span class="inline-block w-2 h-2 rounded-full bg-purple-400"></span>
                                                            Developer
                                                        </div>
                                                    </th>
                                                    <th class="px-6 py-3 text-center">
                                                        <div class="flex items-center justify-center gap-2">
                                                            <span class="inline-block w-2 h-2 rounded-full bg-red-400"></span>
                                                            Admin
                                                        </div>
                                                    </th>
                                                </tr>
                                            </thead>
                                            <tbody id="panes-table-body" class="divide-y divide-gray-700">
                                                <!-- Panes will be dynamically loaded here -->
                                                <tr>
                                                    <td colspan="5" class="px-6 py-8 text-center text-gray-400">
                                                        <svg class="animate-spin h-8 w-8 mx-auto mb-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                                        </svg>
                                                        Loading panes...
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <!-- Info Panel -->
                                <div class="glass-panel rounded-xl p-6">
                                    <div class="flex items-start gap-3">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-400 flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                        </svg>
                                        <div>
                                            <h4 class="text-sm font-bold text-white mb-2">About Pane Visibility</h4>
                                            <p class="text-sm text-gray-400 mb-3">Control which user tiers can see and access different panes in the application. Users will only see panes they have access to based on their assigned tier.</p>
                                            <ul class="text-sm text-gray-400 space-y-1 list-disc list-inside">
                                                <li><span class="text-blue-400 font-semibold">User Tier</span>: Basic users with limited access</li>
                                                <li><span class="text-purple-400 font-semibold">Developer Tier</span>: Advanced users with development features</li>
                                                <li><span class="text-red-400 font-semibold">Admin Tier</span>: Full system access and administration</li>
                                            </ul>
                                            <p class="text-xs text-gray-500 mt-3">Note: The Administration pane is always visible to admins only.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tab 4: Consumption Profiles -->
                        <div id="consumption-profiles-tab" class="admin-tab-content hidden">
                            <div class="space-y-6">
                                <div class="glass-panel rounded-xl p-6">
                                    <div class="flex justify-between items-center mb-6">
                                        <div>
                                            <h3 class="text-xl font-bold text-white">Consumption Profiles</h3>
                                            <p class="text-sm text-gray-400 mt-1">Configure token limits and rate limiting for different user tiers</p>
                                        </div>
                                        <button type="button" id="create-profile-btn" class="px-4 py-2 bg-[#F15F22] hover:bg-[#D9501A] rounded-md transition-colors text-white font-medium text-sm">
                                            + Create Profile
                                        </button>
                                    </div>

                                    <!-- Profiles Table -->
                                    <div class="overflow-x-auto">
                                        <table class="w-full text-sm text-left">
                                            <thead class="text-xs uppercase bg-gray-700/50 text-gray-400">
                                                <tr>
                                                    <th class="px-6 py-3">Profile Name</th>
                                                    <th class="px-6 py-3">Description</th>
                                                    <th class="px-6 py-3 text-center">Prompts/Hour</th>
                                                    <th class="px-6 py-3 text-center">Prompts/Day</th>
                                                    <th class="px-6 py-3 text-center">Input Tokens/Month</th>
                                                    <th class="px-6 py-3 text-center">Output Tokens/Month</th>
                                                    <th class="px-6 py-3 text-center">Users</th>
                                                    <th class="px-6 py-3 text-center">Active</th>
                                                    <th class="px-6 py-3 text-center">Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="profiles-table-body" class="divide-y divide-gray-700">
                                                <!-- Profiles will be dynamically loaded here -->
                                                <tr>
                                                    <td colspan="5" class="px-6 py-8 text-center text-gray-400">
                                                        <svg class="animate-spin h-8 w-8 mx-auto mb-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                                        </svg>
                                                        Loading profiles...
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <!-- Profile Statistics -->
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div class="glass-panel rounded-xl p-6">
                                        <h4 class="text-sm font-medium text-gray-400 mb-3">Total Profiles</h4>
                                        <p id="total-profiles-count" class="text-2xl font-bold text-blue-400">0</p>
                                        <p class="text-xs text-gray-500 mt-1">Configured consumption profiles</p>
                                    </div>
                                    <div class="glass-panel rounded-xl p-6">
                                        <h4 class="text-sm font-medium text-gray-400 mb-3">Active Profiles</h4>
                                        <p id="active-profiles-count" class="text-2xl font-bold text-green-400">0</p>
                                        <p class="text-xs text-gray-500 mt-1">Currently enabled</p>
                                    </div>
                                    <div class="glass-panel rounded-xl p-6">
                                        <h4 class="text-sm font-medium text-gray-400 mb-3">Assigned Users</h4>
                                        <p id="assigned-users-count" class="text-2xl font-bold text-purple-400">0</p>
                                        <p class="text-xs text-gray-500 mt-1">Users with profiles</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tab 5: Application Configuration -->
                        <div id="app-config-tab" class="admin-tab-content hidden">
                            <div class="space-y-6">
                                <!-- MCP Resource Classification -->
                                <div class="glass-panel rounded-xl p-6">
                                    <details class="group">
                                        <summary class="flex justify-between items-center cursor-pointer list-none">
                                            <div class="flex items-center gap-3">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-orange-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
                                                </svg>
                                                <div>
                                                    <h3 class="text-lg font-bold text-white">MCP Resource Classification</h3>
                                                    <p class="text-sm text-gray-400">Configure LLM-based classification of MCP capabilities</p>
                                                </div>
                                            </div>
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 transition-transform group-open:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                                            </svg>
                                        </summary>
                                        <div class="mt-6 pl-9 space-y-4">
                                            <!-- Classification Toggle -->
                                            <div class="p-4 bg-gray-700/50 rounded-lg">
                                                <div class="flex items-start gap-3">
                                                    <input type="checkbox" id="enable-mcp-classification" name="enable_mcp_classification" class="mt-1 w-4 h-4 rounded border-gray-600 bg-gray-700 text-[#F15F22] focus:ring-2 focus:ring-[#F15F22] focus:ring-offset-0" checked>
                                                    <div class="flex-1">
                                                        <label for="enable-mcp-classification" class="block text-sm font-semibold text-white cursor-pointer">Enable Automatic Classification</label>
                                                        <p class="text-xs text-gray-400 mt-1">When enabled, MCP capabilities are automatically categorized during configuration using the LLM (takes 2-10 seconds). When disabled, generic categories like "All Tools" and "All Prompts" are used for faster configuration (90-95% faster).</p>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="flex items-start gap-3 p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-400 flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                </svg>
                                                <div>
                                                    <h4 class="text-sm font-bold text-white mb-2">About Classification</h4>
                                                    <p class="text-sm text-gray-400 mb-2">Uses an LLM to intelligently categorize MCP capabilities into user-friendly groups like "Data Quality", "Table Management", "Performance", etc.</p>
                                                    <ul class="text-sm text-gray-400 space-y-1 list-disc list-inside">
                                                        <li>Improves organization in the configuration UI</li>
                                                        <li>Makes capabilities easier to find and manage</li>
                                                        <li>Requires an active LLM connection</li>
                                                        <li>May take several seconds to complete</li>
                                                    </ul>
                                                </div>
                                            </div>

                                            <div class="flex items-center justify-between p-4 bg-gray-700/50 rounded-lg">
                                                <div>
                                                    <h4 class="text-sm font-semibold text-white mb-1">Classification Status</h4>
                                                    <p id="mcp-classification-status" class="text-sm text-gray-400">Ready to classify</p>
                                                    <p id="mcp-classification-details" class="text-xs text-gray-500 mt-1"></p>
                                                </div>
                                                <button type="button" id="run-mcp-classification-btn" class="px-6 py-3 bg-[#F15F22] hover:bg-[#D9501A] rounded-md transition-colors text-white font-medium text-sm flex items-center gap-2">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                        <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                                    </svg>
                                                    Run Classification
                                                </button>
                                            </div>

                                            <!-- Progress indicator (hidden by default) -->
                                            <div id="mcp-classification-progress" class="hidden p-4 bg-yellow-500/10 border border-yellow-500/30 rounded-lg">
                                                <div class="flex items-center gap-3">
                                                    <svg class="animate-spin h-5 w-5 text-yellow-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                                    </svg>
                                                    <div>
                                                        <p class="text-sm font-medium text-yellow-400">Classification in progress...</p>
                                                        <p class="text-xs text-gray-400 mt-1">This may take a few moments</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </details>
                                </div>

                                <!-- System Feature Availability -->
                                <div class="glass-panel rounded-xl p-6">
                                    <details class="group">
                                        <summary class="flex justify-between items-center cursor-pointer list-none">
                                            <div class="flex items-center gap-3">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                                                </svg>
                                                <div>
                                                    <h3 class="text-lg font-bold text-white">System Feature Availability</h3>
                                                    <p class="text-sm text-gray-400">Control which features are available system-wide</p>
                                                </div>
                                            </div>
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 transition-transform group-open:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                                            </svg>
                                        </summary>
                                        <div class="mt-6 pl-9 space-y-4">
                                            <!-- RAG Toggle -->
                                            <div class="p-4 bg-gray-700/50 rounded-lg">
                                                <div class="flex items-start gap-3">
                                                    <input type="checkbox" id="enable-rag-system" name="enable_rag_system" class="mt-1 w-4 h-4 rounded border-gray-600 bg-gray-700 text-[#F15F22] focus:ring-2 focus:ring-[#F15F22] focus:ring-offset-0">
                                                    <div class="flex-1">
                                                        <label for="enable-rag-system" class="block text-sm font-semibold text-white cursor-pointer">Enable RAG (Retrieval-Augmented Generation)</label>
                                                        <p class="text-xs text-gray-400 mt-1">When enabled, users can leverage RAG capabilities for enhanced context retrieval and knowledge base integration. Requires ChromaDB and vector embeddings.</p>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Voice/TTS Toggle -->
                                            <div class="p-4 bg-gray-700/50 rounded-lg">
                                                <div class="flex items-start gap-3">
                                                    <input type="checkbox" id="enable-voice-system" name="enable_voice_system" class="mt-1 w-4 h-4 rounded border-gray-600 bg-gray-700 text-[#F15F22] focus:ring-2 focus:ring-[#F15F22] focus:ring-offset-0">
                                                    <div class="flex-1">
                                                        <label for="enable-voice-system" class="block text-sm font-semibold text-white cursor-pointer">Enable Voice Conversation (TTS)</label>
                                                        <p class="text-xs text-gray-400 mt-1">When enabled, users can configure Google TTS credentials for voice-based conversations. Users provide their own TTS API credentials in their personal settings.</p>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Charting Toggle -->
                                            <div class="p-4 bg-gray-700/50 rounded-lg">
                                                <div class="flex items-start gap-3">
                                                    <input type="checkbox" id="enable-charting-system" name="enable_charting_system" class="mt-1 w-4 h-4 rounded border-gray-600 bg-gray-700 text-[#F15F22] focus:ring-2 focus:ring-[#F15F22] focus:ring-offset-0">
                                                    <div class="flex-1">
                                                        <label for="enable-charting-system" class="block text-sm font-semibold text-white cursor-pointer">Enable Charting & Visualization</label>
                                                        <p class="text-xs text-gray-400 mt-1">When enabled, users can configure charting intensity (none/medium/heavy) for data visualization. Users control their own charting preferences in personal settings.</p>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Save Button -->
                                            <div class="pt-4 border-t border-white/10">
                                                <button type="button" id="save-app-config-btn" class="px-6 py-3 bg-[#F15F22] hover:bg-[#D9501A] rounded-md transition-colors text-white font-medium text-sm">
                                                    Save Feature Settings
                                                </button>
                                            </div>
                                        </div>
                                    </details>
                                </div>

                                <!-- Security & Rate Limiting -->
                                <div class="glass-panel rounded-xl p-6">
                                    <details class="group">
                                        <summary class="flex justify-between items-center cursor-pointer list-none">
                                            <div class="flex items-center gap-3">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                                                </svg>
                                                <div>
                                                    <h3 class="text-lg font-bold text-white">Security & Rate Limiting</h3>
                                                    <p class="text-sm text-gray-400">Configure system-wide rate limiting and security policies</p>
                                                </div>
                                            </div>
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 transition-transform group-open:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                                            </svg>
                                        </summary>
                                        <div class="mt-6 pl-9 space-y-4">
                                            <!-- Rate Limiting Toggle -->
                                            <div class="p-4 bg-gray-700/50 rounded-lg">
                                                <div class="flex items-start gap-3">
                                                    <input type="checkbox" id="rate-limit-enabled" class="mt-1 w-4 h-4 rounded border-gray-600 bg-gray-700 text-[#F15F22] focus:ring-2 focus:ring-[#F15F22] focus:ring-offset-0">
                                                    <div class="flex-1">
                                                        <label for="rate-limit-enabled" class="block text-sm font-semibold text-white cursor-pointer">Enable Rate Limiting</label>
                                                        <p class="text-xs text-gray-400 mt-1">When enabled, enforces request limits to prevent abuse. Recommended for production and multi-user deployments. Disabled by default for single-user installations.</p>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Global Override Toggle -->
                                            <div class="p-4 bg-gray-700/50 rounded-lg">
                                                <div class="flex items-start gap-3">
                                                    <input type="checkbox" id="rate-limit-global-override" class="mt-1 w-4 h-4 rounded border-gray-600 bg-gray-700 text-orange-500 focus:ring-2 focus:ring-orange-500 focus:ring-offset-0" disabled>
                                                    <div class="flex-1">
                                                        <label for="rate-limit-global-override" class="block text-sm font-semibold text-white cursor-pointer">Global Override</label>
                                                        <p class="text-xs text-gray-400 mt-1">When enabled, the global limits below override individual consumption profile settings for all users. Use for emergency rate limiting.</p>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Rate Limit Settings (visible when enabled) -->
                                            <div id="rate-limit-settings" class="hidden space-y-4">
                                                <!-- User Limits -->
                                                <div class="p-4 bg-gray-700/30 rounded-lg space-y-3">
                                                    <h4 class="text-sm font-bold text-white">Per-User Limits (Authenticated)</h4>
                                                    
                                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                                                        <div>
                                                            <label for="rate-limit-user-prompts-per-hour" class="block text-xs font-medium text-gray-300 mb-1">Prompts per Hour</label>
                                                            <input type="number" id="rate-limit-user-prompts-per-hour" min="1" max="10000" class="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white text-sm focus:ring-2 focus:ring-[#F15F22] focus:border-[#F15F22]" value="100">
                                                        </div>
                                                        <div>
                                                            <label for="rate-limit-user-prompts-per-day" class="block text-xs font-medium text-gray-300 mb-1">Prompts per Day</label>
                                                            <input type="number" id="rate-limit-user-prompts-per-day" min="1" max="100000" class="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white text-sm focus:ring-2 focus:ring-[#F15F22] focus:border-[#F15F22]" value="1000">
                                                        </div>
                                                        <div>
                                                            <label for="rate-limit-user-configs-per-hour" class="block text-xs font-medium text-gray-300 mb-1">Config Changes per Hour</label>
                                                            <input type="number" id="rate-limit-user-configs-per-hour" min="1" max="1000" class="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white text-sm focus:ring-2 focus:ring-[#F15F22] focus:border-[#F15F22]" value="10">
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- IP-based Limits -->
                                                <div class="p-4 bg-gray-700/30 rounded-lg space-y-3">
                                                    <h4 class="text-sm font-bold text-white">Per-IP Limits (Anonymous/Authentication)</h4>
                                                    
                                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                                                        <div>
                                                            <label for="rate-limit-ip-login-per-minute" class="block text-xs font-medium text-gray-300 mb-1">Login Attempts per Minute</label>
                                                            <input type="number" id="rate-limit-ip-login-per-minute" min="1" max="100" class="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white text-sm focus:ring-2 focus:ring-[#F15F22] focus:border-[#F15F22]" value="5">
                                                        </div>
                                                        <div>
                                                            <label for="rate-limit-ip-register-per-hour" class="block text-xs font-medium text-gray-300 mb-1">Registrations per Hour</label>
                                                            <input type="number" id="rate-limit-ip-register-per-hour" min="1" max="100" class="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white text-sm focus:ring-2 focus:ring-[#F15F22] focus:border-[#F15F22]" value="3">
                                                        </div>
                                                        <div>
                                                            <label for="rate-limit-ip-api-per-minute" class="block text-xs font-medium text-gray-300 mb-1">API Calls per Minute</label>
                                                            <input type="number" id="rate-limit-ip-api-per-minute" min="1" max="1000" class="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white text-sm focus:ring-2 focus:ring-[#F15F22] focus:border-[#F15F22]" value="60">
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Info Box -->
                                                <div class="flex items-start gap-3 p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-400 flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                        <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                    </svg>
                                                    <div>
                                                        <h4 class="text-sm font-bold text-white mb-2">About Rate Limiting</h4>
                                                        <p class="text-sm text-gray-400 mb-2">Rate limiting protects your application from abuse and ensures fair resource allocation across users.</p>
                                                        <ul class="text-sm text-gray-400 space-y-1 list-disc list-inside">
                                                            <li>Changes take effect within 60 seconds (cache refresh)</li>
                                                            <li>Authenticated users tracked by user ID, anonymous by IP address</li>
                                                            <li>Uses token bucket algorithm for smooth rate limiting</li>
                                                            <li>Disable for single-user installations or trusted environments</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Save Button -->
                                            <div class="pt-4 border-t border-white/10">
                                                <button type="button" id="save-rate-limit-btn" class="px-6 py-3 bg-[#F15F22] hover:bg-[#D9501A] rounded-md transition-colors text-white font-medium text-sm">
                                                    Save Rate Limit Settings
                                                </button>
                                            </div>
                                        </div>
                                    </details>
                                </div>

                                <!-- Planner Repository Configuration -->
                                <div class="glass-panel rounded-xl p-6">
                                    <details class="group">
                                        <summary class="flex justify-between items-center cursor-pointer list-none">
                                            <div class="flex items-center gap-3">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-yellow-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
                                                </svg>
                                                <div>
                                                    <h3 class="text-lg font-bold text-white">Planner Repository Configuration</h3>
                                                    <p class="text-sm text-gray-400">Few-shot examples for query planning</p>
                                                </div>
                                            </div>
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 transition-transform group-open:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                                            </svg>
                                        </summary>
                                        <div class="mt-6 pl-9 space-y-4">
                                            <div class="p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                                                <div class="flex items-start gap-3">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-400 flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                        <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                    </svg>
                                                    <div>
                                                        <p class="text-sm text-gray-300">The Planner Repository stores few-shot examples of user queries and their corresponding plans. These examples guide the LLM during the planning phase. Changes affect all users.</p>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="p-4 bg-gray-700/50 rounded-lg">
                                                <div class="flex items-start gap-3">
                                                    <input type="checkbox" id="rag-refresh-startup" class="mt-1 w-4 h-4 rounded border-gray-600 bg-gray-700 text-[#F15F22] focus:ring-2 focus:ring-[#F15F22] focus:ring-offset-0">
                                                    <div class="flex-1">
                                                        <label for="rag-refresh-startup" class="block text-sm font-semibold text-white cursor-pointer">Refresh Vector Store on Startup</label>
                                                        <p class="text-xs text-gray-400 mt-1">When enabled, rebuilds the vector store on each application restart. When disabled, uses cached embeddings. (default: enabled)</p>
                                                    </div>
                                                </div>
                                            </div>

                                            <div>
                                                <label for="rag-num-examples" class="block text-sm font-medium text-gray-300 mb-2">Number of Planning Examples to Retrieve</label>
                                                <input type="number" id="rag-num-examples" min="1" max="10" class="w-32 px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white text-sm focus:ring-2 focus:ring-[#F15F22] focus:border-transparent">
                                                <p class="text-xs text-gray-500 mt-1">Total few-shot planning examples retrieved for query planning (default: 3)</p>
                                            </div>

                                            <div>
                                                <label for="rag-embedding-model" class="block text-sm font-medium text-gray-300 mb-2">Embedding Model</label>
                                                <select id="rag-embedding-model" class="w-full max-w-md px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white text-sm focus:ring-2 focus:ring-[#F15F22] focus:border-transparent">
                                                    <option value="all-MiniLM-L6-v2">all-MiniLM-L6-v2 (Fast, 384 dim)</option>
                                                    <option value="all-mpnet-base-v2">all-mpnet-base-v2 (Balanced, 768 dim)</option>
                                                    <option value="paraphrase-multilingual-MiniLM-L12-v2">paraphrase-multilingual-MiniLM-L12-v2 (Multilingual)</option>
                                                </select>
                                                <p class="text-xs text-gray-500 mt-1">Model used for generating embeddings (requires restart to take effect)</p>
                                            </div>
                                        </div>
                                    </details>
                                </div>

                                <!-- Knowledge Repository Configuration -->
                                <div class="glass-panel rounded-xl p-6">
                                    <details class="group">
                                        <summary class="flex justify-between items-center cursor-pointer list-none">
                                            <div class="flex items-center gap-3">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-purple-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                                </svg>
                                                <div>
                                                    <h3 class="text-lg font-bold text-white">Knowledge Repository Configuration</h3>
                                                    <p class="text-sm text-gray-400">Global defaults for domain knowledge retrieval during planning</p>
                                                </div>
                                            </div>
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 transition-transform group-open:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                                            </svg>
                                        </summary>
                                        <div class="mt-6 pl-9 space-y-4">
                                            <div class="p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                                                <div class="flex items-start gap-3">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-400 flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                        <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                    </svg>
                                                    <div>
                                                        <p class="text-sm text-gray-300">Knowledge repositories provide domain-specific context to the planner. These are system-wide defaults; users can override them in their profiles.</p>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="p-4 bg-gray-700/50 rounded-lg">
                                                <div class="flex items-start gap-3">
                                                    <input type="checkbox" id="knowledge-rag-enabled" class="mt-1 w-4 h-4 rounded border-gray-600 bg-gray-700 text-[#F15F22] focus:ring-2 focus:ring-[#F15F22] focus:ring-offset-0">
                                                    <div class="flex-1">
                                                        <label for="knowledge-rag-enabled" class="block text-sm font-semibold text-white cursor-pointer">Enable Knowledge Repository Retrieval</label>
                                                        <p class="text-xs text-gray-400 mt-1">Master switch for retrieving domain knowledge during planning. Users can still disable it in their profiles. (default: enabled)</p>
                                                    </div>
                                                </div>
                                            </div>

                                            <div>
                                                <label for="knowledge-num-docs" class="block text-sm font-medium text-gray-300 mb-2">Default Number of Documents</label>
                                                <input type="number" id="knowledge-num-docs" min="1" max="20" class="w-32 px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white text-sm focus:ring-2 focus:ring-[#F15F22] focus:border-transparent">
                                                <p class="text-xs text-gray-500 mt-1">Number of knowledge chunks to retrieve per planning call (default: 3)</p>
                                            </div>

                                            <div>
                                                <label for="knowledge-min-relevance" class="block text-sm font-medium text-gray-300 mb-2">Minimum Relevance Score</label>
                                                <input type="number" id="knowledge-min-relevance" min="0" max="1" step="0.05" class="w-32 px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white text-sm focus:ring-2 focus:ring-[#F15F22] focus:border-transparent">
                                                <p class="text-xs text-gray-500 mt-1">Minimum cosine similarity threshold (0.0-1.0, default: 0.70)</p>
                                            </div>

                                            <div>
                                                <label for="knowledge-max-tokens" class="block text-sm font-medium text-gray-300 mb-2">Maximum Context Tokens</label>
                                                <input type="number" id="knowledge-max-tokens" min="100" max="10000" step="100" class="w-32 px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white text-sm focus:ring-2 focus:ring-[#F15F22] focus:border-transparent">
                                                <p class="text-xs text-gray-500 mt-1">Token limit for all knowledge context combined (default: 2000)</p>
                                            </div>

                                            <div class="p-4 bg-gray-700/50 rounded-lg">
                                                <div class="flex items-start gap-3">
                                                    <input type="checkbox" id="knowledge-reranking-enabled" class="mt-1 w-4 h-4 rounded border-gray-600 bg-gray-700 text-[#F15F22] focus:ring-2 focus:ring-[#F15F22] focus:ring-offset-0">
                                                    <div class="flex-1">
                                                        <label for="knowledge-reranking-enabled" class="block text-sm font-semibold text-white cursor-pointer">Enable LLM Reranking (Global Default)</label>
                                                        <p class="text-xs text-gray-400 mt-1">Use LLM to rerank retrieved documents by relevance. Can be overridden per-collection in profiles. Increases latency. (default: disabled)</p>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Save Button -->
                                            <div class="pt-4 border-t border-white/10">
                                                <button type="button" id="save-knowledge-config-btn" class="px-6 py-3 bg-[#F15F22] hover:bg-[#D9501A] rounded-md transition-colors text-white font-medium text-sm">
                                                    Save Knowledge Settings
                                                </button>
                                            </div>
                                        </div>
                                    </details>
                                </div>

                                <!-- Startup Management -->
                                <div class="glass-panel rounded-xl p-6">
                                    <details class="group">
                                        <summary class="flex justify-between items-center cursor-pointer list-none">
                                            <div class="flex items-center gap-3">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 0a2 2 0 012 2v8a2 2 0 01-2 2h-2a2 2 0 01-2-2V9a2 2 0 012-2z" />
                                                </svg>
                                                <div>
                                                    <h3 class="text-lg font-bold text-white">Startup Management</h3>
                                                    <p class="text-sm text-gray-400">Default panel visibility and welcome screen settings at startup</p>
                                                </div>
                                            </div>
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 transition-transform group-open:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                                            </svg>
                                        </summary>
                                        <div class="mt-6 pl-9 space-y-4">
                                            <div class="p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                                                <div class="flex items-start gap-3">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-400 flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                        <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                    </svg>
                                                    <div>
                                                        <p class="text-sm text-gray-300">These settings define the default visibility state for panels when users first load the application. Individual users can override these defaults using their personal panel toggles, and their preferences will be saved locally.</p>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Session History Panel -->
                                            <div class="p-4 bg-gray-700/50 rounded-lg space-y-3">
                                                <h4 class="text-sm font-bold text-white">Session History Panel (Left Sidebar)</h4>
                                                
                                                <div class="flex items-start gap-3">
                                                    <input type="checkbox" id="session-history-visible" name="session_history_visible" class="mt-1 w-4 h-4 rounded border-gray-600 bg-gray-700 text-[#F15F22] focus:ring-2 focus:ring-[#F15F22] focus:ring-offset-0">
                                                    <div class="flex-1">
                                                        <label for="session-history-visible" class="block text-xs font-semibold text-white cursor-pointer">Panel is visible for the user</label>
                                                        <p class="text-xs text-gray-400 mt-0.5">When enabled, the session history panel is available to users</p>
                                                    </div>
                                                </div>
                                                
                                                <div class="flex items-start gap-3 ml-7">
                                                    <div class="flex-1">
                                                        <label for="session-history-default-mode" class="block text-xs font-semibold text-white mb-1">Panel default visibility mode</label>
                                                        <select id="session-history-default-mode" name="session_history_default_mode" class="w-full px-3 py-1.5 text-sm bg-gray-700 border border-gray-600 text-white rounded focus:ring-2 focus:ring-[#F15F22] focus:border-transparent">
                                                            <option value="expanded">Expanded</option>
                                                            <option value="collapsed">Collapsed</option>
                                                        </select>
                                                        <p class="text-xs text-gray-400 mt-0.5">Initial state when entering conversation pane</p>
                                                    </div>
                                                </div>
                                                
                                                <div class="flex items-start gap-3">
                                                    <input type="checkbox" id="session-history-user-can-toggle" name="session_history_user_can_toggle" class="mt-1 w-4 h-4 rounded border-gray-600 bg-gray-700 text-[#F15F22] focus:ring-2 focus:ring-[#F15F22] focus:ring-offset-0">
                                                    <div class="flex-1">
                                                        <label for="session-history-user-can-toggle" class="block text-xs font-semibold text-white cursor-pointer">User can collapse/expand</label>
                                                        <p class="text-xs text-gray-400 mt-0.5">When enabled, user can toggle the panel open/closed</p>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Resources Panel -->
                                            <div class="p-4 bg-gray-700/50 rounded-lg space-y-3">
                                                <h4 class="text-sm font-bold text-white">Resources Panel (Right Sidebar)</h4>
                                                
                                                <div class="flex items-start gap-3">
                                                    <input type="checkbox" id="resources-visible" name="resources_visible" class="mt-1 w-4 h-4 rounded border-gray-600 bg-gray-700 text-[#F15F22] focus:ring-2 focus:ring-[#F15F22] focus:ring-offset-0">
                                                    <div class="flex-1">
                                                        <label for="resources-visible" class="block text-xs font-semibold text-white cursor-pointer">Panel is visible for the user</label>
                                                        <p class="text-xs text-gray-400 mt-0.5">When enabled, the resources panel is available to users</p>
                                                    </div>
                                                </div>
                                                
                                                <div class="flex items-start gap-3 ml-7">
                                                    <div class="flex-1">
                                                        <label for="resources-default-mode" class="block text-xs font-semibold text-white mb-1">Panel default visibility mode</label>
                                                        <select id="resources-default-mode" name="resources_default_mode" class="w-full px-3 py-1.5 text-sm bg-gray-700 border border-gray-600 text-white rounded focus:ring-2 focus:ring-[#F15F22] focus:border-transparent">
                                                            <option value="expanded">Expanded</option>
                                                            <option value="collapsed">Collapsed</option>
                                                        </select>
                                                        <p class="text-xs text-gray-400 mt-0.5">Initial state when entering conversation pane</p>
                                                    </div>
                                                </div>
                                                
                                                <div class="flex items-start gap-3">
                                                    <input type="checkbox" id="resources-user-can-toggle" name="resources_user_can_toggle" class="mt-1 w-4 h-4 rounded border-gray-600 bg-gray-700 text-[#F15F22] focus:ring-2 focus:ring-[#F15F22] focus:ring-offset-0">
                                                    <div class="flex-1">
                                                        <label for="resources-user-can-toggle" class="block text-xs font-semibold text-white cursor-pointer">User can collapse/expand</label>
                                                        <p class="text-xs text-gray-400 mt-0.5">When enabled, user can toggle the panel open/closed</p>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Live Status Panel -->
                                            <div class="p-4 bg-gray-700/50 rounded-lg space-y-3">
                                                <h4 class="text-sm font-bold text-white">Live Status Window (Bottom)</h4>
                                                
                                                <div class="flex items-start gap-3">
                                                    <input type="checkbox" id="status-visible" name="status_visible" class="mt-1 w-4 h-4 rounded border-gray-600 bg-gray-700 text-[#F15F22] focus:ring-2 focus:ring-[#F15F22] focus:ring-offset-0">
                                                    <div class="flex-1">
                                                        <label for="status-visible" class="block text-xs font-semibold text-white cursor-pointer">Panel is visible for the user</label>
                                                        <p class="text-xs text-gray-400 mt-0.5">When enabled, the live status window is available to users</p>
                                                    </div>
                                                </div>
                                                
                                                <div class="flex items-start gap-3 ml-7">
                                                    <div class="flex-1">
                                                        <label for="status-default-mode" class="block text-xs font-semibold text-white mb-1">Panel default visibility mode</label>
                                                        <select id="status-default-mode" name="status_default_mode" class="w-full px-3 py-1.5 text-sm bg-gray-700 border border-gray-600 text-white rounded focus:ring-2 focus:ring-[#F15F22] focus:border-transparent">
                                                            <option value="expanded">Expanded</option>
                                                            <option value="collapsed">Collapsed</option>
                                                        </select>
                                                        <p class="text-xs text-gray-400 mt-0.5">Initial state when entering conversation pane</p>
                                                    </div>
                                                </div>
                                                
                                                <div class="flex items-start gap-3">
                                                    <input type="checkbox" id="status-user-can-toggle" name="status_user_can_toggle" class="mt-1 w-4 h-4 rounded border-gray-600 bg-gray-700 text-[#F15F22] focus:ring-2 focus:ring-[#F15F22] focus:ring-offset-0">
                                                    <div class="flex-1">
                                                        <label for="status-user-can-toggle" class="block text-xs font-semibold text-white cursor-pointer">User can collapse/expand</label>
                                                        <p class="text-xs text-gray-400 mt-0.5">When enabled, user can toggle the window open/closed</p>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Always Show Welcome Screen -->
                                            <div class="p-4 bg-purple-500/10 border border-purple-500/30 rounded-lg">
                                                <div class="flex items-start gap-3">
                                                    <input type="checkbox" id="always-show-welcome-screen" name="always_show_welcome_screen" class="mt-1 w-4 h-4 rounded border-gray-600 bg-gray-700 text-[#F15F22] focus:ring-2 focus:ring-[#F15F22] focus:ring-offset-0">
                                                    <div class="flex-1">
                                                        <label for="always-show-welcome-screen" class="block text-sm font-semibold text-white cursor-pointer">Always Show Welcome Screen at Startup</label>
                                                        <p class="text-xs text-gray-400 mt-1">When enabled, the welcome screen will always be displayed in the conversation pane at startup or after browser refresh, regardless of whether the application is configured for the user.</p>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Default Theme -->
                                            <div class="p-4 bg-gray-700/50 rounded-lg">
                                                <div class="flex items-start gap-3">
                                                    <div class="flex-1">
                                                        <label for="default-theme-selector" class="block text-sm font-semibold text-white mb-2">Default Theme</label>
                                                        <p class="text-xs text-gray-400 mb-3">Select the default theme that users will see on their first visit. Users can change their theme preference, and their choice will be saved.</p>
                                                        <select id="default-theme-selector" name="default_theme" class="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white text-sm focus:ring-2 focus:ring-[#F15F22] focus:border-[#F15F22]">
                                                            <option value="legacy">Legacy Theme</option>
                                                            <option value="modern">Modern Theme</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- User Override Control -->
                                            <div class="p-4 bg-orange-500/10 border border-orange-500/30 rounded-lg">
                                                <div class="flex items-start gap-3">
                                                    <input type="checkbox" id="allow-user-panel-override" name="allow_user_panel_override" class="mt-1 w-4 h-4 rounded border-gray-600 bg-gray-700 text-[#F15F22] focus:ring-2 focus:ring-[#F15F22] focus:ring-offset-0" checked>
                                                    <div class="flex-1">
                                                        <label for="allow-user-panel-override" class="block text-sm font-semibold text-white cursor-pointer">Allow Users to Override Panel Settings</label>
                                                        <p class="text-xs text-gray-400 mt-1">When enabled, users can toggle panels and save their preferences. When disabled, the above default settings are enforced for all users and panel toggle controls are hidden.</p>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Save Button -->
                                            <div class="pt-4 border-t border-white/10">
                                                <button type="button" id="save-window-defaults-btn" class="px-6 py-3 bg-[#F15F22] hover:bg-[#D9501A] rounded-md transition-colors text-white font-medium text-sm">
                                                    Save Startup Settings
                                                </button>
                                            </div>
                                        </div>
                                    </details>
                                </div>

                                <!-- Document Upload Configuration -->
                                <div class="glass-panel rounded-xl p-6">
                                    <details class="group">
                                        <summary class="flex justify-between items-center cursor-pointer list-none">
                                            <div class="flex items-center gap-3">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                                                </svg>
                                                <div>
                                                    <h3 class="text-lg font-bold text-white">Document Upload Configuration</h3>
                                                    <p class="text-sm text-gray-400">Configure document upload capabilities for LLM providers</p>
                                                </div>
                                            </div>
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 transition-transform group-open:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                                            </svg>
                                        </summary>
                                        <div class="mt-6 pl-9 space-y-4">
                                            <!-- Info Banner -->
                                            <div class="flex items-start gap-3 p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-400 flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                </svg>
                                                <div>
                                                    <h4 class="text-sm font-bold text-white mb-2">About Document Upload</h4>
                                                    <p class="text-sm text-gray-400 mb-2">Control how documents are processed for each LLM provider. Some providers support native document upload (sending files directly), while others require text extraction.</p>
                                                    <ul class="text-sm text-gray-400 space-y-1 list-disc list-inside">
                                                        <li><strong>Native Upload:</strong> Google, Anthropic, Amazon (better quality, images supported)</li>
                                                        <li><strong>Text Extraction:</strong> OpenAI, Azure, Friendli, Ollama (fallback method)</li>
                                                        <li>Override settings to force text extraction or adjust file size limits</li>
                                                    </ul>
                                                </div>
                                            </div>

                                            <!-- Refresh Button -->
                                            <div class="flex justify-end">
                                                <button type="button" id="refresh-document-upload-config-btn" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-md transition-colors text-white font-medium text-sm flex items-center gap-2">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                        <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                                    </svg>
                                                    Refresh Configurations
                                                </button>
                                            </div>

                                            <!-- Provider Configurations Table -->
                                            <div id="document-upload-config-container" class="rounded-lg border border-gray-700 overflow-hidden">
                                                <div class="overflow-x-auto">
                                                    <table class="w-full">
                                                        <thead class="bg-gray-800">
                                                            <tr>
                                                                <th class="px-4 py-3 text-left text-xs font-semibold text-gray-300 uppercase tracking-wider">Provider</th>
                                                                <th class="px-4 py-3 text-left text-xs font-semibold text-gray-300 uppercase tracking-wider">Capability</th>
                                                                <th class="px-4 py-3 text-left text-xs font-semibold text-gray-300 uppercase tracking-wider">Enabled</th>
                                                                <th class="px-4 py-3 text-left text-xs font-semibold text-gray-300 uppercase tracking-wider">Native Upload</th>
                                                                <th class="px-4 py-3 text-left text-xs font-semibold text-gray-300 uppercase tracking-wider">Max Size (MB)</th>
                                                                <th class="px-4 py-3 text-left text-xs font-semibold text-gray-300 uppercase tracking-wider">Status</th>
                                                                <th class="px-4 py-3 text-center text-xs font-semibold text-gray-300 uppercase tracking-wider">Actions</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody id="document-upload-config-tbody" class="divide-y divide-gray-700">
                                                            <!-- Populated by JavaScript -->
                                                            <tr>
                                                                <td colspan="7" class="px-4 py-8 text-center text-gray-400">
                                                                    <div class="flex flex-col items-center gap-2">
                                                                        <svg class="animate-spin h-8 w-8 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                                                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                                                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                                                        </svg>
                                                                        <span class="text-sm">Loading configurations...</span>
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>

                                            <!-- Legend -->
                                            <div class="p-4 bg-gray-800/50 rounded-lg">
                                                <h4 class="text-xs font-semibold text-gray-300 mb-2 uppercase tracking-wider">Capability Levels</h4>
                                                <div class="grid grid-cols-2 gap-3 text-xs">
                                                    <div class="flex items-center gap-2">
                                                        <span class="px-2 py-1 bg-green-500/20 text-green-400 rounded font-medium">native_full</span>
                                                        <span class="text-gray-400">Full document support (PDFs + images)</span>
                                                    </div>
                                                    <div class="flex items-center gap-2">
                                                        <span class="px-2 py-1 bg-yellow-500/20 text-yellow-400 rounded font-medium">native_vision</span>
                                                        <span class="text-gray-400">Vision models only (images)</span>
                                                    </div>
                                                    <div class="flex items-center gap-2">
                                                        <span class="px-2 py-1 bg-blue-500/20 text-blue-400 rounded font-medium">text_extraction</span>
                                                        <span class="text-gray-400">Fallback text extraction</span>
                                                    </div>
                                                    <div class="flex items-center gap-2">
                                                        <span class="px-2 py-1 bg-gray-500/20 text-gray-400 rounded font-medium">not_supported</span>
                                                        <span class="text-gray-400">No document support</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </details>
                                </div>
                            </div>
                        </div>

                        <!-- Tab 5: Expert Settings -->
                        <div id="expert-settings-tab" class="admin-tab-content hidden">
                            <div class="space-y-6">
                                <!-- Warning Banner -->
                                <div class="glass-panel rounded-xl p-4 bg-red-500/10 border border-red-500/30">
                                    <div class="flex items-start gap-3">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-red-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                                        </svg>
                                        <div>
                                            <h4 class="text-sm font-bold text-red-400 mb-1">Advanced Configuration Area</h4>
                                            <p class="text-sm text-gray-300">These settings directly affect system behavior and performance. Incorrect values may cause instability or errors. Modify only if you understand the implications.</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- LLM Behavior -->
                                <div class="glass-panel rounded-xl p-6">
                                    <details class="group">
                                        <summary class="flex justify-between items-center cursor-pointer list-none">
                                            <div class="flex items-center gap-3">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-purple-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
                                                </svg>
                                                <div>
                                                    <h3 class="text-lg font-bold text-white">LLM Behavior</h3>
                                                    <p class="text-sm text-gray-400">Configure retry logic and API behavior</p>
                                                </div>
                                            </div>
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 transition-transform group-open:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                                            </svg>
                                        </summary>
                                        <div class="mt-4 space-y-4 pl-9">
                                            <div>
                                                <label for="llm-max-retries" class="block text-sm font-medium text-gray-300 mb-2">Max API Retries</label>
                                                <input type="number" id="llm-max-retries" min="0" max="20" class="w-32 px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white text-sm focus:ring-2 focus:ring-[#F15F22] focus:border-transparent">
                                                <p class="text-xs text-gray-500 mt-1">Maximum attempts for failed LLM API calls (default: 5)</p>
                                            </div>
                                            <div>
                                                <label for="llm-base-delay" class="block text-sm font-medium text-gray-300 mb-2">Retry Base Delay (seconds)</label>
                                                <input type="number" id="llm-base-delay" min="0" max="30" step="0.5" class="w-32 px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white text-sm focus:ring-2 focus:ring-[#F15F22] focus:border-transparent">
                                                <p class="text-xs text-gray-500 mt-1">Initial delay for exponential backoff (default: 2)</p>
                                            </div>
                                        </div>
                                    </details>
                                </div>

                                <!-- Agent Configuration -->
                                <div class="glass-panel rounded-xl p-6">
                                    <details class="group">
                                        <summary class="flex justify-between items-center cursor-pointer list-none">
                                            <div class="flex items-center gap-3">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z" />
                                                </svg>
                                                <div>
                                                    <h3 class="text-lg font-bold text-white">Agent Configuration</h3>
                                                    <p class="text-sm text-gray-400">Control agent execution limits and timeouts</p>
                                                </div>
                                            </div>
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 transition-transform group-open:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                                            </svg>
                                        </summary>
                                        <div class="mt-4 space-y-4 pl-9">
                                            <div>
                                                <label for="max-execution-steps" class="block text-sm font-medium text-gray-300 mb-2">Max Execution Steps</label>
                                                <input type="number" id="max-execution-steps" min="1" max="100" class="w-32 px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white text-sm focus:ring-2 focus:ring-[#F15F22] focus:border-transparent">
                                                <p class="text-xs text-gray-500 mt-1">Maximum planning/execution iterations (default: 25)</p>
                                            </div>
                                            <div>
                                                <label for="tool-call-timeout" class="block text-sm font-medium text-gray-300 mb-2">Tool Call Timeout (seconds)</label>
                                                <input type="number" id="tool-call-timeout" min="5" max="600" class="w-32 px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white text-sm focus:ring-2 focus:ring-[#F15F22] focus:border-transparent">
                                                <p class="text-xs text-gray-500 mt-1">Timeout for individual tool executions (default: 60)</p>
                                            </div>
                                        </div>
                                    </details>
                                </div>

                                <!-- Performance & Context -->
                                <div class="glass-panel rounded-xl p-6">
                                    <details class="group">
                                        <summary class="flex justify-between items-center cursor-pointer list-none">
                                            <div class="flex items-center gap-3">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z" />
                                                </svg>
                                                <div>
                                                    <h3 class="text-lg font-bold text-white">Performance & Context</h3>
                                                    <p class="text-sm text-gray-400">Data volume and context size limits</p>
                                                </div>
                                            </div>
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 transition-transform group-open:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                                            </svg>
                                        </summary>
                                        <div class="mt-4 space-y-4 pl-9">
                                            <div>
                                                <label for="context-max-rows" class="block text-sm font-medium text-gray-300 mb-2">Max Context Rows</label>
                                                <input type="number" id="context-max-rows" min="10" max="10000" class="w-32 px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white text-sm focus:ring-2 focus:ring-[#F15F22] focus:border-transparent">
                                                <p class="text-xs text-gray-500 mt-1">Maximum rows from tool results sent to LLM (default: 500)</p>
                                            </div>
                                            <div>
                                                <label for="context-max-chars" class="block text-sm font-medium text-gray-300 mb-2">Max Context Characters</label>
                                                <input type="number" id="context-max-chars" min="1000" max="100000" step="1000" class="w-32 px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white text-sm focus:ring-2 focus:ring-[#F15F22] focus:border-transparent">
                                                <p class="text-xs text-gray-500 mt-1">Maximum characters from tool results (default: 10000)</p>
                                            </div>
                                            <div>
                                                <label for="description-threshold" class="block text-sm font-medium text-gray-300 mb-2">Task Complexity Threshold</label>
                                                <input type="number" id="description-threshold" min="50" max="1000" class="w-32 px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white text-sm focus:ring-2 focus:ring-[#F15F22] focus:border-transparent">
                                                <p class="text-xs text-gray-500 mt-1">Character count to detect detailed tasks (default: 200)</p>
                                            </div>
                                        </div>
                                    </details>
                                </div>

                                <!-- Agent Behavior -->
                                <div class="glass-panel rounded-xl p-6">
                                    <details class="group">
                                        <summary class="flex justify-between items-center cursor-pointer list-none">
                                            <div class="flex items-center gap-3">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-indigo-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                                </svg>
                                                <div>
                                                    <h3 class="text-lg font-bold text-white">Agent Behavior</h3>
                                                    <p class="text-sm text-gray-400">Control agent reasoning and response patterns</p>
                                                </div>
                                            </div>
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 transition-transform group-open:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                                            </svg>
                                        </summary>
                                        <div class="mt-4 space-y-4 pl-9">
                                            <div class="p-4 bg-gray-700/50 rounded-lg">
                                                <div class="flex items-start gap-3">
                                                    <input type="checkbox" id="allow-synthesis" class="mt-1 w-4 h-4 rounded border-gray-600 bg-gray-700 text-[#F15F22] focus:ring-2 focus:ring-[#F15F22] focus:ring-offset-0">
                                                    <div class="flex-1">
                                                        <label for="allow-synthesis" class="block text-sm font-semibold text-white cursor-pointer">Allow History Synthesis</label>
                                                        <p class="text-xs text-gray-400 mt-1">Let agent answer from conversation history without calling tools (default: enabled)</p>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="p-4 bg-gray-700/50 rounded-lg">
                                                <div class="flex items-start gap-3">
                                                    <input type="checkbox" id="force-sub-summary" class="mt-1 w-4 h-4 rounded border-gray-600 bg-gray-700 text-[#F15F22] focus:ring-2 focus:ring-[#F15F22] focus:ring-offset-0">
                                                    <div class="flex-1">
                                                        <label for="force-sub-summary" class="block text-sm font-semibold text-white cursor-pointer">Force Sub-Executor Summaries</label>
                                                        <p class="text-xs text-gray-400 mt-1">Require sub-executors to generate their own summaries (default: disabled)</p>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="p-4 bg-gray-700/50 rounded-lg">
                                                <div class="flex items-start gap-3">
                                                    <input type="checkbox" id="condense-prompts" class="mt-1 w-4 h-4 rounded border-gray-600 bg-gray-700 text-[#F15F22] focus:ring-2 focus:ring-[#F15F22] focus:ring-offset-0">
                                                    <div class="flex-1">
                                                        <label for="condense-prompts" class="block text-sm font-semibold text-white cursor-pointer">Condense System Prompts</label>
                                                        <p class="text-xs text-gray-400 mt-1">Compress tool/prompt lists in subsequent turns to save tokens (default: enabled)</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </details>
                                </div>

                                <!-- Query Optimization -->
                                <div class="glass-panel rounded-xl p-6">
                                    <details class="group">
                                        <summary class="flex justify-between items-center cursor-pointer list-none">
                                            <div class="flex items-center gap-3">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-pink-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4" />
                                                </svg>
                                                <div>
                                                    <h3 class="text-lg font-bold text-white">Query Optimization</h3>
                                                    <p class="text-sm text-gray-400">SQL consolidation and query rewriting</p>
                                                </div>
                                            </div>
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 transition-transform group-open:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                                            </svg>
                                        </summary>
                                        <div class="mt-4 space-y-4 pl-9">
                                            <div class="p-4 bg-gray-700/50 rounded-lg">
                                                <div class="flex items-start gap-3">
                                                    <input type="checkbox" id="enable-sql-consolidation" class="mt-1 w-4 h-4 rounded border-gray-600 bg-gray-700 text-[#F15F22] focus:ring-2 focus:ring-[#F15F22] focus:ring-offset-0">
                                                    <div class="flex-1">
                                                        <label for="enable-sql-consolidation" class="block text-sm font-semibold text-white cursor-pointer">Enable SQL Consolidation</label>
                                                        <p class="text-xs text-gray-400 mt-1">Use LLM to consolidate sequential SQL queries for better performance (default: disabled)</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </details>
                                </div>

                                <!-- Security Settings -->
                                <div class="glass-panel rounded-xl p-6">
                                    <details class="group">
                                        <summary class="flex justify-between items-center cursor-pointer list-none">
                                            <div class="flex items-center gap-3">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                                                </svg>
                                                <div>
                                                    <h3 class="text-lg font-bold text-white">Security Settings</h3>
                                                    <p class="text-sm text-gray-400">Session and authentication parameters</p>
                                                </div>
                                            </div>
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 transition-transform group-open:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                                            </svg>
                                        </summary>
                                        <div class="mt-4 space-y-4 pl-9">
                                            <div>
                                                <label for="session-timeout" class="block text-sm font-medium text-gray-300 mb-2">Session Timeout (hours)</label>
                                                <input type="number" id="session-timeout" min="1" max="168" class="w-32 px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white text-sm focus:ring-2 focus:ring-[#F15F22] focus:border-transparent">
                                                <p class="text-xs text-gray-500 mt-1">How long sessions remain valid (default: 24)</p>
                                            </div>
                                            <div>
                                                <label for="token-expiry" class="block text-sm font-medium text-gray-300 mb-2">Token Expiry (hours)</label>
                                                <input type="number" id="token-expiry" min="1" max="720" class="w-32 px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white text-sm focus:ring-2 focus:ring-[#F15F22] focus:border-transparent">
                                                <p class="text-xs text-gray-500 mt-1">Authentication token validity period (default: 168)</p>
                                            </div>
                                        </div>
                                    </details>
                                </div>

                                <!-- System Maintenance -->
                                <div class="glass-panel rounded-xl p-6">
                                    <details class="group">
                                        <summary class="flex justify-between items-center cursor-pointer list-none">
                                            <div class="flex items-center gap-3">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-yellow-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                                </svg>
                                                <div>
                                                    <h3 class="text-lg font-bold text-white">System Maintenance</h3>
                                                    <p class="text-sm text-gray-400">Cache management and system operations</p>
                                                </div>
                                            </div>
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 transition-transform group-open:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                                            </svg>
                                        </summary>
                                        <div class="mt-4 space-y-4 pl-9">
                                            <div class="flex items-center justify-between p-4 bg-gray-700/50 rounded-lg">
                                                <div>
                                                    <h4 class="text-sm font-semibold text-white mb-1">Clear Application Cache</h4>
                                                    <p class="text-xs text-gray-400">Clears temporary data and cached responses</p>
                                                </div>
                                                <button type="button" id="clear-cache-btn" class="px-4 py-2 bg-yellow-600 hover:bg-yellow-700 rounded-md transition-colors text-white font-medium text-sm">
                                                    Clear Cache
                                                </button>
                                            </div>
                                            <div class="flex items-center justify-between p-4 bg-red-500/10 border border-red-500/30 rounded-lg">
                                                <div>
                                                    <h4 class="text-sm font-semibold text-red-400 mb-1">Reset Application State</h4>
                                                    <p class="text-xs text-gray-400">Resets runtime state (requires reconnection)</p>
                                                </div>
                                                <button type="button" id="reset-state-btn" class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded-md transition-colors text-white font-medium text-sm">
                                                    Reset State
                                                </button>
                                            </div>
                                        </div>
                                    </details>
                                </div>

                                <!-- Save Button -->
                                <div class="flex justify-end">
                                    <button type="button" id="save-expert-settings-btn" class="px-6 py-3 bg-[#F15F22] hover:bg-[#D9501A] rounded-md transition-colors text-white font-medium">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                                        </svg>
                                        Save Expert Settings
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Tab 6: System Prompts -->
                        <div id="system-prompts-tab" class="admin-tab-content hidden">
                            <div class="space-y-6">
                                <div class="glass-panel rounded-xl p-6">
                                    <div class="mb-6">
                                        <h3 class="text-xl font-bold text-white">System Prompt Editor</h3>
                                        <p class="text-sm text-gray-400 mt-1">Manage system prompts for different profile tiers</p>
                                        <div id="system-prompts-tier-notice" class="mt-4 p-4 rounded-lg bg-yellow-500/10 border border-yellow-500/30 hidden">
                                            <div class="flex items-start gap-3">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-yellow-500 flex-shrink-0 mt-0.5" viewBox="0 0 20 20" fill="currentColor">
                                                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                                                </svg>
                                                <div class="flex-1">
                                                    <p class="text-sm font-medium text-yellow-200">License Tier Required</p>
                                                    <p class="text-xs text-yellow-300/80 mt-1">System Prompt Editor requires "Prompt Engineer" or "Enterprise" license tier.</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- System Prompt Selector -->
                                    <div class="mb-6">
                                        <div class="flex justify-between items-center mb-2">
                                            <label class="block text-sm font-medium text-gray-300">Select System Prompt</label>
                                            <div class="flex gap-2">
                                                <button type="button" id="duplicate-prompt-btn" class="px-3 py-1.5 bg-blue-600 hover:bg-blue-700 rounded-md transition-colors text-white font-medium text-xs flex items-center gap-1" title="Duplicate selected prompt">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                        <path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                                                    </svg>
                                                    Duplicate
                                                </button>
                                                <button type="button" id="delete-prompt-btn" class="px-3 py-1.5 bg-red-600 hover:bg-red-700 rounded-md transition-colors text-white font-medium text-xs flex items-center gap-1" title="Delete selected prompt">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                        <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                                    </svg>
                                                    Delete
                                                </button>
                                            </div>
                                        </div>
                                        <select id="system-prompts-tier-selector" class="w-full px-4 py-2 rounded-lg text-white bg-gray-700 border border-gray-600 focus:outline-none focus:border-teradata-orange transition-colors">
                                            <optgroup label="Master System Prompts">
                                                <option value="MASTER_SYSTEM_PROMPT">Master System Prompt (Default)</option>
                                                <option value="GOOGLE_MASTER_SYSTEM_PROMPT">Google Master System Prompt</option>
                                                <option value="OLLAMA_MASTER_SYSTEM_PROMPT">Ollama Master System Prompt</option>
                                            </optgroup>
                                            <optgroup label="Workflow & Classification">
                                                <option value="TASK_CLASSIFICATION_PROMPT">Task Classification Prompt</option>
                                                <option value="WORKFLOW_META_PLANNING_PROMPT">Workflow Meta Planning Prompt</option>
                                                <option value="WORKFLOW_TACTICAL_PROMPT">Workflow Tactical Prompt</option>
                                            </optgroup>
                                            <optgroup label="Error Recovery & Self-Correction">
                                                <option value="ERROR_RECOVERY_PROMPT">Error Recovery Prompt</option>
                                                <option value="TACTICAL_SELF_CORRECTION_PROMPT">Tactical Self-Correction Prompt</option>
                                                <option value="TACTICAL_SELF_CORRECTION_PROMPT_COLUMN_ERROR">Self-Correction: Column Error</option>
                                                <option value="TACTICAL_SELF_CORRECTION_PROMPT_TABLE_ERROR">Self-Correction: Table Error</option>
                                            </optgroup>
                                            <optgroup label="Data Operations">
                                                <option value="SQL_CONSOLIDATION_PROMPT">SQL Consolidation Prompt</option>
                                            </optgroup>
                                            <optgroup label="Visualization">
                                                <option value="G2PLOT_GUIDELINES">G2Plot Guidelines</option>
                                            </optgroup>
                                        </select>
                                    </div>

                                    <!-- System Prompt Editor -->
                                    <div class="mb-6">
                                        <div class="flex justify-between items-center mb-2">
                                            <div class="flex items-center gap-2">
                                                <label class="block text-sm font-medium text-gray-300">System Prompt Content</label>
                                                <span id="system-prompt-override-badge" class="hidden px-2 py-0.5 text-xs font-medium bg-[#F15F22] text-white rounded">
                                                    Custom Override
                                                </span>
                                            </div>
                                            <p class="text-xs text-gray-500">
                                                <span id="system-prompt-char-count">0</span> characters
                                            </p>
                                        </div>
                                        <textarea id="system-prompt-editor-textarea" rows="20" 
                                                  class="w-full px-4 py-3 rounded-lg text-white bg-gray-700 border border-gray-600 focus:outline-none focus:border-teradata-orange transition-colors font-mono text-sm resize-y"
                                                  placeholder="Select a system prompt to edit..."></textarea>
                                    </div>

                                    <!-- Action Buttons -->
                                    <div class="flex justify-between items-center mb-6">
                                        <button type="button" id="load-system-prompt-btn" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-md transition-colors text-white font-medium text-sm">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline-block mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
                                            </svg>
                                            Load Current Prompt
                                        </button>
                                        <div class="flex gap-2">
                                            <button type="button" id="reset-system-prompt-btn" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded-md transition-colors text-white font-medium text-sm">
                                                Reset to Default
                                            </button>
                                            <button type="button" id="save-system-prompt-btn" class="px-6 py-2 bg-[#F15F22] hover:bg-[#D9501A] rounded-md transition-colors text-white font-medium text-sm">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline-block mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                                                </svg>
                                                Save System Prompt
                                            </button>
                                        </div>
                                    </div>

                                    <!-- Phase 4: Enhanced Features -->
                                    <div id="system-prompt-enhanced-features" class="space-y-4">
                                        
                                        <!-- Parameters Editor (Phase 4) -->
                                        <div class="glass-panel rounded-xl p-4">
                                            <div class="flex items-center justify-between mb-3">
                                                <h4 class="text-md font-semibold text-white flex items-center gap-2">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-[#F15F22]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4" />
                                                    </svg>
                                                    Prompt Parameters
                                                </h4>
                                                <button type="button" id="toggle-parameters-btn" class="text-sm text-gray-400 hover:text-white transition-colors">
                                                    <span class="expand-text">Show</span>
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline-block ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                        <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                                                    </svg>
                                                </button>
                                            </div>
                                            
                                            <div id="parameters-content" class="hidden">
                                                <p class="text-sm text-gray-400 mb-3">Configure parameters used in this prompt template</p>
                                                
                                                <div class="overflow-x-auto">
                                                    <table class="w-full text-sm">
                                                        <thead>
                                                            <tr class="border-b border-gray-700">
                                                                <th class="text-left py-2 px-3 text-gray-400 font-medium">Parameter</th>
                                                                <th class="text-left py-2 px-3 text-gray-400 font-medium">Type</th>
                                                                <th class="text-left py-2 px-3 text-gray-400 font-medium">Default Value</th>
                                                                <th class="text-left py-2 px-3 text-gray-400 font-medium">Override Value</th>
                                                                <th class="text-left py-2 px-3 text-gray-400 font-medium">Scope</th>
                                                                <th class="text-left py-2 px-3 text-gray-400 font-medium">Actions</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody id="parameters-table-body" class="divide-y divide-gray-700">
                                                            <tr>
                                                                <td colspan="6" class="text-center py-4 text-gray-500">
                                                                    Select a prompt to view parameters
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Version History (Phase 4) -->
                                        <div class="glass-panel rounded-xl p-4">
                                            <div class="flex items-center justify-between mb-3">
                                                <h4 class="text-md font-semibold text-white flex items-center gap-2">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-[#F15F22]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                    </svg>
                                                    Version History
                                                </h4>
                                                <button type="button" id="toggle-versions-btn" class="text-sm text-gray-400 hover:text-white transition-colors">
                                                    <span class="expand-text">Show</span>
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline-block ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                        <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                                                    </svg>
                                                </button>
                                            </div>
                                            
                                            <div id="versions-content" class="hidden">
                                                <p class="text-sm text-gray-400 mb-3">View changes made to this prompt over time</p>
                                                
                                                <div class="overflow-x-auto max-h-64 overflow-y-auto">
                                                    <table class="w-full text-sm">
                                                        <thead class="sticky top-0 bg-gray-800">
                                                            <tr class="border-b border-gray-700">
                                                                <th class="text-left py-2 px-3 text-gray-400 font-medium">Version</th>
                                                                <th class="text-left py-2 px-3 text-gray-400 font-medium">Date</th>
                                                                <th class="text-left py-2 px-3 text-gray-400 font-medium">Author</th>
                                                                <th class="text-left py-2 px-3 text-gray-400 font-medium">Description</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody id="versions-table-body" class="divide-y divide-gray-700">
                                                            <tr>
                                                                <td colspan="4" class="text-center py-4 text-gray-500">
                                                                    Select a prompt to view history
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Diff Viewer (Phase 4) -->
                                        <div class="glass-panel rounded-xl p-4">
                                            <div class="flex items-center justify-between mb-3">
                                                <h4 class="text-md font-semibold text-white flex items-center gap-2">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-[#F15F22]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                        <path stroke-linecap="round" stroke-linejoin="round" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" />
                                                    </svg>
                                                    Compare Base vs Override
                                                </h4>
                                                <button type="button" id="toggle-diff-btn" class="text-sm text-gray-400 hover:text-white transition-colors">
                                                    <span class="expand-text">Show</span>
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline-block ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                        <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                                                    </svg>
                                                </button>
                                            </div>
                                            
                                            <div id="diff-content" class="hidden">
                                                <p class="text-sm text-gray-400 mb-3">View differences between base prompt and your override</p>
                                                
                                                <div id="diff-viewer" class="grid grid-cols-2 gap-4">
                                                    <div>
                                                        <h5 class="text-xs font-medium text-gray-400 mb-2 flex items-center gap-1">
                                                            <span class="w-3 h-3 rounded-full bg-gray-500"></span>
                                                            Base Prompt
                                                        </h5>
                                                        <div class="bg-gray-800 rounded p-3 text-xs font-mono max-h-64 overflow-y-auto">
                                                            <pre id="diff-base-content" class="text-gray-300 whitespace-pre-wrap">Select a prompt with override to compare</pre>
                                                        </div>
                                                    </div>
                                                    <div>
                                                        <h5 class="text-xs font-medium text-gray-400 mb-2 flex items-center gap-1">
                                                            <span class="w-3 h-3 rounded-full bg-[#F15F22]"></span>
                                                            Your Override
                                                        </h5>
                                                        <div class="bg-gray-800 rounded p-3 text-xs font-mono max-h-64 overflow-y-auto">
                                                            <pre id="diff-override-content" class="text-gray-300 whitespace-pre-wrap">No override found</pre>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <div id="diff-stats" class="mt-3 text-xs text-gray-500 flex gap-4">
                                                    <span>Base: <strong id="diff-base-length">0</strong> chars</span>
                                                    <span>Override: <strong id="diff-override-length">0</strong> chars</span>
                                                    <span>Difference: <strong id="diff-delta">0</strong> chars</span>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tab 7: Cost Management -->
                        <div id="cost-management-tab" class="admin-tab-content hidden">
                            <!-- Cost Analytics Dashboard (Header KPIs) -->
                            <div class="mb-6">
                                <h3 class="text-xl font-bold text-white mb-4">Cost Analytics</h3>
                                
                                <!-- KPI Cards Grid -->
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                                    <!-- Total Cost -->
                                    <div class="glass-panel rounded-xl p-4">
                                        <div class="flex items-center gap-3">
                                            <div class="p-3 bg-green-500/20 rounded-lg">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                </svg>
                                            </div>
                                            <div class="flex-1">
                                                <p class="text-xs text-gray-400 mb-1">Total Cost</p>
                                                <p id="cost-total" class="text-2xl font-bold text-white">$0.00</p>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Average Per Session -->
                                    <div class="glass-panel rounded-xl p-4">
                                        <div class="flex items-center gap-3">
                                            <div class="p-3 bg-blue-500/20 rounded-lg">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                                                </svg>
                                            </div>
                                            <div class="flex-1">
                                                <p class="text-xs text-gray-400 mb-1">Avg / Session</p>
                                                <p id="cost-avg-session" class="text-2xl font-bold text-white">$0.00</p>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Average Per Turn -->
                                    <div class="glass-panel rounded-xl p-4">
                                        <div class="flex items-center gap-3">
                                            <div class="p-3 bg-purple-500/20 rounded-lg">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-purple-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z" />
                                                </svg>
                                            </div>
                                            <div class="flex-1">
                                                <p class="text-xs text-gray-400 mb-1">Avg / Turn</p>
                                                <p id="cost-avg-turn" class="text-2xl font-bold text-white">$0.00</p>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Sessions Analyzed -->
                                    <div class="glass-panel rounded-xl p-4">
                                        <div class="flex items-center gap-3">
                                            <div class="p-3 bg-orange-500/20 rounded-lg">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-orange-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                                </svg>
                                            </div>
                                            <div class="flex-1">
                                                <p class="text-xs text-gray-400 mb-1">Sessions</p>
                                                <p id="cost-total-sessions" class="text-2xl font-bold text-white">0</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Cost Breakdown Charts -->
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                                    <!-- Cost by Provider -->
                                    <div class="glass-panel rounded-xl p-6">
                                        <h4 class="text-lg font-semibold text-white mb-4">Cost by Provider</h4>
                                        <div id="cost-by-provider-chart" class="space-y-3">
                                            <p class="text-sm text-gray-400 text-center py-8">Loading...</p>
                                        </div>
                                    </div>

                                    <!-- Top Expensive Models -->
                                    <div class="glass-panel rounded-xl p-6">
                                        <h4 class="text-lg font-semibold text-white mb-4">Top 5 Expensive Models</h4>
                                        <div id="cost-by-model-chart" class="space-y-3">
                                            <p class="text-sm text-gray-400 text-center py-8">Loading...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Cost Configuration Section -->
                            <div class="glass-panel rounded-xl p-6">
                                <div class="flex justify-between items-center mb-6">
                                    <div>
                                        <h3 class="text-xl font-bold text-white">Model Cost Configuration</h3>
                                        <p class="text-sm text-gray-400 mt-1">Manage LLM model pricing for accurate cost tracking</p>
                                    </div>
                                    <div class="flex gap-2">
                                        <button type="button" id="sync-litellm-costs-btn" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-md transition-colors text-white font-medium text-sm">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                            </svg>
                                            Sync from LiteLLM
                                        </button>
                                        <button type="button" id="add-manual-cost-btn" class="px-4 py-2 bg-green-600 hover:bg-green-700 rounded-md transition-colors text-white font-medium text-sm">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
                                            </svg>
                                            Add Manual Entry
                                        </button>
                                    </div>
                                </div>

                                <!-- Fallback Cost Configuration -->
                                <div class="mb-6 p-4 bg-yellow-500/10 border border-yellow-500/30 rounded-lg">
                                    <div class="flex justify-between items-center">
                                        <div>
                                            <h4 class="text-sm font-semibold text-yellow-400 mb-1">Default Fallback Cost</h4>
                                            <p class="text-xs text-gray-400">Used for models not found in the pricing table</p>
                                        </div>
                                        <div class="flex items-center gap-4">
                                            <div>
                                                <label class="text-xs text-gray-400 block mb-1">Input (per 1M)</label>
                                                <input type="number" id="fallback-input-cost" step="0.01" min="0" 
                                                    class="w-24 px-2 py-1 bg-gray-700 border border-gray-600 rounded text-white text-sm">
                                            </div>
                                            <div>
                                                <label class="text-xs text-gray-400 block mb-1">Output (per 1M)</label>
                                                <input type="number" id="fallback-output-cost" step="0.01" min="0" 
                                                    class="w-24 px-2 py-1 bg-gray-700 border border-gray-600 rounded text-white text-sm">
                                            </div>
                                            <button type="button" id="save-fallback-cost-btn" class="px-4 py-2 bg-yellow-600 hover:bg-yellow-700 rounded-md transition-colors text-white font-medium text-xs mt-5">
                                                Save
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Search and Filter -->
                                <div class="mb-4 flex items-center gap-4">
                                    <div class="flex-1">
                                        <div class="relative">
                                            <input type="text" id="costs-search-input" placeholder="Search by provider or model name..." 
                                                class="w-full pl-10 pr-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <svg class="absolute left-3 top-2.5 h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <span class="text-xs text-gray-400">Show per page:</span>
                                        <select id="costs-page-size" class="px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="20">20</option>
                                            <option value="50">50</option>
                                            <option value="100">100</option>
                                            <option value="500">500</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Costs Table with Fixed Height -->
                                <div class="overflow-x-auto border border-gray-700 rounded-lg" style="max-height: 500px; overflow-y: auto;">
                                    <table class="w-full text-sm text-left">
                                        <thead class="text-xs uppercase bg-gray-700/50 text-gray-400 sticky top-0">
                                            <tr>
                                                <th class="px-4 py-3 bg-gray-700/90">Provider</th>
                                                <th class="px-4 py-3 bg-gray-700/90">Model</th>
                                                <th class="px-4 py-3 bg-gray-700/90">Input Cost (per 1M)</th>
                                                <th class="px-4 py-3 bg-gray-700/90">Output Cost (per 1M)</th>
                                                <th class="px-4 py-3 bg-gray-700/90">Source</th>
                                                <th class="px-4 py-3 bg-gray-700/90">Last Updated</th>
                                                <th class="px-4 py-3 bg-gray-700/90">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="costs-table-body" class="divide-y divide-gray-700">
                                            <tr>
                                                <td colspan="7" class="px-4 py-8 text-center text-gray-400">
                                                    Loading cost data...
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>

                                <!-- Pagination Controls -->
                                <div class="mt-4 flex items-center justify-between">
                                    <div class="text-sm text-gray-400">
                                        Showing <span id="costs-showing-start">0</span> to <span id="costs-showing-end">0</span> of <span id="costs-total-count">0</span> entries
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <button id="costs-prev-page" class="px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded text-white text-sm disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                            Previous
                                        </button>
                                        <span id="costs-page-info" class="text-sm text-gray-400">Page 1 of 1</span>
                                        <button id="costs-next-page" class="px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded text-white text-sm disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                            Next
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- --- END: Administration View --- -->

        </main>
    </div>
    <!-- Main content wrapper closing div -->


    <!-- Modals (Chat, Info, Config, Prompt Editor, Confirmation, Prompt View, System Prompt Popup, User Management) -->
    <!-- All modals remain at the end of <body> to overlay all views -->
    
    <!-- Change Password Modal -->
    <div id="change-password-modal-overlay" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden">
        <div class="glass-panel rounded-xl shadow-2xl w-full max-w-md p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-white">Change Password</h3>
                <button type="button" id="change-password-modal-close" class="p-2 rounded-full text-gray-400 hover:bg-white/10 hover:text-white transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            
            <form id="change-password-form" class="space-y-4">
                <div>
                    <label for="current-password" class="block text-sm font-medium text-gray-300 mb-2">Current Password</label>
                    <input type="password" id="current-password" autocomplete="current-password" required
                        class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="Enter current password">
                </div>
                
                <div>
                    <label for="new-password" class="block text-sm font-medium text-gray-300 mb-2">New Password</label>
                    <input type="password" id="new-password" autocomplete="new-password" required
                        class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="Enter new password">
                    <p class="text-xs text-gray-400 mt-1">Minimum 8 characters</p>
                </div>
                
                <div>
                    <label for="confirm-password" class="block text-sm font-medium text-gray-300 mb-2">Confirm New Password</label>
                    <input type="password" id="confirm-password" autocomplete="new-password" required
                        class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="Confirm new password">
                </div>
                
                <div class="flex gap-2 pt-4">
                    <button type="submit" class="flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-md transition-colors text-white font-medium">
                        Change Password
                    </button>
                    <button type="button" id="change-password-form-cancel" class="flex-1 px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded-md transition-colors text-white font-medium">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- User Management Modal -->
    <div id="user-modal-overlay" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden">
        <div class="glass-panel rounded-xl shadow-2xl w-full max-w-md p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 id="user-modal-title" class="text-xl font-bold text-white">Create User</h3>
                <button type="button" id="user-modal-close" class="p-2 rounded-full text-gray-400 hover:bg-white/10 hover:text-white transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            
            <form id="user-form" class="space-y-4">
                <input type="hidden" id="user-form-id" value="">
                
                <div>
                    <label for="user-form-username" class="block text-sm font-medium text-gray-300 mb-2">Username</label>
                    <input type="text" id="user-form-username" required
                        class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="Enter username">
                </div>
                
                <div>
                    <label for="user-form-email" class="block text-sm font-medium text-gray-300 mb-2">Email</label>
                    <input type="email" id="user-form-email" required
                        class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="Enter email">
                </div>
                
                <div>
                    <label for="user-form-display-name" class="block text-sm font-medium text-gray-300 mb-2">Display Name</label>
                    <input type="text" id="user-form-display-name"
                        class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="Enter display name (optional)">
                </div>
                
                <div id="user-form-password-container">
                    <label for="user-form-password" class="block text-sm font-medium text-gray-300 mb-2">
                        Password <span id="password-optional-text" class="text-xs text-gray-500">(leave blank to keep current)</span>
                    </label>
                    <input type="password" id="user-form-password" autocomplete="new-password" required
                        class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="Enter password">
                    <p class="text-xs text-gray-400 mt-1">Minimum 8 characters</p>
                </div>
                
                <div>
                    <label for="user-form-tier" class="block text-sm font-medium text-gray-300 mb-2">Profile Tier</label>
                    <select id="user-form-tier" required
                        class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="user">User</option>
                        <option value="developer">Developer</option>
                        <option value="admin">Admin</option>
                    </select>
                </div>
                
                <div>
                    <label for="user-form-consumption-profile" class="block text-sm font-medium text-gray-300 mb-2">Consumption Profile</label>
                    <select id="user-form-consumption-profile"
                        class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">Default (Based on Tier)</option>
                        <!-- Profiles will be loaded dynamically -->
                    </select>
                    <p class="text-xs text-gray-400 mt-1">Override default consumption limits for this user</p>
                </div>
                
                <div class="flex gap-2 pt-4">
                    <button type="submit" class="flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-md transition-colors text-white font-medium">
                        Save
                    </button>
                    <button type="button" id="user-form-cancel" class="flex-1 px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded-md transition-colors text-white font-medium">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Document Upload Configuration Modal -->
    <div id="doc-upload-config-modal-overlay" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden">
        <div class="glass-panel rounded-xl shadow-2xl w-full max-w-2xl p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 id="doc-upload-config-modal-title" class="text-xl font-bold text-white">Configure Document Upload</h3>
                <button type="button" id="doc-upload-config-modal-close" class="p-2 rounded-full text-gray-400 hover:bg-white/10 hover:text-white transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            
            <form id="doc-upload-config-form" class="space-y-4">
                <input type="hidden" id="doc-upload-config-provider" value="">
                
                <!-- Provider Info (Read-only) -->
                <div class="p-4 bg-gray-800/50 rounded-lg">
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div>
                            <span class="text-gray-400">Provider:</span>
                            <span id="doc-upload-config-provider-name" class="ml-2 text-white font-semibold"></span>
                        </div>
                        <div>
                            <span class="text-gray-400">Capability:</span>
                            <span id="doc-upload-config-capability" class="ml-2 px-2 py-1 rounded text-xs font-medium"></span>
                        </div>
                    </div>
                </div>

                <!-- Enabled Toggle -->
                <div class="p-4 bg-gray-700/50 rounded-lg">
                    <div class="flex items-start gap-3">
                        <input type="checkbox" id="doc-upload-config-enabled" name="enabled" class="mt-1 w-4 h-4 rounded border-gray-600 bg-gray-700 text-[#F15F22] focus:ring-2 focus:ring-[#F15F22] focus:ring-offset-0">
                        <div class="flex-1">
                            <label for="doc-upload-config-enabled" class="block text-sm font-semibold text-white cursor-pointer">Enable Document Upload</label>
                            <p class="text-xs text-gray-400 mt-1">Allow this provider to process document uploads</p>
                        </div>
                    </div>
                </div>

                <!-- Native Upload Toggle -->
                <div class="p-4 bg-gray-700/50 rounded-lg">
                    <div class="flex items-start gap-3">
                        <input type="checkbox" id="doc-upload-config-use-native" name="use_native_upload" class="mt-1 w-4 h-4 rounded border-gray-600 bg-gray-700 text-[#F15F22] focus:ring-2 focus:ring-[#F15F22] focus:ring-offset-0">
                        <div class="flex-1">
                            <label for="doc-upload-config-use-native" class="block text-sm font-semibold text-white cursor-pointer">Use Native Upload API</label>
                            <p class="text-xs text-gray-400 mt-1">When disabled, forces text extraction fallback instead of native API</p>
                        </div>
                    </div>
                </div>

                <!-- Max File Size Override -->
                <div>
                    <label for="doc-upload-config-max-size" class="block text-sm font-medium text-gray-300 mb-2">
                        Maximum File Size (MB)
                    </label>
                    <div class="flex items-center gap-3">
                        <input type="number" id="doc-upload-config-max-size" name="max_file_size_mb" min="1" max="100" step="1"
                            class="flex-1 px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-[#F15F22]"
                            placeholder="Leave empty for default">
                        <span id="doc-upload-config-default-size" class="text-xs text-gray-400"></span>
                    </div>
                    <p class="text-xs text-gray-400 mt-1">Override default file size limit (leave empty to use provider default)</p>
                </div>

                <!-- Supported Formats Override -->
                <div>
                    <label for="doc-upload-config-formats" class="block text-sm font-medium text-gray-300 mb-2">
                        Supported Formats (Override)
                    </label>
                    <input type="text" id="doc-upload-config-formats" name="supported_formats_override"
                        class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-[#F15F22]"
                        placeholder="e.g., pdf, docx, txt">
                    <p class="text-xs text-gray-400 mt-1">Comma-separated list (leave empty to use provider defaults)</p>
                    <div id="doc-upload-config-default-formats" class="mt-2 text-xs text-gray-500"></div>
                </div>

                <!-- Admin Notes -->
                <div>
                    <label for="doc-upload-config-notes" class="block text-sm font-medium text-gray-300 mb-2">
                        Admin Notes
                    </label>
                    <textarea id="doc-upload-config-notes" name="notes" rows="3"
                        class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-[#F15F22]"
                        placeholder="Add notes about why this configuration was changed..."></textarea>
                </div>

                <!-- Action Buttons -->
                <div class="flex gap-2 pt-4 border-t border-gray-600">
                    <button type="submit" class="flex-1 px-4 py-2 bg-[#F15F22] hover:bg-[#D9501A] rounded-md transition-colors text-white font-medium">
                        Save Changes
                    </button>
                    <button type="button" id="doc-upload-config-reset-btn" class="px-4 py-2 bg-yellow-600 hover:bg-yellow-700 rounded-md transition-colors text-white font-medium">
                        Reset to Defaults
                    </button>
                    <button type="button" id="doc-upload-config-cancel" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded-md transition-colors text-white font-medium">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Chat Modal -->
    <div id="chat-modal-overlay" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden opacity-0">
        <div id="chat-modal-content" class="glass-panel rounded-xl shadow-2xl w-full max-w-2xl p-6 transform scale-95 opacity-0 flex flex-col" style="height: 80vh;">
            <!-- Chat Modal Content -->
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold header-title">Direct Chat with Model</h3>
                <button type="button" id="chat-modal-close" class="p-2 rounded-full text-gray-400 hover:bg-white/10 hover:text-white transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div id="chat-modal-log" class="flex-1 w-full p-3 bg-gray-800/80 border border-gray-600 rounded-md overflow-y-auto space-y-4">
            </div>
            <form id="chat-modal-form" class="mt-4 flex items-center gap-3">
                <input type="text" id="chat-modal-input" placeholder="Send a message..."
                    class="flex-1 p-3 bg-gray-700 border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-teradata-orange text-white placeholder-gray-400"
                    autocomplete="off" />
                <button type="submit" id="chat-modal-submit"
                    class="p-3 bg-teradata-orange rounded-lg hover:bg-teradata-orange-dark flex items-center justify-center w-12 h-12 transition-colors">
                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg>
                </button>
            </form>
        </div>
    </div>
    <!-- Info Modal -->
    <div id="info-modal-overlay" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden opacity-0">
        <div id="info-modal-content" class="glass-panel rounded-xl shadow-2xl w-full max-w-lg p-6 transform scale-95 opacity-0">
            <!-- Info Modal Content -->
            <h3 class="text-xl font-bold mb-4 header-title">About This Project</h3>
            <div class="text-gray-300 space-y-4 text-sm">
                <!-- Project details -->
                <div>
                    <h4 class="font-semibold text-white mb-2">Overview</h4>
                    <p class="mb-3">The <strong>Uderia Platform</strong> delivers enterprise-grade AI orchestration with unmatched flexibility. Whether you leverage hyperscaler intelligence for maximum capability, run private local models for absolute sovereignty, or blend both approaches, you get cloud-level reasoning with complete control over your data and costs.</p>
                    <p class="mb-2">Experience a fundamental transformation in how you work with enterprise data:</p>
                    <ul class="space-y-1 text-sm mb-3">
                        <li> <strong>From Days to Seconds</strong> - Discover insights via conversation. Operationalize them via API.</li>
                        <li> <strong>From Guesswork to Clarity</strong> - Full transparency eliminates the AI black box.</li>
                        <li> <strong>From $$$ to </strong> - Revolutionary Fusion Optimizer for cost-effective execution.</li>
                        <li> <strong>From Data Exposure to Data Sovereignty</strong> - Your data, your rules, your environment.</li>
                        <li> <strong>From Hidden Costs to Total Visibility</strong> - Complete financial governance with real-time tracking.</li>
                        <li> <strong>From Isolated Expertise to Collective Intelligence</strong> - Transform insights through the Intelligence Marketplace.</li>
                    </ul>
                    
                    <hr class="border-white/10 my-4">

                    <h4 class="font-semibold text-white mb-2">Core Principles: A Superior Approach</h4>
                    <p class="mb-3">The Uderia Platform transcends typical data chat applications by delivering a seamless and powerful experience based on six core principles:</p>
                    <ul class="space-y-2 text-sm">
                        <li> <strong> Actionable:</strong> Go from conversational discovery to production-ready workflow in seconds. Your interactive queries can be immediately operationalized via REST API.</li>
                        <li> <strong> Transparent:</strong> Eliminate the "black box" of AI. The Live Status Window shows every step of the agent's thought process in real-time.</li>
                        <li> <strong> Efficient:</strong> The intelligent Fusion Optimizer uses a multi-layered architecture for resilient and cost-effective task execution.</li>
                        <li> <strong> Sovereignty:</strong> Your data, your rules, your environment. Leverage hyperscaler LLMs or run private models on your own infrastructure with Ollama.</li>
                        <li> <strong> Financial Governance:</strong> Complete cost transparency and control with real-time tracking, comprehensive analytics, and detailed visibility into every token consumed.</li>
                        <li> <strong> Collaborative:</strong> Transform isolated expertise into collective intelligence. The Intelligence Marketplace enables you to share proven execution patterns and domain knowledge.</li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-semibold text-white mb-1">Source Code & Contributions</h4>
                    <p>The Uderia Platform is open source and contributions are welcome. Please visit the main git project to report issues or submit pull requests.</p>
                    <p class="mt-2"><strong>Git Repository:</strong> <a href="https://github.com/rgeissen/uderia.git" target="_blank" class="text-teradata-orange hover:underline">https://github.com/rgeissen/uderia.git</a></p>
                </div>
                <hr class="border-white/10 my-4">
                <div>
                    <p class="text-xs text-gray-400">Uderia Platform Author/Initiator</p>
                    <p class="font-semibold text-white">Rainer Geissendoerfer, World-Wide Data Architecture, Teradata</p>
                </div>
            </div>
            <div class="flex justify-end mt-6">
                <button id="info-modal-close" class="px-4 py-2 rounded-md bg-teradata-orange hover:bg-teradata-orange-dark transition-colors font-semibold">Close</button>
            </div>
        </div>
    </div>

    <!-- Prompt Input Modal (for duplicate prompt name) -->
    <div id="prompt-input-modal-overlay" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden">
        <div class="glass-panel rounded-xl shadow-2xl w-full max-w-md p-6">
            <div class="flex items-center justify-between mb-4">
                <h3 id="prompt-input-modal-title" class="text-xl font-bold text-white">Enter Prompt Name</h3>
                <button type="button" id="prompt-input-modal-close" class="p-2 rounded-full text-gray-400 hover:bg-white/10 hover:text-white transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <form id="prompt-input-modal-form">
                <div class="mb-4">
                    <label id="prompt-input-modal-label" class="block text-sm font-medium text-gray-300 mb-2">Prompt Name</label>
                    <input type="text" id="prompt-input-modal-input" 
                           class="w-full px-3 py-2 bg-gray-800/80 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-teradata-orange" 
                           required>
                </div>
                <div class="flex justify-end gap-3">
                    <button type="button" id="prompt-input-modal-cancel" class="px-4 py-2 rounded-md bg-gray-700 hover:bg-gray-600 transition-colors font-semibold">Cancel</button>
                    <button type="submit" id="prompt-input-modal-ok" class="px-4 py-2 rounded-md bg-teradata-orange hover:bg-teradata-orange-dark transition-colors font-semibold">OK</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Add Planner Repository Modal -->
    <div id="add-rag-collection-modal-overlay" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden opacity-0">
        <div id="add-rag-collection-modal-content" class="glass-panel rounded-xl shadow-2xl w-full max-w-7xl p-6 transform scale-95 opacity-0 max-h-[90vh] overflow-y-auto">
            <!-- Modal Header -->
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-white">Add Planner Repository</h2>
                <button type="button" id="add-rag-collection-modal-close" class="p-2 rounded-full text-gray-400 hover:bg-white/10 hover:text-white transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Modal Body -->
            <form id="add-rag-collection-form" class="space-y-4">
                <div>
                    <label for="rag-collection-name" class="block text-sm font-medium text-gray-300 mb-2">
                        Collection Name <span class="text-red-400">*</span>
                    </label>
                    <input type="text" id="rag-collection-name" name="name" required
                           class="w-full p-3 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-teradata-orange focus:border-teradata-orange outline-none text-white"
                           placeholder="e.g., Teradata Query Patterns">
                </div>
                
                <div>
                    <label for="rag-collection-mcp-server" class="block text-sm font-medium text-gray-300 mb-2">
                        Associated MCP Server <span class="text-red-400">*</span>
                    </label>
                    <select id="rag-collection-mcp-server" name="mcp_server_name" required
                            class="w-full p-3 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-teradata-orange focus:border-teradata-orange outline-none text-white">
                        <option value="">Select an MCP Server...</option>
                        <!-- Options will be populated dynamically -->
                    </select>
                    <p class="mt-1 text-xs text-gray-400">This collection will store RAG cases for the selected MCP server</p>
                </div>
                
                <div>
                    <label for="rag-collection-description" class="block text-sm font-medium text-gray-300 mb-2">
                        Description (Optional)
                    </label>
                    <textarea id="rag-collection-description" name="description" rows="3"
                              class="w-full p-3 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-teradata-orange focus:border-teradata-orange outline-none text-white resize-none"
                              placeholder="Brief description of this collection's purpose..."></textarea>
                </div>

                <!-- Separator -->
                <div class="border-t border-gray-600 pt-4"></div>

                <!-- Template Options (always visible now) -->
                <div>
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-sm font-medium text-gray-300">Template Configuration</h3>
                    </div>
                    
                    <!-- Hidden inputs to maintain compatibility with existing code -->
                    <input type="radio" name="population-decision" value="template" id="rag-population-with-template" checked style="display:none;">
                    <input type="hidden" id="rag-collection-template-type">
                    
                    <div id="rag-collection-template-options" class="space-y-4">
                        <!-- Hidden inputs to maintain compatibility -->
                        <input type="radio" name="template-population-method" value="auto-generate" id="rag-template-method-llm" checked style="display:none;">
                        <input type="radio" name="template-population-method" value="manual" id="rag-template-method-manual" style="display:none;">

                        <!-- Manual Entry Fields -->
                        <div id="rag-collection-manual-fields" class="space-y-3">
                            <!-- SQL Template Specific Fields -->
                            <div id="rag-collection-sql-template-fields" class="space-y-3 template-fields">
                                <div class="grid grid-cols-2 gap-3">
                                    <div>
                                        <label class="block text-xs text-gray-400 mb-1">Database Name</label>
                                        <input type="text" id="rag-collection-template-db" 
                                               class="w-full p-2 bg-gray-600 border border-gray-500 rounded-md focus:ring-2 focus:ring-teradata-orange outline-none text-white text-sm"
                                               placeholder="e.g., production_db">
                                    </div>
                                    <div>
                                        <label class="block text-xs text-gray-400 mb-1">MCP Tool Name</label>
                                        <input type="text" id="rag-collection-template-tool" readonly
                                               class="w-full p-2 bg-gray-600 border border-gray-500 rounded-md text-gray-400 text-sm"
                                               placeholder="Loading...">
                                        <p class="text-xs text-gray-500 mt-1">From template configuration</p>
                                    </div>
                                </div>

                                <!-- Examples -->
                                <div>
                                    <div class="flex items-center justify-between mb-2">
                                        <label class="block text-xs font-medium text-gray-300">SQL Examples</label>
                                        <button type="button" id="rag-collection-template-add-example" class="text-xs text-blue-400 hover:text-blue-300 flex items-center gap-1">
                                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                                            </svg>
                                            Add Example
                                        </button>
                                    </div>
                                    <div id="rag-collection-template-examples" class="space-y-2 max-h-60 overflow-y-auto">
                                        <!-- Examples will be added here dynamically -->
                                    </div>
                                </div>
                            </div>

                            <!-- API Template Specific Fields (hidden by default) -->
                            <div id="rag-collection-api-template-fields" class="space-y-3 template-fields hidden">
                                <p class="text-sm text-gray-400">API Call template configuration will be available soon.</p>
                            </div>

                            <!-- Custom Template Specific Fields (hidden by default) -->
                            <div id="rag-collection-custom-template-fields" class="space-y-3 template-fields hidden">
                                <p class="text-sm text-gray-400">Custom template configuration will be available soon.</p>
                            </div>
                        </div>

                        <!-- LLM Workflow Container - 3 Column Layout -->
                        <div id="rag-collection-llm-workflow" class="hidden">
                            <div class="grid grid-cols-3 gap-6">
                                <!-- LEFT COLUMN: Setup Configuration -->
                                <div class="space-y-4">
                                    <div class="flex items-center gap-2 mb-3">
                                        <svg class="w-5 h-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                        </svg>
                                        <h3 class="text-base font-semibold text-white">Configuration</h3>
                                    </div>
                                    
                                    <!-- Configuration Fields -->
                                    <div id="rag-collection-llm-fields" class="space-y-3">
                                        <!-- Fields will be dynamically generated -->
                                    </div>
                                
                                <!-- Info Box -->
                                <div class="mt-6 p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                                    <div class="flex gap-2">
                                        <svg class="w-4 h-4 text-blue-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                        <p class="text-xs text-blue-300">Configure your generation parameters, then execute the workflow on the right.</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- MIDDLE COLUMN: Dynamic Prompt Preview -->
                            <div class="space-y-4">
                                <div class="flex items-center justify-between mb-3">
                                    <div class="flex items-center gap-2">
                                        <svg class="w-5 h-5 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                        </svg>
                                        <h3 class="text-base font-semibold text-white">Generation Prompt</h3>
                                    </div>
                                    <button type="button" id="rag-collection-refresh-prompt" 
                                            class="text-xs px-3 py-1.5 bg-purple-600/20 hover:bg-purple-600/30 text-purple-300 rounded-md flex items-center gap-1 transition-colors border border-purple-500/30"
                                            title="Refresh prompt preview">
                                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                        </svg>
                                        Refresh
                                    </button>
                                </div>
                                
                                <div class="bg-gray-800/50 rounded-lg p-4 border border-gray-600 h-[calc(100%-3rem)]">
                                    <textarea id="rag-collection-llm-prompt-preview" 
                                              class="w-full h-full p-3 bg-gray-900/70 border border-gray-700 rounded-lg text-xs font-mono text-gray-300 resize-none focus:outline-none focus:ring-2 focus:ring-purple-500"
                                              placeholder="Click Refresh to preview the prompt that will be sent to the LLM..."></textarea>
                                </div>
                                
                                <p class="text-xs text-gray-500 text-center">You can edit this prompt before generation</p>
                            </div>
                            
                            <!-- RIGHT COLUMN: 3-Step Execution Workflow -->
                            <div class="space-y-4">
                                <div class="flex items-center gap-2 mb-3">
                                    <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                    </svg>
                                    <h3 class="text-base font-semibold text-white">Workflow</h3>
                                </div>
                                
                                <!-- Step 1: Generate Context -->
                                <div id="rag-collection-step1-section" class="bg-gray-800/50 rounded-lg p-4 border border-blue-500/30">
                                    <div class="flex items-center gap-3 mb-3">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-blue-600 text-white font-bold text-sm flex-shrink-0">1</div>
                                        <div class="flex-1 min-w-0">
                                            <h4 class="text-sm font-semibold text-white">Generate Context</h4>
                                            <p class="text-xs text-gray-400">Extract database schema</p>
                                        </div>
                                    </div>
                                    <button type="button" id="rag-collection-generate-context" 
                                            class="w-full px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-500 transition-colors font-semibold text-white text-sm flex items-center justify-center gap-2">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                        </svg>
                                        <span>Generate</span>
                                    </button>
                                    
                                    <!-- Context Result -->
                                    <div id="rag-collection-context-result" class="hidden mt-3 pt-3 border-t border-gray-700">
                                        <div class="flex items-center justify-between mb-2">
                                            <div class="flex items-center gap-1">
                                                <svg class="w-3 h-3 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                                </svg>
                                                <span class="text-xs font-semibold text-green-400">Complete</span>
                                            </div>
                                            <button type="button" id="rag-collection-view-full-context" class="text-xs text-blue-400 hover:text-blue-300">View</button>
                                        </div>
                                        <div id="rag-collection-context-content" class="text-xs text-gray-400 font-mono bg-gray-900/50 rounded p-2 max-h-16 overflow-y-auto">
                                            <!-- Context summary -->
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Step 2: Generate Questions -->
                                <div id="rag-collection-step2-section" class="hidden bg-gray-800/50 rounded-lg p-4 border border-purple-500/30">
                                    <div class="flex items-center gap-3 mb-3">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-purple-600 text-white font-bold text-sm flex-shrink-0">2</div>
                                        <div class="flex-1 min-w-0">
                                            <h4 class="text-sm font-semibold text-white">Generate Questions</h4>
                                            <p class="text-xs text-gray-400">Create question/SQL pairs</p>
                                        </div>
                                    </div>
                                    <button type="button" id="rag-collection-generate-questions-btn" 
                                            class="w-full px-4 py-2 rounded-lg bg-purple-600 hover:bg-purple-500 transition-colors font-semibold text-white text-sm flex items-center justify-center gap-2">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                        </svg>
                                        <span>Generate</span>
                                    </button>
                                </div>
                                
                                <!-- Step 3: Review & Populate -->
                                <div id="rag-collection-questions-result" class="hidden bg-gray-800/50 rounded-lg p-4 border border-green-500/30">
                                    <div class="flex items-center gap-3 mb-3">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-green-600 text-white font-bold text-sm flex-shrink-0">3</div>
                                        <div class="flex-1 min-w-0">
                                            <h4 class="text-sm font-semibold text-white">Review & Populate</h4>
                                            <p class="text-xs text-gray-400" id="rag-collection-questions-count">5 pairs generated</p>
                                        </div>
                                    </div>
                                    
                                    <div id="rag-collection-questions-list" class="space-y-1.5 max-h-48 overflow-y-auto mb-3 text-xs">
                                        <!-- Questions list -->
                                    </div>
                                    
                                    <button type="button" id="rag-collection-populate-btn" 
                                            class="w-full px-4 py-2 rounded-lg bg-green-600 hover:bg-green-500 transition-colors font-semibold text-white text-sm flex items-center justify-center gap-2">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                        </svg>
                                        <span>Populate Collection</span>
                                    </button>
                                </div>
                            </div>
                            </div>
                        </div>
                        <!-- End LLM Workflow Container -->
                    </div>
                </div>
                
                <!-- Modal Footer -->
                <div class="flex justify-end gap-3 mt-6 pt-4 border-t border-gray-600">
                    <button type="button" id="add-rag-collection-cancel" class="px-4 py-2 rounded-md bg-gray-600 hover:bg-gray-500 transition-colors font-semibold text-white">
                        Cancel
                    </button>
                    <button type="submit" id="add-rag-collection-submit" class="px-4 py-2 rounded-md bg-teradata-orange hover:bg-teradata-orange-dark transition-colors font-semibold text-white">
                        Create Collection
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Add Knowledge Repository Modal -->
    <div id="add-knowledge-repository-modal-overlay" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden opacity-0 p-4">
        <div id="add-knowledge-repository-modal-content" class="glass-panel rounded-xl shadow-2xl w-full max-w-[1400px] transform scale-95 opacity-0 h-[90vh] flex flex-col">
            <!-- Modal Header -->
            <div class="flex items-center justify-between p-6 pb-4 border-b border-gray-700 flex-shrink-0">
                <div>
                    <h2 class="text-2xl font-bold text-white">Create Knowledge Repository</h2>
                    <p class="text-sm text-gray-400 mt-1">Configure your document storage and preview chunking strategy in real-time</p>
                </div>
                <button type="button" id="add-knowledge-repository-modal-close" class="p-2 rounded-full text-gray-400 hover:bg-white/10 hover:text-white transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Modal Body - Two Column Layout -->
            <div class="flex-1 overflow-hidden flex min-h-0">
            <form id="add-knowledge-repository-form" class="contents">
                <!-- Left Column - Configuration -->
                <div class="w-[45%] p-6 space-y-5 overflow-y-auto">
                    <!-- Basic Info -->
                    <div class="space-y-3">
                        <div>
                            <label for="knowledge-repo-name" class="block text-sm font-medium text-gray-300 mb-2">
                                Repository Name <span class="text-red-400">*</span>
                            </label>
                            <input type="text" id="knowledge-repo-name" name="name" required
                                   class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-teradata-orange focus:border-teradata-orange outline-none text-white"
                                   placeholder="e.g., Product Documentation">
                        </div>
                        
                        <div>
                            <label for="knowledge-repo-description" class="block text-sm font-medium text-gray-300 mb-2">
                                Description
                            </label>
                            <textarea id="knowledge-repo-description" name="description" rows="2"
                                      class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-teradata-orange focus:border-teradata-orange outline-none text-white resize-none"
                                      placeholder="Describe the knowledge contained in this repository..."></textarea>
                        </div>
                    </div>

                    <!-- Document Processing -->
                    <div class="space-y-3 pt-3 border-t border-gray-700">
                        <h3 class="text-base font-semibold text-white flex items-center gap-2">
                            <svg class="w-5 h-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            Processing Strategy
                        </h3>

                        <div>
                            <label for="knowledge-repo-chunking" class="block text-sm font-medium text-gray-300 mb-2">
                                Chunking Method <span class="text-red-400">*</span>
                            </label>
                            <select id="knowledge-repo-chunking" name="chunking_strategy" required
                                    class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-teradata-orange focus:border-teradata-orange outline-none text-white">
                                <option value="semantic"> Semantic - Smart splitting based on meaning</option>
                                <option value="paragraph"> Paragraph - Split by paragraphs</option>
                                <option value="sentence"> Sentence - Split by sentences</option>
                                <option value="fixed_size"> Fixed Size - Split by character count</option>
                            </select>
                            <p class="mt-1 text-xs text-gray-400">Controls how documents are divided for retrieval</p>
                        </div>

                        <div id="knowledge-repo-chunk-params" class="grid grid-cols-2 gap-3 hidden">
                            <div>
                                <label for="knowledge-repo-chunk-size" class="block text-xs text-gray-400 mb-1">Chunk Size</label>
                                <input type="number" id="knowledge-repo-chunk-size" name="chunk_size" value="1000" min="100" max="5000"
                                       class="w-full p-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-teradata-orange outline-none text-white text-sm">
                            </div>
                            <div>
                                <label for="knowledge-repo-chunk-overlap" class="block text-xs text-gray-400 mb-1">Chunk Overlap</label>
                                <input type="number" id="knowledge-repo-chunk-overlap" name="chunk_overlap" value="200" min="0" max="1000"
                                       class="w-full p-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-teradata-orange outline-none text-white text-sm">
                            </div>
                        </div>

                        <div>
                            <label for="knowledge-repo-embedding" class="block text-sm font-medium text-gray-300 mb-2">
                                Embedding Model <span class="text-red-400">*</span>
                            </label>
                            <select id="knowledge-repo-embedding" name="embedding_model" required
                                    class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-teradata-orange outline-none text-white">
                                <option value="all-MiniLM-L6-v2">all-MiniLM-L6-v2 (fast, lightweight)</option>
                                <option value="all-mpnet-base-v2">all-mpnet-base-v2 (balanced)</option>
                                <option value="all-distilroberta-v1">all-distilroberta-v1 (high quality)</option>
                            </select>
                        </div>
                    </div>

                    <!-- Document Upload -->
                    <div class="space-y-3 pt-3 border-t border-gray-700">
                        <h3 class="text-base font-semibold text-white flex items-center gap-2">
                            <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                            </svg>
                            Initial Documents
                        </h3>

                        <div id="knowledge-repo-dropzone" 
                             class="border-2 border-dashed border-gray-600 rounded-lg p-6 text-center cursor-pointer hover:border-teradata-orange hover:bg-gray-700/20 transition-all">
                            <svg class="w-10 h-10 mx-auto text-gray-400 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                            </svg>
                            <p class="text-gray-300 font-medium mb-1">Drop files or click to browse</p>
                            <p class="text-xs text-gray-400">PDF, TXT, DOCX, MD (max 50MB)</p>
                            <input type="file" id="knowledge-repo-file-input" multiple accept=".pdf,.txt,.docx,.md" class="hidden">
                        </div>

                        <div id="knowledge-repo-file-list" class="space-y-2 hidden">
                            <h4 class="text-sm font-medium text-gray-300">Selected Files:</h4>
                            <div id="knowledge-repo-files-container" class="space-y-2 max-h-32 overflow-y-auto">
                                <!-- File items will be added here -->
                            </div>
                        </div>

                        <div id="knowledge-repo-metadata" class="hidden space-y-2 bg-gray-700/30 rounded-lg p-3">
                            <h4 class="text-xs font-medium text-gray-300">Metadata (optional)</h4>
                            <div class="grid grid-cols-2 gap-2">
                                <input type="text" id="knowledge-repo-category" placeholder="Category"
                                       class="p-2 bg-gray-600 border border-gray-500 rounded-lg focus:ring-2 focus:ring-teradata-orange outline-none text-white text-sm">
                                <input type="text" id="knowledge-repo-author" placeholder="Author"
                                       class="p-2 bg-gray-600 border border-gray-500 rounded-lg focus:ring-2 focus:ring-teradata-orange outline-none text-white text-sm">
                            </div>
                            <input type="text" id="knowledge-repo-tags" placeholder="Tags (comma-separated)"
                                   class="w-full p-2 bg-gray-600 border border-gray-500 rounded-lg focus:ring-2 focus:ring-teradata-orange outline-none text-white text-sm">
                        </div>
                    </div>

                    <!-- Progress -->
                    <div id="knowledge-repo-progress" class="hidden space-y-2 bg-blue-500/10 border border-blue-500/30 rounded-lg p-3">
                        <div class="flex items-center gap-2">
                            <svg class="w-4 h-4 text-blue-400 animate-spin flex-shrink-0" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            <div class="flex-1 min-w-0">
                                <p id="knowledge-repo-progress-text" class="text-sm font-medium text-blue-300 truncate">Processing...</p>
                                <div class="w-full bg-gray-700 rounded-full h-1.5 mt-1">
                                    <div id="knowledge-repo-progress-bar" class="bg-blue-500 h-1.5 rounded-full transition-all" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Column - Live Preview -->
                <div class="w-[55%] p-6 bg-gray-800/30 flex flex-col min-h-0">
                    <div class="flex items-center justify-between mb-4 flex-shrink-0">
                        <div class="flex items-center gap-2">
                            <svg class="w-5 h-5 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                            </svg>
                            <h3 class="text-lg font-semibold text-white">Chunking Preview</h3>
                        </div>
                        <button type="button" id="knowledge-preview-toggle" 
                                class="flex items-center gap-2 px-3 py-1.5 rounded-lg bg-purple-500/20 hover:bg-purple-500/30 border border-purple-500/40 transition-colors">
                            <svg class="w-4 h-4 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                            </svg>
                            <span class="text-sm font-medium text-purple-300">Show Preview</span>
                        </button>
                    </div>

                    <!-- Preview Content Area -->
                    <div id="knowledge-repo-preview-empty" class="flex-1 flex items-center justify-center text-center">
                        <div class="max-w-md">
                            <svg class="w-20 h-20 mx-auto text-gray-600 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            <h4 class="text-lg font-medium text-gray-400 mb-2">No Preview Yet</h4>
                            <p class="text-sm text-gray-500">Upload a document to automatically preview how it will be chunked</p>
                        </div>
                    </div>

                    <div id="knowledge-repo-preview-results" class="hidden flex-1 flex flex-col min-h-0">
                        <!-- Stats Bar -->
                        <div class="flex items-center justify-between p-3 bg-purple-500/10 border border-purple-500/30 rounded-lg mb-4 flex-shrink-0">
                            <span class="text-sm font-medium text-purple-300">Statistics</span>
                            <span id="knowledge-repo-preview-stats" class="text-xs text-purple-400"></span>
                        </div>

                        <!-- Scrollable Chunks -->
                        <div class="flex-1 overflow-y-auto space-y-3 pr-2 min-h-0">
                            <div id="knowledge-repo-preview-chunks" class="space-y-3">
                                <!-- Chunk previews will be inserted here -->
                            </div>
                        </div>
                    </div>
                </div>
            </form>
            </div>

            <!-- Modal Footer -->
            <div class="flex items-center justify-between p-6 pt-4 border-t border-gray-700 flex-shrink-0">
                <div class="flex items-center gap-2 text-xs text-gray-400">
                    <svg class="w-4 h-4 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span>Documents are chunked, embedded, and made searchable through semantic similarity</span>
                </div>
                <div class="flex gap-3">
                    <button type="button" id="add-knowledge-repository-cancel" class="px-5 py-2.5 rounded-lg bg-gray-600 hover:bg-gray-500 transition-colors font-semibold text-white">
                        Cancel
                    </button>
                    <button type="submit" form="add-knowledge-repository-form" id="add-knowledge-repository-submit" class="px-5 py-2.5 rounded-lg bg-teradata-orange hover:bg-teradata-orange-dark transition-colors font-semibold text-white shadow-lg">
                        Create Repository
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- Template Editor Modal -->
    <div id="template-editor-modal-overlay" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden opacity-0">
        <div id="template-editor-modal-content" class="glass-panel rounded-xl shadow-2xl w-full max-w-3xl p-6 transform scale-95 opacity-0 max-h-[90vh] overflow-y-auto">
            <!-- Modal Header -->
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h2 class="text-2xl font-bold text-white">Edit Template Configuration</h2>
                    <p class="text-sm text-gray-400 mt-1">Customize input variables and default values</p>
                </div>
                <button type="button" id="template-editor-modal-close" class="p-2 rounded-full text-gray-400 hover:bg-white/10 hover:text-white transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <form id="template-editor-form" class="space-y-6">
                <!-- Template Info (Dynamic) -->
                <div id="template-editor-info" class="bg-gray-700/30 rounded-lg p-4 border border-gray-600">
                    <h3 id="template-editor-template-name" class="text-lg font-semibold text-white mb-2">Loading...</h3>
                    <p id="template-editor-template-description" class="text-sm text-gray-400"></p>
                </div>

                <!-- Input Variables Section (Dynamic) -->
                <div id="template-editor-input-variables" class="hidden">
                    <h3 class="text-lg font-semibold text-white mb-3 flex items-center gap-2">
                        <svg class="w-5 h-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        Input Variables
                    </h3>
                    <p class="text-xs text-gray-400 mb-4">Variables that users must provide when using this template</p>
                    <div id="template-editor-input-vars-content" class="space-y-3">
                        <!-- Dynamically populated -->
                    </div>
                </div>

                <!-- Configuration Fields (Dynamic) -->
                <div id="template-editor-config-fields">
                    <h3 class="text-lg font-semibold text-white mb-3 flex items-center gap-2">
                        <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        Configuration
                    </h3>
                    <p class="text-xs text-gray-400 mb-4">Editable configuration values for this template</p>
                    <div id="template-editor-config-content" class="space-y-3">
                        <!-- Dynamically populated -->
                    </div>
                </div>

                <!-- Info Notice -->
                <div class="bg-blue-500/10 border border-blue-500/30 rounded-lg p-4">
                    <div class="flex gap-3">
                        <svg class="w-5 h-5 text-blue-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <div class="text-sm text-blue-300">
                            <p class="font-medium mb-1">Template Configuration</p>
                            <p class="text-xs text-blue-400">These settings control default values for all cases generated from this template. Users can still override specific values when populating collections.</p>
                        </div>
                    </div>
                </div>

                <!-- Modal Footer -->
                <div class="flex justify-end gap-3 pt-4 border-t border-gray-600">
                    <button type="button" id="template-editor-cancel" class="px-4 py-2 rounded-md bg-gray-600 hover:bg-gray-500 transition-colors font-semibold text-white">
                        Cancel
                    </button>
                    <button type="submit" id="template-editor-submit" class="px-4 py-2 rounded-md bg-teradata-orange hover:bg-teradata-orange-dark transition-colors font-semibold text-white">
                        Save Changes
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Knowledge Collection Modal -->
    <div id="edit-rag-collection-modal-overlay" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden opacity-0">
        <div id="edit-rag-collection-modal-content" class="glass-panel rounded-xl shadow-2xl w-full max-w-lg p-6 transform scale-95 opacity-0">
            <!-- Modal Header -->
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-white">Edit Knowledge Collection</h2>
                <button type="button" id="edit-rag-collection-modal-close" class="p-2 rounded-full text-gray-400 hover:bg-white/10 hover:text-white transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Modal Body -->
            <form id="edit-rag-collection-form" class="space-y-4">
                <input type="hidden" id="edit-rag-collection-id" name="collection_id">
                
                <div>
                    <label for="edit-rag-collection-name" class="block text-sm font-medium text-gray-300 mb-2">
                        Collection Name <span class="text-red-400">*</span>
                    </label>
                    <input type="text" id="edit-rag-collection-name" name="name" required
                           class="w-full p-3 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-teradata-orange focus:border-teradata-orange outline-none text-white"
                           placeholder="e.g., Teradata Query Patterns">
                </div>
                
                <div>
                    <label for="edit-rag-collection-mcp-server" class="block text-sm font-medium text-gray-300 mb-2">
                        Associated MCP Server <span class="text-red-400">*</span>
                    </label>
                    <select id="edit-rag-collection-mcp-server" name="mcp_server_name" required
                            class="w-full p-3 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-teradata-orange focus:border-teradata-orange outline-none text-white">
                        <option value="">Select an MCP Server...</option>
                        <!-- Options will be populated dynamically -->
                    </select>
                    <p class="mt-1 text-xs text-gray-400">This collection will store RAG cases for the selected MCP server</p>
                </div>
                
                <div>
                    <label for="edit-rag-collection-description" class="block text-sm font-medium text-gray-300 mb-2">
                        Description (Optional)
                    </label>
                    <textarea id="edit-rag-collection-description" name="description" rows="3"
                              class="w-full p-3 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-teradata-orange focus:border-teradata-orange outline-none text-white resize-none"
                              placeholder="Brief description of this collection's purpose..."></textarea>
                </div>
                
                <!-- Modal Footer -->
                <div class="flex justify-end gap-3 mt-6 pt-4 border-t border-gray-600">
                    <button type="button" id="edit-rag-collection-cancel" class="px-4 py-2 rounded-md bg-gray-600 hover:bg-gray-500 transition-colors font-semibold text-white">
                        Cancel
                    </button>
                    <button type="submit" id="edit-rag-collection-submit" class="px-4 py-2 rounded-md bg-teradata-orange hover:bg-teradata-orange-dark transition-colors font-semibold text-white">
                        Save Changes
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- SQL Template Populator Modal -->
    <div id="sql-template-populator-modal-overlay" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden opacity-0">
        <div id="sql-template-populator-modal-content" class="glass-panel rounded-xl shadow-2xl w-full max-w-4xl p-6 transform scale-95 opacity-0 max-h-[90vh] overflow-y-auto">
            <!-- Modal Header -->
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h2 class="text-2xl font-bold text-white">SQL Template Populator</h2>
                    <p class="text-sm text-gray-400 mt-1">Bulk populate a collection with SQL query examples</p>
                </div>
                <button type="button" id="sql-template-populator-modal-close" class="p-2 rounded-full text-gray-400 hover:bg-white/10 hover:text-white transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Modal Body -->
            <form id="sql-template-populator-form" class="space-y-6">
                <!-- Collection Selection -->
                <div>
                    <label for="sql-template-collection-select" class="block text-sm font-medium text-gray-300 mb-2">
                        Target Collection <span class="text-red-400">*</span>
                    </label>
                    <select id="sql-template-collection-select" name="collection_id" required
                            class="w-full p-3 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-teradata-orange focus:border-teradata-orange outline-none text-white">
                        <option value="">Select a collection...</option>
                        <!-- Options will be populated dynamically -->
                    </select>
                    <p class="mt-1 text-xs text-gray-400">Cases will be added to this collection</p>
                </div>

                <!-- Optional Fields -->
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="sql-template-database-name" class="block text-sm font-medium text-gray-300 mb-2">
                            Database Name (Optional)
                        </label>
                        <input type="text" id="sql-template-database-name" name="database_name"
                               class="w-full p-3 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-teradata-orange focus:border-teradata-orange outline-none text-white"
                               placeholder="e.g., production_db">
                    </div>
                    <div>
                        <label for="sql-template-target-database" class="block text-sm font-medium text-gray-300 mb-2">
                            Target Database System
                        </label>
                        <input type="text" id="sql-template-target-database" name="target_database"
                               value="Teradata"
                               class="w-full p-3 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-teradata-orange focus:border-teradata-orange outline-none text-white"
                               placeholder="e.g., Teradata, PostgreSQL, MySQL">
                    </div>
                </div>
                <div>
                    <label for="sql-template-mcp-tool" class="block text-sm font-medium text-gray-300 mb-2">
                        MCP Tool Name (Optional)
                    </label>
                    <input type="text" id="sql-template-mcp-tool" name="mcp_tool_name"
                           class="w-full p-3 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-teradata-orange focus:border-teradata-orange outline-none text-white"
                           placeholder="Loading...">
                </div>

                <!-- Examples Input -->
                <div>
                    <div class="flex items-center justify-between mb-2">
                        <label class="block text-sm font-medium text-gray-300">
                            SQL Examples <span class="text-red-400">*</span>
                        </label>
                        <button type="button" id="sql-template-add-example" class="text-sm text-blue-400 hover:text-blue-300 flex items-center gap-1">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                            </svg>
                            Add Example
                        </button>
                    </div>
                    <div id="sql-template-examples-container" class="space-y-4">
                        <!-- Example rows will be added dynamically -->
                    </div>
                    <p class="mt-2 text-xs text-gray-400">
                        Each example consists of a user question and the corresponding SQL statement
                    </p>
                </div>

                <!-- Instructions -->
                <div class="bg-blue-500/10 border border-blue-500/30 rounded-lg p-4">
                    <div class="flex items-start gap-3">
                        <svg class="w-5 h-5 text-blue-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <div class="text-sm text-blue-300 space-y-1">
                            <p class="font-medium">How it works:</p>
                            <ul class="list-disc list-inside space-y-1 text-blue-400">
                                <li>Each example creates a two-phase RAG case: Execute SQL  Generate Report</li>
                                <li>Cases are marked as "champion" by default (is_most_efficient: true)</li>
                                <li>The agent will use these examples for similar queries in the future</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Progress/Results Area (hidden initially) -->
                <div id="sql-template-results" class="hidden">
                    <div class="bg-gray-700 rounded-lg p-4">
                        <h3 class="text-sm font-medium text-white mb-2">Population Results</h3>
                        <div id="sql-template-results-content" class="text-sm text-gray-300 space-y-1">
                            <!-- Results will be shown here -->
                        </div>
                    </div>
                </div>

                <!-- Modal Footer -->
                <div class="flex justify-end gap-3 pt-4 border-t border-gray-600">
                    <button type="button" id="sql-template-populator-cancel" class="px-4 py-2 rounded-md bg-gray-600 hover:bg-gray-500 transition-colors font-semibold text-white">
                        Cancel
                    </button>
                    <button type="submit" id="sql-template-populator-submit" class="px-4 py-2 rounded-md bg-[#F15F22] hover:bg-[#D9501A] transition-colors font-semibold text-white">
                        Populate Collection
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Prompt Editor Modal -->
    <div id="prompt-editor-overlay" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden opacity-0">
        <div id="prompt-editor-content" class="glass-panel rounded-xl shadow-2xl w-full max-w-3xl p-6 transform scale-95 opacity-0 flex flex-col" style="height: 80vh;">
            <!-- Prompt Editor Modal Content -->
            <div class="flex justify-between items-center mb-4">
                <h3 id="prompt-editor-title" class="text-xl font-bold header-title">System Prompt Editor</h3>
                <div id="prompt-editor-status" class="text-sm"></div>
            </div>
            <textarea id="prompt-editor-textarea" class="flex-1 w-full p-3 bg-gray-800/80 border border-gray-600 rounded-md focus:ring-2 focus:ring-teradata-orange focus:border-teradata-orange outline-none font-mono text-sm"></textarea>
            <div class="flex justify-between items-center mt-4">
                <button type="button" id="prompt-editor-reset" class="px-4 py-2 rounded-md bg-gray-600 hover:bg-gray-500 transition-colors">Reset to Default</button>
                <div>
                    <button type="button" id="prompt-editor-close" class="px-4 py-2 rounded-md bg-gray-600 hover:bg-gray-500 transition-colors mr-2">Close</button>
                    <button type="button" id="prompt-editor-save" class="px-4 py-2 rounded-md bg-teradata-orange hover:bg-teradata-orange-dark transition-colors font-semibold">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirm-modal-overlay" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden opacity-0">
        <div id="confirm-modal-content" class="glass-panel rounded-xl shadow-2xl w-full max-w-lg p-6 transform scale-95 opacity-0">
            <!-- Confirmation Modal Content -->
            <h3 id="confirm-modal-title" class="text-xl font-bold mb-4">Confirm Action</h3>
            <p id="confirm-modal-body" class="text-gray-300 mb-6"></p>
            <div class="flex justify-end gap-3">
                <button type="button" id="confirm-modal-cancel" class="px-4 py-2 rounded-md bg-gray-600 hover:bg-gray-500 transition-colors">Cancel</button>
                <button type="button" id="confirm-modal-confirm" class="px-4 py-2 rounded-md bg-teradata-orange hover:bg-teradata-orange-dark transition-colors font-semibold">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Prompt Invocation/Correction Modal -->
    <div id="prompt-modal-overlay" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden opacity-0">
        <div id="prompt-modal-content" class="glass-panel rounded-xl shadow-2xl w-full max-w-lg p-6 transform scale-95 opacity-0">
            <!-- Prompt Invocation/Correction Modal Content -->
            <h3 id="prompt-modal-title" class="text-xl font-bold mb-4"></h3>
            <form id="prompt-modal-form">
                <div id="prompt-modal-inputs" class="space-y-4 mb-6"></div>
                <div class="flex justify-end gap-3">
                    <button type="button" id="prompt-modal-close" class="px-4 py-2 rounded-md bg-gray-600 hover:bg-gray-500 transition-colors">Cancel</button>
                    <button type="submit" class="px-4 py-2 rounded-md bg-teradata-orange hover:bg-teradata-orange-dark transition-colors font-semibold">Run</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Context Result Modal -->
    <div id="context-result-modal-overlay" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden opacity-0">
        <div id="context-result-modal-content" class="glass-panel rounded-xl shadow-2xl w-full max-w-4xl p-6 transform scale-95 opacity-0 max-h-[90vh] overflow-y-auto">
            <!-- Modal Header -->
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h2 class="text-2xl font-bold text-white">Database Context Result</h2>
                    <p class="text-sm text-gray-400 mt-1">Raw context data retrieved from MCP prompt execution</p>
                </div>
                <button type="button" id="context-result-modal-close" class="p-2 rounded-full text-gray-400 hover:bg-white/10 hover:text-white transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <!-- Modal Body -->
            <div class="space-y-4">
                <!-- Prompt Text -->
                <div>
                    <h3 class="text-sm font-semibold text-white mb-2 flex items-center gap-2">
                        <svg class="w-4 h-4 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path>
                        </svg>
                        Executed Prompt
                    </h3>
                    <div id="context-result-prompt-text" class="bg-gray-800/50 rounded-lg p-3 text-xs text-gray-300 font-mono max-h-40 overflow-y-auto"></div>
                </div>

                <!-- Final Answer -->
                <div>
                    <h3 class="text-sm font-semibold text-white mb-2 flex items-center gap-2">
                        <svg class="w-4 h-4 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        Final Answer
                    </h3>
                    <div id="context-result-final-answer" class="bg-gray-800/50 rounded-lg p-3 text-xs text-gray-300 max-h-60 overflow-y-auto whitespace-pre-wrap"></div>
                </div>

                <!-- Context for Question Generation -->
                <div>
                    <h3 class="text-sm font-semibold text-white mb-2 flex items-center gap-2">
                        <svg class="w-4 h-4 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        Context for Question Generation
                        <span class="text-xs text-gray-400">(What will be sent to the LLM)</span>
                    </h3>
                    <div id="context-result-question-context" class="bg-gray-800/50 rounded-lg p-3 text-xs text-gray-300 max-h-80 overflow-y-auto whitespace-pre-wrap"></div>
                </div>

                <!-- Token Usage -->
                <div class="grid grid-cols-3 gap-3">
                    <div class="bg-gray-800/50 rounded-lg p-3">
                        <p class="text-xs text-gray-400 mb-1">Input Tokens</p>
                        <p id="context-result-input-tokens" class="text-lg font-semibold text-white">0</p>
                    </div>
                    <div class="bg-gray-800/50 rounded-lg p-3">
                        <p class="text-xs text-gray-400 mb-1">Output Tokens</p>
                        <p id="context-result-output-tokens" class="text-lg font-semibold text-white">0</p>
                    </div>
                    <div class="bg-gray-800/50 rounded-lg p-3">
                        <p class="text-xs text-gray-400 mb-1">Total Tokens</p>
                        <p id="context-result-total-tokens" class="text-lg font-semibold text-white">0</p>
                    </div>
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="flex justify-end gap-3 mt-6 pt-4 border-t border-gray-600">
                <button type="button" id="context-result-modal-ok" class="px-4 py-2 rounded-md bg-teradata-orange hover:bg-teradata-orange-dark transition-colors font-semibold text-white">
                    OK
                </button>
            </div>
        </div>
    </div>

    <!-- View Prompt Modal -->
    <div id="view-prompt-modal-overlay" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden opacity-0">
        <div id="view-prompt-modal-content" class="glass-panel rounded-xl shadow-2xl w-full max-w-3xl p-6 transform scale-95 opacity-0 flex flex-col" style="height: 80vh;">
            <!-- View Prompt Modal Content -->
            <div class="flex justify-between items-center mb-4">
                <h3 id="view-prompt-modal-title" class="text-xl font-bold header-title"></h3>
            </div>
            <div class="flex-1 w-full p-3 bg-gray-800/80 border border-gray-600 rounded-md overflow-y-auto">
                <pre id="view-prompt-modal-text" class="font-mono text-sm whitespace-pre-wrap"></pre>
            </div>
            <div class="flex justify-end items-center mt-4">
                <button type="button" id="view-prompt-modal-close" class="px-4 py-2 rounded-md bg-teradata-orange hover:bg-teradata-orange-dark transition-colors font-semibold">Close</button>
            </div>
        </div>
    </div>

    <script type="module" src="{{ url_for('static', filename='js/notifications.js') }}"></script>
    <!-- Centralized Banner System (Application & Conversation level) -->
    <script type="module" src="{{ url_for('static', filename='js/bannerSystem.js') }}"></script>
    <!-- Scroll Debugging Utility -->
    <script type="module" src="{{ url_for('static', filename='js/scrollDebug.js') }}"></script>
    <script src="{{ url_for('static', filename='js/executionDashboard.js') }}?v=2.9"></script>
    <script src="{{ url_for('static', filename='js/templateManager.js') }}"></script>
    <script src="{{ url_for('static', filename='js/adminManager.js') }}?v=3.0"></script>
    <script type="module" src="{{ url_for('static', filename='js/main.js') }}?v=2.9"></script>
    <script type="module" src="{{ url_for('static', filename='js/handlers/ragCollectionManagement.js') }}"></script>
    <script defer src="{{ url_for('static', filename='js/handlers/accessTokenManager.js') }}"></script>
    <script defer src="{{ url_for('static', filename='js/handlers/documentUploadConfigManager.js') }}"></script>
    <script defer src="{{ url_for('static', filename='js/handlers/costManagement.js') }}"></script>
    <!-- RAG Case Modal -->
    <div id="rag-case-modal-overlay" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden opacity-0">
        <div id="rag-case-modal-content" class="glass-panel rounded-xl shadow-2xl w-full max-w-4xl p-6 transform scale-95 opacity-0 flex flex-col" style="height: 90vh;">
            <div class="flex justify-between items-center mb-4">
                <h3 id="rag-case-modal-title" class="text-xl font-bold header-title">RAG Case Details: <span id="rag-case-id-display"></span></h3>
                <button type="button" id="rag-case-modal-close" class="p-2 rounded-full text-gray-400 hover:bg-white/10 hover:text-white transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div class="flex-1 w-full p-3 bg-gray-800/80 border border-gray-600 rounded-md overflow-y-auto">
                <pre id="rag-case-modal-json" class="font-mono text-sm whitespace-pre-wrap text-white"></pre>
            </div>
            <div class="flex justify-end items-center mt-4">
                <button type="button" id="rag-case-modal-copy" class="px-4 py-2 rounded-md bg-gray-600 hover:bg-gray-500 transition-colors mr-2">Copy to Clipboard</button>
                <button type="button" id="rag-case-modal-close-bottom" class="px-4 py-2 rounded-md bg-teradata-orange hover:bg-teradata-orange-dark transition-colors font-semibold">Close</button>
            </div>
        </div>
    </div>

    <!-- Add/Edit Profile Modal -->
    <div id="profile-modal" class="fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center z-50 hidden">
        <div class="glass-panel rounded-lg p-0 max-w-6xl w-full mx-4 shadow-xl overflow-hidden">
            <!-- Modal Header -->
            <div class="bg-gradient-to-r from-gray-800 to-gray-900 border-b-2 border-[#F15F22]/30 px-8 py-6 shadow-lg">
                <div class="flex items-center gap-3 mb-1">
                    <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-[#F15F22] to-[#D9501A] flex items-center justify-center shadow-lg shadow-orange-500/30">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                    </div>
                    <h3 class="text-2xl font-bold text-white" id="profile-modal-title">Edit Profile</h3>
                </div>
                <p class="text-gray-400 text-sm ml-13">Configure your agent profile with LLM, tools, and intelligence resources</p>
            </div>
            
            <!-- Modal Body -->
            <div class="p-8 space-y-6 max-h-[calc(100vh-200px)] overflow-y-auto custom-scrollbar">
                <!-- Row 1: Basic Info (Full Width) -->
                <div class="grid grid-cols-12 gap-4">
                    <div class="col-span-4">
                        <label class="block text-xs font-semibold text-gray-300 mb-2 uppercase tracking-wide">
                            Profile Name
                        </label>
                        <input type="text" id="profile-modal-name" placeholder="e.g., Production Environment" 
                               class="w-full px-4 py-2.5 bg-gray-800/40 border border-gray-700/50 rounded-lg 
                                      focus:ring-2 focus:ring-[#F15F22]/50 focus:border-[#F15F22]/50 outline-none transition-all
                                      placeholder-gray-600 text-gray-200 text-sm hover:border-gray-600/50">
                    </div>
                    <div class="col-span-4">
                        <label class="block text-xs font-semibold text-gray-300 mb-2 uppercase tracking-wide">
                            Profile Tag
                        </label>
                        <div class="flex items-center gap-2">
                            <div class="flex-1 flex items-center gap-2 px-4 py-2.5 bg-gray-800/40 border border-gray-700/50 rounded-lg 
                                        hover:border-gray-600/50 transition-all">
                                <span class="text-[#F15F22] font-mono text-base font-bold">@</span>
                                <input type="text" id="profile-modal-tag" placeholder="" maxlength="5"
                                       class="flex-1 bg-transparent border-none outline-none text-gray-100 text-sm font-mono uppercase tracking-wider"
                                       style="text-transform: uppercase;">
                            </div>
                            <button id="profile-modal-generate-tag" 
                                    class="px-3 py-2.5 bg-gray-700/40 hover:bg-gray-700/60 border border-gray-600/50 rounded-lg 
                                           text-gray-300 text-xs font-medium transition-all whitespace-nowrap hover:scale-105"
                                    title="Generate tag from configuration">
                                <svg class="w-4 h-4 inline-block mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                </svg>
                                Generate
                            </button>
                        </div>
                    </div>
                    <div class="col-span-4">
                        <label class="block text-xs font-semibold text-gray-300 mb-2 uppercase tracking-wide">
                            Description
                        </label>
                        <input type="text" id="profile-modal-description" placeholder="Brief description of this profile..." 
                               class="w-full px-4 py-2.5 bg-gray-800/40 border border-gray-700/50 rounded-lg 
                                      focus:ring-2 focus:ring-[#F15F22]/50 focus:border-[#F15F22]/50 outline-none transition-all
                                      placeholder-gray-600 text-gray-200 text-sm hover:border-gray-600/50">
                    </div>
                </div>

                <!-- Row 2: Provider Configuration (Side by Side) -->
                <div class="bg-gradient-to-br from-gray-800/30 to-gray-900/30 rounded-xl p-6 border border-gray-700/30">
                    <h4 class="text-sm font-bold text-white mb-4 flex items-center gap-2 uppercase tracking-wide">
                        <svg class="w-5 h-5 text-[#F15F22]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                        Provider Configuration
                    </h4>
                    <div class="grid grid-cols-2 gap-6">
                        <div>
                            <label class="block text-xs font-semibold text-gray-300 mb-2 uppercase tracking-wide">LLM Configuration</label>
                            <select id="profile-modal-llm-provider" 
                                    class="w-full px-4 py-3 bg-gray-800/60 border border-gray-700/50 rounded-lg 
                                           focus:ring-2 focus:ring-[#F15F22]/50 focus:border-[#F15F22]/50 outline-none transition-all
                                           text-gray-200 text-sm hover:border-gray-600/50 cursor-pointer"></select>
                        </div>
                        <div>
                            <label class="block text-xs font-semibold text-gray-300 mb-2 uppercase tracking-wide">MCP Server</label>
                            <select id="profile-modal-mcp-server" 
                                    class="w-full px-4 py-3 bg-gray-800/60 border border-gray-700/50 rounded-lg 
                                           focus:ring-2 focus:ring-[#F15F22]/50 focus:border-[#F15F22]/50 outline-none transition-all
                                           text-gray-200 text-sm hover:border-gray-600/50 cursor-pointer"></select>
                        </div>
                    </div>
                </div>

                <!-- Row 3: Classification Mode (Horizontal Layout) -->
                <div class="bg-gradient-to-br from-purple-900/10 to-blue-900/10 rounded-xl p-6 border border-purple-700/20">
                    <h4 class="text-sm font-bold text-white mb-2 flex items-center gap-2 uppercase tracking-wide">
                        <svg class="w-5 h-5 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path>
                        </svg>
                        Tool & Prompt Classification
                    </h4>
                    <p class="text-xs text-gray-400 mb-4">Choose how MCP tools and prompts are categorized in the UI</p>
                    <div class="grid grid-cols-2 gap-4">
                        <label class="relative flex items-start gap-3 p-4 bg-gray-800/30 border-2 border-gray-700/30 rounded-lg cursor-pointer hover:bg-gray-800/50 hover:border-blue-500/30 transition-all group">
                            <input type="radio" name="classification-mode" value="light" id="profile-modal-classification-light" checked
                                   class="mt-1 text-[#F15F22] focus:ring-[#F15F22] focus:ring-offset-gray-900">
                            <div class="flex-1">
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="text-base font-bold text-gray-100 group-hover:text-white">Light</span>
                                    <span class="px-2 py-0.5 text-xs font-bold bg-blue-500/30 text-blue-300 rounded-full border border-blue-400/30">Recommended</span>
                                </div>
                                <p class="text-xs text-gray-400 group-hover:text-gray-300">Generic categories: "All Tools", "All Prompts", "All Resources"</p>
                            </div>
                        </label>
                        
                        <label class="relative flex items-start gap-3 p-4 bg-gray-800/30 border-2 border-gray-700/30 rounded-lg cursor-pointer hover:bg-gray-800/50 hover:border-purple-500/30 transition-all group">
                            <input type="radio" name="classification-mode" value="full" id="profile-modal-classification-full"
                                   class="mt-1 text-[#F15F22] focus:ring-[#F15F22] focus:ring-offset-gray-900">
                            <div class="flex-1">
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="text-base font-bold text-gray-100 group-hover:text-white">Full</span>
                                    <span class="px-2 py-0.5 text-xs font-bold bg-purple-500/30 text-purple-300 rounded-full border border-purple-400/30">Semantic</span>
                                </div>
                                <p class="text-xs text-gray-400 group-hover:text-gray-300">LLM-powered semantic categorization (e.g., "Data Quality", "Performance")</p>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- Row 4: Tabbed Interface for MCP Resources and Intelligence Collections -->
                <div class="bg-gradient-to-br from-gray-800/30 to-gray-900/30 rounded-xl overflow-hidden border border-gray-700/30">
                    <!-- Tab Headers -->
                    <div class="flex border-b border-gray-700/50 bg-gray-900/60">
                        <button id="profile-tab-mcp-resources" 
                                class="flex-1 px-6 py-4 text-sm font-bold uppercase tracking-wide transition-all duration-300 flex items-center justify-center gap-2 border-b-3 border-[#F15F22] text-white bg-gradient-to-b from-gray-800/70 to-gray-900/50 shadow-lg relative">
                            <div class="absolute inset-x-0 bottom-0 h-0.5 bg-gradient-to-r from-[#F15F22] to-[#D9501A] shadow-lg shadow-orange-500/50"></div>
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path>
                            </svg>
                            MCP Resources
                        </button>
                        <button id="profile-tab-intelligence" 
                                class="flex-1 px-6 py-4 text-sm font-bold uppercase tracking-wide transition-all duration-300 flex items-center justify-center gap-2 border-b-2 border-transparent text-gray-400 hover:text-gray-200 hover:bg-gray-800/40 hover:border-gray-600/50">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                            </svg>
                            Intelligence Collections
                        </button>
                    </div>

                    <!-- Tab Content: MCP Resources -->
                    <div id="profile-content-mcp-resources" class="p-6">
                    <div class="grid grid-cols-2 gap-6">
                        <div>
                            <div class="flex items-center justify-between mb-2">
                                <label class="block text-xs font-semibold text-blue-300 uppercase tracking-wide flex items-center gap-2">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path>
                                    </svg>
                                    Available Tools
                                </label>
                                <button id="profile-modal-tools-uncheck-all" 
                                        class="px-2 py-1 text-xs text-gray-400 hover:text-gray-200 
                                               hover:bg-gray-700/40 rounded transition-all font-medium">
                                    Uncheck All
                                </button>
                            </div>
                            <div id="profile-modal-tools" 
                                 class="max-h-48 overflow-y-auto px-4 py-3 bg-gray-800/40 border border-gray-700/40 rounded-lg 
                                        hover:border-gray-700/60 transition-all custom-scrollbar space-y-1"></div>
                        </div>
                        <div>
                            <div class="flex items-center justify-between mb-2">
                                <label class="block text-xs font-semibold text-green-300 uppercase tracking-wide flex items-center gap-2">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                    </svg>
                                    Available Prompts
                                </label>
                                <button id="profile-modal-prompts-uncheck-all" 
                                        class="px-2 py-1 text-xs text-gray-400 hover:text-gray-200 
                                               hover:bg-gray-700/40 rounded transition-all font-medium">
                                    Uncheck All
                                </button>
                            </div>
                            <div id="profile-modal-prompts" 
                                 class="max-h-48 overflow-y-auto px-4 py-3 bg-gray-800/40 border border-gray-700/40 rounded-lg 
                                        hover:border-gray-700/60 transition-all custom-scrollbar space-y-1"></div>
                        </div>
                    </div>
                    </div>

                    <!-- Tab Content: Intelligence Collections -->
                    <div id="profile-content-intelligence" class="p-6 hidden">
                        <p class="text-xs text-gray-400 mb-4">Select which intelligence repositories should be available in this profile and enable autocomplete suggestions</p>
                    
                    <!-- Side-by-Side Layout for Planner and Knowledge -->
                    <div class="grid grid-cols-2 gap-6">
                        <!-- Planner Repositories (Left) -->
                        <div>
                            <div class="bg-gradient-to-br from-blue-900/20 to-cyan-900/20 rounded-lg p-4 border-2 border-blue-700/30">
                                <div class="flex items-center gap-2 mb-3">
                                    <svg class="w-5 h-5 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                                    </svg>
                                    <h4 class="text-sm font-bold text-white uppercase tracking-wide">Planner Repositories</h4>
                                </div>
                                <p class="text-xs text-gray-400 mb-3">Execution strategies and planning patterns from successful agent interactions</p>
                                <div class="bg-gray-900/50 border border-cyan-700/30 rounded-lg hover:border-cyan-700/50 transition-all">
                                    <!-- Column Headers -->
                                    <div class="flex items-center justify-between px-3 py-2 border-b border-cyan-700/20 bg-cyan-900/10">
                                        <span class="text-xs text-cyan-300/80 font-semibold uppercase tracking-wider">Collection Name</span>
                                        <div class="flex items-center gap-6 flex-shrink-0">
                                            <span class="text-xs text-cyan-300/80 font-semibold uppercase tracking-wider">Query</span>
                                            <span class="text-xs text-cyan-300/80 font-semibold uppercase tracking-wider">Autocomplete</span>
                                        </div>
                                    </div>
                                    <!-- Collections List -->
                                    <div id="profile-modal-planner-collections" 
                                         class="max-h-64 overflow-y-auto px-2 py-2 custom-scrollbar space-y-1"></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Knowledge Repositories (Right) -->
                        <div>
                            <div class="bg-gradient-to-br from-emerald-900/20 to-teal-900/20 rounded-lg p-4 border-2 border-emerald-700/30">
                                <div class="flex items-center gap-2 mb-3">
                                    <svg class="w-5 h-5 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                                    </svg>
                                    <h4 class="text-sm font-bold text-white uppercase tracking-wide">Knowledge Repositories</h4>
                                </div>
                                <p class="text-xs text-gray-400 mb-3">Document collections and reference materials for context augmentation. <span class="text-purple-400">Global settings configured in Administration panel.</span></p>
                                <div class="bg-gray-900/50 border border-emerald-700/30 rounded-lg hover:border-emerald-700/50 transition-all">
                                    <!-- Column Headers -->
                                    <div class="flex items-center justify-between px-3 py-2 border-b border-emerald-700/20 bg-emerald-900/10">
                                        <span class="text-xs text-emerald-300/80 font-semibold uppercase tracking-wider">Collection Name</span>
                                        <div class="flex items-center gap-6 flex-shrink-0">
                                            <span class="text-xs text-emerald-300/80 font-semibold uppercase tracking-wider">Query</span>
                                            <span class="text-xs text-emerald-300/80 font-semibold uppercase tracking-wider">Autocomplete</span>
                                        </div>
                                    </div>
                                    <!-- Collections List -->
                                    <div id="profile-modal-knowledge-collections" 
                                         class="max-h-64 overflow-y-auto px-2 py-2 custom-scrollbar space-y-1"></div>
                                </div>
                                
                                <!-- Per-Collection Reranking Configuration -->
                                <div class="mt-4 bg-purple-900/10 border border-purple-700/30 rounded-lg p-4">
                                    <label class="block text-xs font-semibold text-purple-300 mb-2 uppercase tracking-wide">LLM Reranking (Per-Collection Override)</label>
                                    <p class="text-xs text-gray-400 mb-3">Enable LLM-powered reranking for specific collections to improve relevance (incurs additional LLM costs)</p>
                                    <div id="profile-modal-knowledge-reranking-list" class="space-y-2">
                                        <!-- Reranking toggles will be populated dynamically for selected knowledge collections -->
                                    </div>
                                </div>

                                <!-- Advanced Knowledge Configuration -->
                                <div class="mt-4 bg-emerald-900/10 border border-emerald-700/30 rounded-lg p-4">
                                    <label class="block text-xs font-semibold text-emerald-300 mb-3 uppercase tracking-wide">Advanced Settings</label>
                                    <p class="text-xs text-gray-400 mb-4">Override global knowledge retrieval settings for this profile</p>
                                    
                                    <div class="grid grid-cols-3 gap-4">
                                        <!-- Min Relevance Score -->
                                        <div>
                                            <label for="profile-modal-min-relevance" class="block text-xs font-medium text-gray-300 mb-1.5">
                                                Min Relevance Score
                                            </label>
                                            <input type="number" id="profile-modal-min-relevance" 
                                                   min="0" max="1" step="0.05"
                                                   placeholder="0.70"
                                                   class="w-full px-3 py-2 bg-gray-800/70 border border-emerald-700/40 rounded-lg text-sm text-white 
                                                          placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-emerald-500/50 focus:border-emerald-500/50
                                                          hover:border-emerald-600/50 transition-all">
                                            <p class="text-[10px] text-gray-500 mt-1">Cosine similarity threshold (0.0-1.0)</p>
                                        </div>

                                        <!-- Max Documents -->
                                        <div>
                                            <label for="profile-modal-max-docs" class="block text-xs font-medium text-gray-300 mb-1.5">
                                                Max Documents
                                            </label>
                                            <input type="number" id="profile-modal-max-docs" 
                                                   min="1" max="10" step="1"
                                                   placeholder="3"
                                                   class="w-full px-3 py-2 bg-gray-800/70 border border-emerald-700/40 rounded-lg text-sm text-white 
                                                          placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-emerald-500/50 focus:border-emerald-500/50
                                                          hover:border-emerald-600/50 transition-all">
                                            <p class="text-[10px] text-gray-500 mt-1">Number of chunks to retrieve</p>
                                        </div>

                                        <!-- Max Tokens -->
                                        <div>
                                            <label for="profile-modal-max-tokens" class="block text-xs font-medium text-gray-300 mb-1.5">
                                                Max Tokens
                                            </label>
                                            <input type="number" id="profile-modal-max-tokens" 
                                                   min="500" max="10000" step="100"
                                                   placeholder="2000"
                                                   class="w-full px-3 py-2 bg-gray-800/70 border border-emerald-700/40 rounded-lg text-sm text-white 
                                                          placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-emerald-500/50 focus:border-emerald-500/50
                                                          hover:border-emerald-600/50 transition-all">
                                            <p class="text-[10px] text-gray-500 mt-1">Context window limit</p>
                                        </div>
                                    </div>
                                    
                                    <p class="text-[10px] text-gray-400 mt-3 italic">Leave empty to use global defaults from Administration panel</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    </div>
                </div>


            </div>

            <!-- Modal Footer -->
            <div class="bg-gradient-to-r from-gray-800 to-gray-900 border-t-2 border-gray-700/50 px-8 py-6 flex gap-4">
                <button id="profile-modal-cancel" 
                        class="px-8 py-3 bg-slate-700 hover:bg-slate-600 rounded-lg transition-all duration-300 
                               text-gray-200 text-sm font-semibold shadow-md hover:shadow-lg ring-1 ring-slate-500/30 hover:ring-slate-400/50 hover:scale-[1.02] transform">
                    <svg class="w-4 h-4 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                    Cancel
                </button>
                <button id="profile-modal-save" 
                        class="flex-1 px-8 py-3 bg-gradient-to-r from-[#F15F22] to-[#D9501A] rounded-lg transition-all duration-300 
                               text-white text-sm font-bold shadow-lg shadow-orange-500/50 ring-2 ring-orange-400/30 hover:shadow-xl hover:shadow-orange-500/70 hover:ring-orange-400/50 hover:scale-[1.02] transform">
                    <svg class="w-5 h-5 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    Save Profile
                </button>
            </div>
        </div>
    </div>

    <!-- Classification Results Modal -->
    <div id="classification-modal" class="fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center z-50 hidden">
        <div class="glass-panel rounded-lg p-0 max-w-4xl w-full mx-4 shadow-xl overflow-hidden">
            <!-- Modal Header -->
            <div class="bg-gray-800/80 border-b border-gray-700/50 px-6 py-4 flex items-center justify-between">
                <div>
                    <h3 class="text-lg font-semibold text-gray-100" id="classification-modal-title">Classification Results</h3>
                    <p class="text-gray-400 text-xs mt-1" id="classification-modal-subtitle"></p>
                </div>
                <button id="classification-modal-close" class="text-gray-400 hover:text-white transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Modal Body -->
            <div class="p-6 max-h-[calc(100vh-200px)] overflow-y-auto">
                <div id="classification-modal-content" class="space-y-6">
                    <!-- Content will be dynamically populated -->
                </div>
            </div>
        </div>
    </div>

    <!-- Authentication Client -->
    <script src="/static/js/auth.js"></script>
    <script>
        // ============================================================================
        // THEME MANAGEMENT
        // ============================================================================
        const ThemeManager = {
            STORAGE_KEY: 'tda-theme',
            DEFAULT_THEME: 'legacy',
            
            /**
             * Initialize theme on page load
             */
            init() {
                // Load saved theme or use admin default
                const savedTheme = this.getTheme();
                this.applyTheme(savedTheme, false); // false = no transition on init
                
                // Set up theme selector buttons
                this.setupThemeSelectors();
                
                // Update button states
                this.updateButtonStates(savedTheme);
            },
            
            /**
             * Get current theme from localStorage or admin default
             */
            getTheme() {
                const saved = localStorage.getItem(this.STORAGE_KEY);
                if (saved) {
                    console.log('[ThemeManager] Using saved theme:', saved);
                    return saved;
                }
                
                // Check if admin has set a default theme (use window.appConfigData instead of state)
                const adminDefault = window.appConfigData?.window_defaults?.default_theme;
                console.log('[ThemeManager] Admin default theme:', adminDefault);
                console.log('[ThemeManager] Full appConfig:', window.appConfigData);
                return adminDefault || this.DEFAULT_THEME;
            },
            
            /**
             * Save theme to localStorage
             */
            saveTheme(theme) {
                localStorage.setItem(this.STORAGE_KEY, theme);
            },
            
            /**
             * Apply theme to document
             */
            applyTheme(theme, withTransition = true) {
                const body = document.body;
                
                // Disable transitions during initial load
                if (!withTransition) {
                    body.classList.add('no-transition');
                }
                
                // Set theme attribute
                body.setAttribute('data-theme', theme);
                
                // Re-enable transitions after a brief delay
                if (!withTransition) {
                    setTimeout(() => {
                        body.classList.remove('no-transition');
                    }, 50);
                }
                
                console.log(`[ThemeManager] Applied theme: ${theme}`);
            },
            
            /**
             * Switch to a different theme
             */
            switchTheme(theme) {
                this.saveTheme(theme);
                this.applyTheme(theme, true);
                this.updateButtonStates(theme);
                
                // Show notification
                if (window.showNotification) {
                    const themeName = theme.charAt(0).toUpperCase() + theme.slice(1);
                    window.showNotification('success', `Switched to ${themeName} theme`);
                }
            },
            
            /**
             * Set up event listeners for theme selector buttons
             */
            setupThemeSelectors() {
                const selectors = document.querySelectorAll('.theme-selector');
                selectors.forEach(button => {
                    button.addEventListener('click', () => {
                        const theme = button.getAttribute('data-theme');
                        this.switchTheme(theme);
                    });
                });
            },
            
            /**
             * Update button states to show active theme
             */
            updateButtonStates(activeTheme) {
                const selectors = document.querySelectorAll('.theme-selector');
                selectors.forEach(button => {
                    const theme = button.getAttribute('data-theme');
                    if (theme === activeTheme) {
                        button.classList.add('bg-[#F15F22]', 'border-[#F15F22]', 'text-white');
                        button.classList.remove('border-white/20');
                    } else {
                        button.classList.remove('bg-[#F15F22]', 'border-[#F15F22]', 'text-white');
                        button.classList.add('border-white/20');
                    }
                });
            }
        };
        
        // ============================================================================
        // AUTHENTICATION
        // ============================================================================
        // Initialize authentication
        window.authClient = new AuthClient();
        
        // Load app config early to get default theme before initializing ThemeManager
        // Fetch app config and make it globally available
        window.appConfigData = null;
        (async () => {
            try {
                const token = window.authClient.getToken();
                const res = await fetch('/app-config', {
                    headers: token ? {
                        'Authorization': `Bearer ${token}`
                    } : {}
                });
                window.appConfigData = await res.json();
                console.log('[Startup] App config loaded:', window.appConfigData);
            } catch (error) {
                console.error('[Startup] Error loading app config:', error);
                window.appConfigData = { window_defaults: { default_theme: 'legacy' } };
            }
            
            // Initialize theme after appConfig is loaded
            ThemeManager.init();
        })();
        
        // Global pane visibility cache
        let paneVisibilityCache = null;
        
        /**
         * Update pane visibility based on user tier and configuration
         */
        async function updatePaneVisibility(userTier = null) {
            try {
                // Get user tier if not provided
                if (!userTier) {
                    const user = window.authClient.getUser();
                    userTier = user?.profile_tier || 'user';
                }
                
                console.log(`[PaneVisibility] Starting update for tier: ${userTier}`);
                
                // Fetch pane visibility configuration
                const token = window.authClient.getToken();
                if (!token) {
                    console.warn('[PaneVisibility] No token available');
                    return;
                }
                
                const response = await fetch('/api/v1/auth/me/panes', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (!response.ok) {
                    console.warn(`[PaneVisibility] API error: ${response.status} ${response.statusText}`);
                    return;
                }
                
                const data = await response.json();
                console.log(`[PaneVisibility] API response:`, data);
                
                if (data.status !== 'success' || !data.panes) {
                    console.warn('[PaneVisibility] Invalid pane visibility response:', data);
                    return;
                }
                
                console.log(`[PaneVisibility] Received ${data.panes.length} pane configurations`);
                paneVisibilityCache = data.panes;
                
                // Apply visibility to each pane
                const paneMap = {
                    'conversation': 'view-switch-conversation',
                    'executions': 'view-switch-executions',
                    'rag-maintenance': 'view-switch-rag-maintenance',
                    'marketplace': 'view-switch-rag-marketplace',
                    'credentials': 'view-switch-credentials',
                    'admin': 'view-switch-admin'
                };
                
                data.panes.forEach(pane => {
                    const elementId = paneMap[pane.pane_id];
                    if (!elementId) {
                        console.warn(`[PaneVisibility] No element mapping for pane: ${pane.pane_id}`);
                        return;
                    }
                    
                    const paneElement = document.getElementById(elementId);
                    if (!paneElement) {
                        console.warn(`[PaneVisibility] Element not found: ${elementId}`);
                        return;
                    }
                    
                    // Determine if pane should be visible for this tier
                    let isVisible = false;
                    if (userTier === 'admin') {
                        isVisible = pane.visible_to_admin;
                    } else if (userTier === 'developer') {
                        isVisible = pane.visible_to_developer;
                    } else {
                        isVisible = pane.visible_to_user;
                    }
                    
                    console.log(`[PaneVisibility] ${pane.pane_id}: visible=${isVisible} (tier=${userTier}, admin=${pane.visible_to_admin}, dev=${pane.visible_to_developer}, user=${pane.visible_to_user})`);
                    
                    // Show or hide pane
                    if (isVisible) {
                        paneElement.classList.remove('hidden');
                    } else {
                        paneElement.classList.add('hidden');
                    }
                });
                
                console.log(`[PaneVisibility] Updated for ${userTier} tier - processed ${data.panes.length} panes`);
                
                // After updating pane visibility, re-apply Planner Repository navigation state
                if (typeof window.updatePlannerRepositoryNavigation === 'function') {
                    window.updatePlannerRepositoryNavigation();
                }
                
            } catch (error) {
                console.error('[PaneVisibility] Error updating pane visibility:', error);
            }
        }
        
        // Make updatePaneVisibility globally accessible
        window.updatePaneVisibility = updatePaneVisibility;
        
        // Update UI based on authentication state
        async function updateAuthUI() {
            const isAuth = window.authClient.isAuthenticated();
            const user = window.authClient.getUser();
            
            const userMenuContainer = document.getElementById('user-menu-container');
            const loginButtonContainer = document.getElementById('login-button-container');
            
            if (isAuth && user) {
                // Show user menu
                userMenuContainer.classList.remove('hidden');
                loginButtonContainer.classList.add('hidden');
                
                // Update user info
                const initial = user.display_name ? user.display_name.charAt(0).toUpperCase() : user.username.charAt(0).toUpperCase();
                document.getElementById('user-avatar-initial').textContent = initial;
                document.getElementById('user-display-name').textContent = user.display_name || user.username;
                document.getElementById('user-menu-name').textContent = user.display_name || user.username;
                document.getElementById('user-menu-email').textContent = user.email;
                
                // Check if user has admin privileges and show/hide admin menu
                const adminMenuItem = document.getElementById('view-switch-admin');
                if (adminMenuItem) {
                    // Always check /me endpoint to get current tier and validate token
                    fetch('/api/v1/auth/me', {
                        headers: {
                            'Authorization': `Bearer ${window.authClient.getToken()}`
                        }
                    })
                    .then(res => {
                        if (res.status === 401) {
                            // Token is invalid or expired, clear session and redirect
                            console.log('Token invalid, clearing session');
                            window.authClient.clearSession();
                            window.location.href = '/login';
                            return null;
                        }
                        return res.json();
                    })
                    .then(data => {
                        if (!data) return; // Already handled redirect above
                        
                        if (data.status === 'success' && data.user) {
                            console.log('[AuthUI] User data from /me:', data.user);
                            console.log('[AuthUI] Profile tier:', data.user.profile_tier);
                            console.log('[AuthUI] Is admin:', data.user.is_admin);
                            
                            // Update cached user data with current info from server
                            window.authClient.setSession(window.authClient.getToken(), data.user);
                            
                            // Check if user is admin tier or has is_admin flag
                            if (data.user.profile_tier === 'admin' || data.user.is_admin) {
                                console.log('[AuthUI] User is admin, showing admin menu');
                                adminMenuItem.classList.remove('hidden');
                            } else {
                                console.log('[AuthUI] User is not admin, hiding admin menu');
                                adminMenuItem.classList.add('hidden');
                            }
                            
                            // Update pane visibility based on user tier
                            console.log('[AuthUI] Calling updatePaneVisibility with tier:', data.user.profile_tier);
                            updatePaneVisibility(data.user.profile_tier);
                        } else {
                            adminMenuItem.classList.add('hidden');
                        }
                    })
                    .catch(err => {
                        console.error('Error checking admin status:', err);
                        // On network error, try to use cached user data
                        if (user.profile_tier === 'admin' || user.is_admin) {
                            adminMenuItem.classList.remove('hidden');
                        } else {
                            adminMenuItem.classList.add('hidden');
                        }
                        // Still try to update pane visibility with cached tier
                        updatePaneVisibility(user.profile_tier);
                    });
                }
                
                console.log('Authenticated as:', user.username);
                
                // Enable all view switches for authenticated users
                document.querySelectorAll('.view-switch-button').forEach(btn => {
                    if (btn.id !== 'view-switch-admin') { // Admin is controlled separately
                        btn.classList.remove('pointer-events-none', 'opacity-50', 'cursor-not-allowed');
                        btn.removeAttribute('title');
                    }
                });
                
                // Configure welcome button for authenticated user
                const welcomeBtn = document.getElementById('welcome-configure-btn');
                const welcomeBtnText = document.getElementById('welcome-button-text');
                const welcomeCogwheelIcon = document.getElementById('welcome-cogwheel-icon');
                const welcomeLoginIcon = document.getElementById('welcome-login-icon');
                const welcomeConfigInfo = document.getElementById('welcome-config-info');
                
                // Don't set button text here - let main.js showWelcomeScreen() handle validation
                // to avoid race conditions and flickering
                
                if (welcomeCogwheelIcon) welcomeCogwheelIcon.classList.remove('hidden');
                if (welcomeLoginIcon) welcomeLoginIcon.classList.add('hidden');
                if (welcomeConfigInfo) welcomeConfigInfo.classList.remove('hidden');
                if (welcomeBtn) {
                    // Remove any previous click listeners by cloning
                    const newBtn = welcomeBtn.cloneNode(true);
                    welcomeBtn.parentNode.replaceChild(newBtn, welcomeBtn);
                    // Add original click listener back
                    newBtn.addEventListener('click', async function() {
                        const welcomeScreen = document.getElementById('welcome-screen');
                        const welcomeBtn = document.getElementById('welcome-configure-btn');
                        const welcomeBtnText = document.getElementById('welcome-button-text');
                        const welcomeBtnSpinner = document.getElementById('welcome-button-spinner');
                        
                        // Check button text to determine action
                        const buttonText = welcomeBtnText ? welcomeBtnText.textContent : '';
                        
                        if (buttonText === 'Configure Application') {
                            // Profile needs configuration - go to credentials view
                            console.log('[Welcome Button] Configure Application clicked - switching to credentials view');
                            const { handleViewSwitch } = await import('/static/js/ui.js?v=2.9');
                            handleViewSwitch('credentials-view');
                            return;
                        }
                        
                        // Button says "Start Conversation" - profile is valid, proceed with session
                        console.log('[Welcome Button] Start Conversation clicked (authenticated user)');
                        
                        // Show loading state - keep welcome screen visible
                        if (welcomeBtn) welcomeBtn.disabled = true;
                        if (welcomeBtnText) welcomeBtnText.textContent = 'Loading...';
                        if (welcomeBtnSpinner) welcomeBtnSpinner.classList.remove('hidden');
                        
                        // Remove any previous error message
                        const existingError = document.getElementById('welcome-validation-error');
                        if (existingError) existingError.remove();
                        
                        // Load sessions and initialize
                        try {
                            // Import required modules
                            const { checkServerStatus } = await import('/static/js/api.js');
                            const { finalizeConfiguration } = await import('/static/js/handlers/configManagement.js');
                            const { handleViewSwitch } = await import('/static/js/ui.js?v=2.9');
                            
                            // Get current config from status
                            const status = await checkServerStatus();
                            console.log('[Welcome Button] Status:', status);
                            
                            if (!status.isConfigured) {
                                console.log('[Welcome Button] System not configured - switching to credentials view');
                                handleViewSwitch('credentials-view');
                                return;
                            }
                            
                            // System is configured - check for existing sessions
                            console.log('[Welcome Button] System configured, checking for existing sessions...');
                            
                            const headers = { 'Content-Type': 'application/json' };
                            const authToken = localStorage.getItem('tda_auth_token');
                            if (authToken) {
                                headers['Authorization'] = `Bearer ${authToken}`;
                            }
                            
                            try {
                                // First, check if there are existing sessions (with timeout)
                                const sessionsResponse = await Promise.race([
                                    fetch('/sessions', { headers }),
                                    new Promise((_, reject) => setTimeout(() => reject(new Error('Request timed out')), 30000))
                                ]);
                                const sessions = await sessionsResponse.json();
                                
                                let sessionToLoad = null;
                                
                                if (sessions && sessions.length > 0) {
                                    // Load the most recent session (first in list)
                                    sessionToLoad = sessions[0];
                                    console.log('[Welcome Button] Loading most recent session:', sessionToLoad.id);
                                } else {
                                    // No existing sessions - create a new one and validate LLM
                                    console.log('[Welcome Button] No existing sessions, creating new session and validating LLM...');
                                    const sessionResponse = await Promise.race([
                                        fetch('/session', {
                                            method: 'POST',
                                            headers: headers,
                                            body: JSON.stringify({})  // Empty body to satisfy endpoint
                                        }),
                                        new Promise((_, reject) => setTimeout(() => reject(new Error('Session creation timed out')), 30000))
                                    ]);
                                    
                                    console.log('[Welcome Button] Session response status:', sessionResponse.status, sessionResponse.ok);
                                    const sessionResult = await sessionResponse.json();
                                    console.log('[Welcome Button] Session result:', sessionResult);
                                    
                                    if (!sessionResponse.ok) {
                                        console.error('[Welcome Button] Session creation failed:', sessionResult);
                                        throw new Error(sessionResult.error || sessionResult.message || 'Failed to validate configuration');
                                    }
                                    
                                    sessionToLoad = sessionResult;
                                    console.log('[Welcome Button] New session created and LLM validated:', sessionResult);
                                }
                                
                                // Store the session to load
                                if (sessionToLoad) {
                                    localStorage.setItem('sessionToLoad', sessionToLoad.id);
                                }
                            } catch (validationError) {
                                console.error('[Welcome Button] Session creation/validation failed:', validationError);
                                // Credentials may be invalid - redirect to configuration
                                const { handleViewSwitch } = await import('/static/js/ui.js?v=2.9');
                                handleViewSwitch('credentials-view');
                                return;
                            }
                            
                            const currentConfig = { 
                                provider: status.provider, 
                                model: status.model,
                                mcp_server: status.mcp_server 
                            };
                            
                            console.log('[Welcome Button] Calling finalizeConfiguration with config:', currentConfig);
                            await finalizeConfiguration(currentConfig, true);
                            
                            // Only hide welcome screen after successful validation
                            console.log('[Welcome Button] Validation successful, hiding welcome screen');
                            if (welcomeScreen) {
                                welcomeScreen.classList.add('hidden');
                                localStorage.setItem('welcomeScreenShown', 'true');
                            }
                            
                        } catch (error) {
                            console.error('[Welcome Button] Error initializing:', error);
                            // Redirect to configuration on any error
                            const { handleViewSwitch } = await import('/static/js/ui.js?v=2.9');
                            handleViewSwitch('credentials-view');
                        }
                    });
                }
            } else {
                // Hide login button (login CTA shown on welcome screen instead)
                userMenuContainer.classList.add('hidden');
                loginButtonContainer.classList.add('hidden');
                
                // Hide admin menu
                const adminMenuItem = document.getElementById('view-switch-admin');
                if (adminMenuItem) {
                    adminMenuItem.classList.add('hidden');
                }
                
                // Disable all view switches except conversation
                document.querySelectorAll('.view-switch-button').forEach(btn => {
                    if (btn.id !== 'view-switch-conversation') {
                        btn.classList.add('pointer-events-none', 'opacity-50', 'cursor-not-allowed');
                        btn.setAttribute('title', 'Please login to access this view');
                    }
                });
                
                // Ensure conversation view is active
                const conversationView = document.getElementById('conversation-view');
                if (conversationView && conversationView.classList.contains('hidden')) {
                    // Switch to conversation view
                    document.querySelectorAll('.view-container').forEach(view => view.classList.add('hidden'));
                    conversationView.classList.remove('hidden');
                    
                    // Update active state
                    document.querySelectorAll('.view-switch-button').forEach(btn => btn.classList.remove('active'));
                    document.getElementById('view-switch-conversation')?.classList.add('active');
                }
                
                // Configure welcome button as login CTA for unauthenticated user
                const welcomeBtn = document.getElementById('welcome-configure-btn');
                const welcomeBtnText = document.getElementById('welcome-button-text');
                const welcomeCogwheelIcon = document.getElementById('welcome-cogwheel-icon');
                const welcomeLoginIcon = document.getElementById('welcome-login-icon');
                const welcomeConfigInfo = document.getElementById('welcome-config-info');
                
                if (welcomeBtnText) welcomeBtnText.textContent = 'Login to Continue';
                if (welcomeCogwheelIcon) welcomeCogwheelIcon.classList.add('hidden');
                if (welcomeLoginIcon) welcomeLoginIcon.classList.remove('hidden');
                if (welcomeConfigInfo) welcomeConfigInfo.classList.add('hidden');
                if (welcomeBtn) {
                    // Remove any previous click listeners by cloning
                    const newBtn = welcomeBtn.cloneNode(true);
                    welcomeBtn.parentNode.replaceChild(newBtn, welcomeBtn);
                    // Add login redirect listener
                    newBtn.addEventListener('click', function() {
                        window.location.href = '/login';
                    });
                }
                
                console.log('Not authenticated');
            }
        }
        
        // Make updateAuthUI globally accessible for use by showWelcomeScreen
        window.updateAuthUI = updateAuthUI;
        
        // Check for default admin password warning flag
        function checkDefaultPasswordWarning() {
            const showWarning = localStorage.getItem('tda_show_admin_password_warning');
            if (showWarning === 'true') {
                // Show persistent warning banner about default password
                window.showAppBanner(
                    ' Security Warning: You are using the default admin password. Please change it immediately in Administration  User Management.',
                    'warning',
                    0  // Never auto-dismiss
                );
                // Don't remove the flag yet - only remove when password is actually changed
            }
        }
        
        // Initialize on page load - wait for DOM to be fully ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                updateAuthUI();
                checkDefaultPasswordWarning();
            });
        } else {
            updateAuthUI();
            checkDefaultPasswordWarning();
        }
        
        // Handle user menu toggle
        const userMenuButton = document.getElementById('user-menu-button');
        const userDropdownMenu = document.getElementById('user-dropdown-menu');
        
        if (userMenuButton && userDropdownMenu) {
            userMenuButton.addEventListener('click', () => {
                userDropdownMenu.classList.toggle('open');
            });
        }
        
        // Handle logout
        const logoutButton = document.getElementById('user-logout-button');
        if (logoutButton) {
            logoutButton.addEventListener('click', async () => {
                const result = await window.authClient.logout();
                console.log('Logout result:', result);
                window.location.href = '/login';
            });
        }
        
        // Handle profile button (placeholder)
        const profileButton = document.getElementById('user-profile-button');
        if (profileButton) {
            profileButton.addEventListener('click', () => {
                window.showAppBanner('Profile page coming soon!', 'info', 3000);
            });
        }
        
        // Handle change password button
        const changePasswordButton = document.getElementById('user-change-password-button');
        if (changePasswordButton) {
            changePasswordButton.addEventListener('click', () => {
                document.getElementById('change-password-modal-overlay').classList.remove('hidden');
            });
        }
        
        // Handle change password modal
        const changePasswordModalClose = document.getElementById('change-password-modal-close');
        const changePasswordFormCancel = document.getElementById('change-password-form-cancel');
        const changePasswordForm = document.getElementById('change-password-form');
        
        if (changePasswordModalClose) {
            changePasswordModalClose.addEventListener('click', () => {
                document.getElementById('change-password-modal-overlay').classList.add('hidden');
                changePasswordForm.reset();
            });
        }
        
        if (changePasswordFormCancel) {
            changePasswordFormCancel.addEventListener('click', () => {
                document.getElementById('change-password-modal-overlay').classList.add('hidden');
                changePasswordForm.reset();
            });
        }
        
        if (changePasswordForm) {
            changePasswordForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const currentPassword = document.getElementById('current-password').value;
                const newPassword = document.getElementById('new-password').value;
                const confirmPassword = document.getElementById('confirm-password').value;
                
                if (newPassword !== confirmPassword) {
                    window.showAppBanner('New passwords do not match!', 'error', 5000);
                    return;
                }
                
                try {
                    const response = await fetch('/api/v1/auth/change-password', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${window.authClient.getToken()}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            current_password: currentPassword,
                            new_password: newPassword
                        })
                    });
                    
                    const data = await response.json();
                    
                    if (data.status === 'success') {
                        window.showAppBanner('Password changed successfully!', 'success', 5000);
                        document.getElementById('change-password-modal-overlay').classList.add('hidden');
                        changePasswordForm.reset();
                        
                        // Clear the default password warning flag since password has been changed
                        localStorage.removeItem('tda_show_admin_password_warning');
                        // Hide the warning banner if it's showing
                        window.hideAppBanner();
                    } else {
                        window.showAppBanner(data.message || 'Failed to change password', 'error', 5000);
                    }
                } catch (error) {
                    console.error('Error changing password:', error);
                    window.showAppBanner('Failed to change password. Please try again.', 'error', 5000);
                }
            });
        }
        
        // Handle info button
        const infoButton = document.getElementById('settings-info-button');
        if (infoButton) {
            infoButton.addEventListener('click', () => {
                const infoModalOverlay = document.getElementById('info-modal-overlay');
                if (infoModalOverlay) {
                    infoModalOverlay.classList.remove('hidden');
                    // Trigger animation
                    setTimeout(() => {
                        infoModalOverlay.classList.remove('opacity-0');
                        const modalContent = document.getElementById('info-modal-content');
                        if (modalContent) {
                            modalContent.classList.remove('scale-95', 'opacity-0');
                        }
                    }, 10);
                }
            });
        }
        
        // Handle info modal close button
        const infoModalClose = document.getElementById('info-modal-close');
        if (infoModalClose) {
            infoModalClose.addEventListener('click', () => {
                const infoModalOverlay = document.getElementById('info-modal-overlay');
                if (infoModalOverlay) {
                    infoModalOverlay.classList.add('opacity-0');
                    const modalContent = document.getElementById('info-modal-content');
                    if (modalContent) {
                        modalContent.classList.add('scale-95', 'opacity-0');
                    }
                    setTimeout(() => {
                        infoModalOverlay.classList.add('hidden');
                    }, 300);
                }
            });
        }
        
        // Handle info modal overlay click (close on background click)
        const infoModalOverlay = document.getElementById('info-modal-overlay');
        if (infoModalOverlay) {
            infoModalOverlay.addEventListener('click', (e) => {
                if (e.target === infoModalOverlay) {
                    infoModalOverlay.classList.add('opacity-0');
                    const modalContent = document.getElementById('info-modal-content');
                    if (modalContent) {
                        modalContent.classList.add('scale-95', 'opacity-0');
                    }
                    setTimeout(() => {
                        infoModalOverlay.classList.add('hidden');
                    }, 300);
                }
            });
        }
        
        // Close dropdowns when clicking outside
        document.addEventListener('click', (e) => {
            if (userMenuButton && userDropdownMenu) {
                if (!userMenuButton.contains(e.target) && !userDropdownMenu.contains(e.target)) {
                    userDropdownMenu.classList.remove('open');
                }
            }
        });
        
        // AdminManager auto-initializes via DOMContentLoaded in adminManager.js
        // Just make it available globally
        if (typeof AdminManager !== 'undefined') {
            window.AdminManager = AdminManager;
        }
    </script>

    <!-- Access Token Creation Modal -->
    <div id="create-token-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4">
            <h3 class="text-xl font-bold text-white mb-4">Create Access Token</h3>
            <div class="space-y-4">
                <div>
                    <label for="token-name" class="block text-sm font-medium text-gray-300 mb-2">Token Name</label>
                    <input type="text" id="token-name" placeholder="e.g., My API Token" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:ring-2 focus:ring-green-500 focus:border-transparent">
                    <p class="text-xs text-gray-500 mt-1">Give your token a descriptive name</p>
                </div>
                <div>
                    <label for="token-expiry" class="block text-sm font-medium text-gray-300 mb-2">Expiration</label>
                    <select id="token-expiry" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:ring-2 focus:ring-green-500 focus:border-transparent">
                        <option value="30">30 days</option>
                        <option value="60">60 days</option>
                        <option value="90" selected>90 days</option>
                        <option value="180">180 days</option>
                        <option value="365">1 year</option>
                        <option value="0">Never</option>
                    </select>
                </div>
            </div>
            <div class="flex justify-end gap-3 mt-6">
                <button id="cancel-token-btn" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-md transition-colors">Cancel</button>
                <button id="confirm-create-token-btn" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-md transition-colors">Create Token</button>
            </div>
        </div>
    </div>

    <!-- Token Display Modal -->
    <div id="token-display-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4">
            <div class="flex items-center gap-3 mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-yellow-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                </svg>
                <h3 class="text-xl font-bold text-white">Token Created!</h3>
            </div>
            <div class="space-y-4">
                <div class="bg-yellow-900/30 border border-yellow-600/50 rounded-md p-4">
                    <p class="text-sm text-yellow-200 font-medium mb-2"> Important: Copy your token now</p>
                    <p class="text-xs text-yellow-300">This token will only be shown once. Make sure to copy it and store it securely.</p>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Your Access Token</label>
                    <div class="flex items-center gap-2">
                        <input type="text" id="new-token-value" readonly class="flex-1 px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white font-mono text-sm">
                        <button id="copy-new-token-btn" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-md transition-colors flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                            </svg>
                            Copy
                        </button>
                    </div>
                </div>
            </div>
            <div class="flex justify-end mt-6">
                <button id="close-token-display-btn" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-md transition-colors">Close</button>
            </div>
        </div>
    </div>

    <!-- Fork Collection Modal -->
    <div id="fork-collection-modal-overlay" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden opacity-0">
        <div id="fork-collection-modal-content" class="glass-panel rounded-xl shadow-2xl w-full max-w-lg p-6 transform scale-95 opacity-0">
            <!-- Modal Header -->
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-white">Fork Collection</h2>
                <button type="button" id="fork-collection-modal-close" class="p-2 rounded-full text-gray-400 hover:bg-white/10 hover:text-white transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Modal Body -->
            <form id="fork-collection-form" class="space-y-4">
                <input type="hidden" id="fork-collection-id" name="collection_id">
                
                <!-- Source Collection Info -->
                <div class="bg-white/5 rounded-lg p-4 border border-white/10">
                    <p class="text-sm text-gray-400 mb-2">Forking from:</p>
                    <p id="fork-source-name" class="text-white font-semibold"></p>
                    <p id="fork-source-description" class="text-sm text-gray-400 mt-1"></p>
                </div>
                
                <div>
                    <label for="fork-collection-name" class="block text-sm font-medium text-gray-300 mb-2">
                        New Collection Name <span class="text-red-400">*</span>
                    </label>
                    <input type="text" id="fork-collection-name" name="new_name" required
                           class="w-full p-3 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-[#F15F22] focus:border-[#F15F22] outline-none text-white"
                           placeholder="e.g., My SQL Patterns">
                </div>
                
                <div class="bg-blue-900/20 border border-blue-500/30 rounded-lg p-4">
                    <div class="flex gap-3">
                        <svg class="w-5 h-5 text-blue-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <div class="text-sm text-blue-200">
                            <p class="font-semibold mb-1">What is forking?</p>
                            <p>Forking creates a complete copy of this collection including all RAG cases and vector embeddings. You'll own the fork and can modify it independently.</p>
                        </div>
                    </div>
                </div>
                
                <!-- Modal Footer -->
                <div class="flex justify-end gap-3 mt-6 pt-4 border-t border-gray-600">
                    <button type="button" id="fork-collection-cancel" class="px-4 py-2 rounded-md bg-gray-600 hover:bg-gray-500 transition-colors font-semibold text-white">
                        Cancel
                    </button>
                    <button type="submit" id="fork-collection-submit" class="px-4 py-2 rounded-md bg-[#F15F22] hover:bg-[#D9501A] transition-colors font-semibold text-white">
                        Fork Collection
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Publish Collection Modal -->
    <div id="publish-collection-modal-overlay" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden opacity-0">
        <div id="publish-collection-modal-content" class="glass-panel rounded-xl shadow-2xl w-full max-w-lg p-6 transform scale-95 opacity-0">
            <!-- Modal Header -->
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-white">Publish to Marketplace</h2>
                <button type="button" id="publish-collection-modal-close" class="p-2 rounded-full text-gray-400 hover:bg-white/10 hover:text-white transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Modal Body -->
            <form id="publish-collection-form" class="space-y-4">
                <input type="hidden" id="publish-collection-id" name="collection_id">
                
                <!-- Collection Info -->
                <div class="bg-white/5 rounded-lg p-4 border border-white/10">
                    <p class="text-sm text-gray-400 mb-2">Publishing:</p>
                    <p id="publish-collection-name" class="text-white font-semibold"></p>
                    <p id="publish-collection-description" class="text-sm text-gray-400 mt-1"></p>
                </div>
                
                <div>
                    <label for="publish-visibility" class="block text-sm font-medium text-gray-300 mb-2">
                        Visibility <span class="text-red-400">*</span>
                    </label>
                    <select id="publish-visibility" name="visibility" required
                            class="w-full p-3 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-[#F15F22] focus:border-[#F15F22] outline-none text-white">
                        <option value="">Select visibility...</option>
                        <option value="public">Public - Anyone can discover and subscribe</option>
                        <option value="unlisted">Unlisted - Only accessible via direct link</option>
                    </select>
                </div>
                
                <div class="bg-green-900/20 border border-green-500/30 rounded-lg p-4">
                    <div class="flex gap-3">
                        <svg class="w-5 h-5 text-green-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <div class="text-sm text-green-200">
                            <p class="font-semibold mb-1">Share your knowledge</p>
                            <p>Publishing makes your collection available in the marketplace. Others can subscribe to benefit from your curated RAG cases.</p>
                        </div>
                    </div>
                </div>
                
                <!-- Modal Footer -->
                <div class="flex justify-end gap-3 mt-6 pt-4 border-t border-gray-600">
                    <button type="button" id="publish-collection-cancel" class="px-4 py-2 rounded-md bg-gray-600 hover:bg-gray-500 transition-colors font-semibold text-white">
                        Cancel
                    </button>
                    <button type="submit" id="publish-collection-submit" class="px-4 py-2 rounded-md bg-green-600 hover:bg-green-700 transition-colors font-semibold text-white">
                        Publish Collection
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Rate Collection Modal -->
    <div id="rate-collection-modal-overlay" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden opacity-0">
        <div id="rate-collection-modal-content" class="glass-panel rounded-xl shadow-2xl w-full max-w-lg p-6 transform scale-95 opacity-0">
            <!-- Modal Header -->
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-white">Rate Collection</h2>
                <button type="button" id="rate-collection-modal-close" class="p-2 rounded-full text-gray-400 hover:bg-white/10 hover:text-white transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Modal Body -->
            <form id="rate-collection-form" class="space-y-4">
                <input type="hidden" id="rate-collection-id" name="collection_id">
                
                <!-- Collection Info -->
                <div class="bg-white/5 rounded-lg p-4 border border-white/10">
                    <p id="rate-collection-name" class="text-white font-semibold"></p>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-3">
                        Your Rating <span class="text-red-400">*</span>
                    </label>
                    <div class="flex gap-2">
                        <button type="button" class="rate-star" data-rating="1">
                            <svg class="w-8 h-8 text-gray-500 hover:text-yellow-400 transition-colors" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                            </svg>
                        </button>
                        <button type="button" class="rate-star" data-rating="2">
                            <svg class="w-8 h-8 text-gray-500 hover:text-yellow-400 transition-colors" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                            </svg>
                        </button>
                        <button type="button" class="rate-star" data-rating="3">
                            <svg class="w-8 h-8 text-gray-500 hover:text-yellow-400 transition-colors" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                            </svg>
                        </button>
                        <button type="button" class="rate-star" data-rating="4">
                            <svg class="w-8 h-8 text-gray-500 hover:text-yellow-400 transition-colors" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                            </svg>
                        </button>
                        <button type="button" class="rate-star" data-rating="5">
                            <svg class="w-8 h-8 text-gray-500 hover:text-yellow-400 transition-colors" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                            </svg>
                        </button>
                    </div>
                    <input type="hidden" id="rate-collection-rating" name="rating" required>
                </div>
                
                <div>
                    <label for="rate-collection-review" class="block text-sm font-medium text-gray-300 mb-2">
                        Review (Optional)
                    </label>
                    <textarea id="rate-collection-review" name="review" rows="4"
                              class="w-full p-3 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-[#F15F22] focus:border-[#F15F22] outline-none text-white resize-none"
                              placeholder="Share your experience with this collection..."></textarea>
                </div>
                
                <!-- Modal Footer -->
                <div class="flex justify-end gap-3 mt-6 pt-4 border-t border-gray-600">
                    <button type="button" id="rate-collection-cancel" class="px-4 py-2 rounded-md bg-gray-600 hover:bg-gray-500 transition-colors font-semibold text-white">
                        Cancel
                    </button>
                    <button type="submit" id="rate-collection-submit" class="px-4 py-2 rounded-md bg-[#F15F22] hover:bg-[#D9501A] transition-colors font-semibold text-white">
                        Submit Rating
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Consumption Profile Modal -->
    <div id="consumption-profile-modal" class="fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center z-50 hidden">
        <div class="bg-gray-800 rounded-xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl border border-gray-700">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h3 class="text-2xl font-bold text-white" id="consumption-profile-modal-title">Create Consumption Profile</h3>
                    <p class="text-sm text-gray-400 mt-1">Configure token limits and rate limiting for user tiers</p>
                </div>
                <button id="close-consumption-profile-modal" class="p-2 hover:bg-gray-700 rounded-lg transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>

            <form id="consumption-profile-form" class="space-y-6">
                <input type="hidden" id="consumption-profile-id" value="">

                <!-- Profile Name -->
                <div>
                    <label for="consumption-profile-name" class="block text-sm font-medium text-gray-300 mb-2">
                        Profile Name <span class="text-red-400">*</span>
                    </label>
                    <input type="text" id="consumption-profile-name" required
                           class="w-full p-3 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-[#F15F22] focus:border-[#F15F22] outline-none text-white"
                           placeholder="e.g., Enterprise, Standard, Free">
                </div>

                <!-- Description -->
                <div>
                    <label for="consumption-profile-description" class="block text-sm font-medium text-gray-300 mb-2">
                        Description
                    </label>
                    <textarea id="consumption-profile-description" rows="2"
                              class="w-full p-3 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-[#F15F22] focus:border-[#F15F22] outline-none text-white resize-none"
                              placeholder="Brief description of this consumption tier..."></textarea>
                </div>

                <!-- Rate Limits -->
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="consumption-profile-prompts-hour" class="block text-sm font-medium text-gray-300 mb-2">
                            Prompts per Hour <span class="text-red-400">*</span>
                        </label>
                        <input type="number" id="consumption-profile-prompts-hour" min="0" required
                               class="w-full p-3 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-[#F15F22] focus:border-[#F15F22] outline-none text-white"
                               placeholder="100">
                    </div>
                    <div>
                        <label for="consumption-profile-prompts-day" class="block text-sm font-medium text-gray-300 mb-2">
                            Prompts per Day <span class="text-red-400">*</span>
                        </label>
                        <input type="number" id="consumption-profile-prompts-day" min="0" required
                               class="w-full p-3 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-[#F15F22] focus:border-[#F15F22] outline-none text-white"
                               placeholder="1000">
                    </div>
                </div>

                <!-- Token Limits -->
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="consumption-profile-input-tokens" class="block text-sm font-medium text-gray-300 mb-2">
                            Input Tokens per Month
                        </label>
                        <input type="number" id="consumption-profile-input-tokens" min="0"
                               class="w-full p-3 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-[#F15F22] focus:border-[#F15F22] outline-none text-white"
                               placeholder="Leave empty for unlimited">
                        <p class="text-xs text-gray-400 mt-1">Empty = Unlimited</p>
                    </div>
                    <div>
                        <label for="consumption-profile-output-tokens" class="block text-sm font-medium text-gray-300 mb-2">
                            Output Tokens per Month
                        </label>
                        <input type="number" id="consumption-profile-output-tokens" min="0"
                               class="w-full p-3 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-[#F15F22] focus:border-[#F15F22] outline-none text-white"
                               placeholder="Leave empty for unlimited">
                        <p class="text-xs text-gray-400 mt-1">Empty = Unlimited</p>
                    </div>
                </div>

                <!-- Status Toggles -->
                <div class="flex gap-6">
                    <label class="flex items-center cursor-pointer">
                        <input type="checkbox" id="consumption-profile-is-active" class="w-4 h-4 rounded border-gray-600 bg-gray-700 text-[#F15F22] focus:ring-2 focus:ring-[#F15F22] focus:ring-offset-0">
                        <span class="ml-3 text-sm font-medium text-gray-300">Active</span>
                    </label>
                    <label class="flex items-center cursor-pointer">
                        <input type="checkbox" id="consumption-profile-is-default" class="w-4 h-4 rounded border-gray-600 bg-gray-700 text-blue-500 focus:ring-2 focus:ring-blue-500 focus:ring-offset-0">
                        <span class="ml-3 text-sm font-medium text-gray-300">Default Profile</span>
                    </label>
                </div>

                <!-- Modal Footer -->
                <div class="flex justify-end gap-3 pt-4 border-t border-gray-600">
                    <button type="button" id="cancel-consumption-profile" class="px-4 py-2 rounded-md bg-gray-600 hover:bg-gray-500 transition-colors font-semibold text-white">
                        Cancel
                    </button>
                    <button type="submit" class="px-4 py-2 rounded-md bg-[#F15F22] hover:bg-[#D9501A] transition-colors font-semibold text-white">
                        Save Profile
                    </button>
                </div>
            </form>
        </div>
    </div>

</body>
</html>