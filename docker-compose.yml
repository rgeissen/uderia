services:
  uderia:
    # This 'build' section tells Compose to use your Dockerfile
    build:
      context: . # Assumes Dockerfile is in this directory
      dockerfile: Dockerfile
    # This will be the name of the image after it's built
    image: uderia-v14:latest
    
    # This is the container name from your JSON config
    container_name: uderia-v14
    
    # This 'command' overrides the default CMD in the Dockerfile
    # It's taken directly from the "cmd" field in your JSON
    command: python -m trusted_data_agent.main --host 0.0.0.0 --port 5050
    
    # Port mapping is now configured to expose port 5050 on the host
    ports:
      - "5050:5050"
      
    volumes:
      # Mount the entire application directory for development
      # IMPORTANT: Ensure /mnt/hdd_storage/docker/uderia contains your latest code
      # including all fixes for authentication and configuration
      - /home/rgeissen/prod/docker/uderia:/app
      
    environment:
      # Application-specific variables
      - CORS_ALLOWED_ORIGINS=https://tda.uderia.com
      - APP_BASE_URL=https://tda.uderia.com
      # Secret key for session security and cryptographic signing. Change this to a strong random string in production or use .env file.
      - SECRET_KEY=${SECRET_KEY}
      
    networks:
      - tda_network
      
    # This is a high-risk setting from your JSON ("privileged": true).
    # It gives the container root access to your host machine.
    privileged: true
    
    # Your JSON had "enable_restart_policy": false, which means 'no' restart.
    # For production, you might want to change this to "unless-stopped".
    restart: "no"

# Define the bridge network
networks:
  tda_network:
    driver: bridge
    name: TDA_Network